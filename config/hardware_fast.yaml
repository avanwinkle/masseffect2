#config_version=5
hardware:
  platform: fast
  driverboards: fast
  # net_buffer: 10
  # lights: virtual

modes:
  - airlock

fast:
  ports: autodetect
  # rgb_buffer: 10000
  # debug: true
  hardware_led_fade_time: 100

machine:
  balls_installed: 6
  min_balls: 6

event_player:
  bypass_lock_release_pulse_short:
    - bypass_lock_release_pulse|0
    - cancel_lock_release_pulse|190ms
  bypass_lock_release_pulse_long:
    - bypass_lock_release_pulse|0
    - cancel_lock_release_pulse|700ms

ball_devices:
  bd_plunger:
    ball_switches: s_plunger_lane
    eject_coil: c_plunger
    mechanical_eject: true
    ball_missing_timeouts: 10s
    eject_timeouts: 5s
    confirm_eject_type: target # default
    entrance_count_delay: 1s
    player_controlled_eject_event: force_plunger_launch
    debug: true
    ball_search_order: 1
  bd_trough:
    ball_switches: s_trough1, s_trough2, s_trough3, s_trough4, s_trough5, s_trough6
    eject_coil: c_trough_eject
    tags: trough, home, drain
    jam_switch: s_trough_jam
    eject_targets: bd_plunger
    eject_timeouts: 1500ms
    auto_fire_on_unexpected_ball: False
    confirm_eject_switch: s_plunger_lane
    ball_search_order: 2
  bd_lock:
    entrance_count_delay: 500ms # Default: 500ms
    ball_switches: s_lock_1, s_lock_2, s_lock_3
    eject_coil: c_lock_release
    eject_events: lock_eject_one_ball
    eject_all_events: game_ended, lock_eject_all
    eject_coil_enable_time: 280ms, 250ms, 235ms
    eject_timeouts: 3s
    exit_count_delay: 2s
    ball_missing_timeouts: 5s
    debug: true
    ball_search_order: 20
  bd_hold:
    eject_coil: c_hold_post_release
    ball_switches: s_missionselect
    debug: true
    ball_search_order: 10

named_colors:
  # Named colors must be explicit due to race conditions with config_common
  bb_squad_color: ff6611 # FFBB66 makes as white as possible. But orange is better
  backbox_tone: ffdf8f
  standup_color: ffcc00  # color_armor
  skillshot_color_paragon: 1166ff  # color_paragon
  skillshot_color_renegade: "660000"  # color_renegade
  dropbank_color_shadowbroker: ff1f00
  color_kasumi_alarm: aa0000
  color_normandy_attack: "220000"
  color_ui_yellow: f3dc90
  color_ui_orange_dark: 8f541c
  color_ui_orange: fbc795
  color_ui_green_dark: 5b8c55
  color_ui_green: 5bff63
  color_ui_green_light: c4fe8d
  color_ui_green_strong: 2adb23

coils:
  c_flipper_left_main:
    number: 1-7
    default_pulse_ms: 80  # Increased from Spike 35
    default_pulse_power: 0.8
    default_hold_power: 0.12
  c_flipper_right_main:
    number: 1-4
    default_pulse_ms: 80  # Increased from Spike 35
    default_pulse_power: 0.8
    default_hold_power: 0.12
  c_plunger:
    number: 1-1
    default_pulse_ms: 120  # Increased from Spike 18, bumped from 40
    default_pulse_power: 1.0
    pulse_events: pulse_plunger
  c_trough_eject:
    number: 1-0
    default_pulse_ms: 20
    debug: true
    # pulse_power: 2
  c_bumper_left:
    number: 2-2
    default_pulse_ms: 60
    default_pulse_power: 0.8
  c_bumper_right:
    number: 2-1
    default_pulse_ms: 60
    default_pulse_power: 0.7
  c_bumper_bottom:
    number: 2-0
    default_pulse_ms: 60
    default_pulse_power: 0.5
    platform_settings:
      recycle_ms: 255
  c_slingshot_left:
    number: 1-6
    default_pulse_ms: 12
    # default_recycle: true
  c_slingshot_right:
    number: 1-3
    default_pulse_ms: 12
    # default_recycle: true
  c_dropbank_reset:
    number: 1-5
    default_pulse_ms: 30  # Bumped up from 25
    pulse_events: ball_search_phase_1
  c_hold_post_up:
    # MOVED while the 3208 is burned out
    # number: 1-2
    number: 0-1
    default_pulse_ms: 50
    pulse_events:
      - fire_hold_post
      - enable_transition_hold
    debug: true
    tags: coil_missionselect
  c_hold_post_release:
    number: 0-0
    default_pulse_ms: 40
    debug: true
    pulse_events:
      - release_suicide_hold
  c_lock_release:
    number: 0-2
    default_pulse_ms: 50  # Increase from Spike 32
    default_hold_power: 0.12
    enable_events: bypass_lock_release_pulse
    disable_events: cancel_lock_release_pulse
    debug: true
    tags: coil_airlock
  c_orbit_gates:
    number: 2-3
    default_pulse_ms: 60
    default_hold_power: 0.75
    enable_events: enable_gates
    disable_events: disable_gates
    pulse_events: ball_search_phase_1

switches:
  # BOARD 1-C (Purple)
  s_dropbank_bottom:
    number: 1-16
  s_dropbank_middle:
    number: 1-17
  s_dropbank_top:
    number: 1-18
  s_target1:
    number: 1-19
  s_target2:
    number: 1-20
  s_target3:
    number: 1-21
  s_target4:
    number: 1-22
  s_target5:
    number: 1-23
  # BOARD 1-B (Blue)
  s_plunger_lane:
    number: 1-8
    debounce: normal  # Let the ball set a moment before auto-kicking
  s_trough_jam:
    number: 1-9
    type: NC
  s_trough1:
    number: 1-10
    type: NC
  s_trough2:
    number: 1-11
  s_trough3:
    number: 1-12
  s_trough4:
    number: 1-13
  s_trough5:
    number: 1-14
  s_trough6:
    number: 1-15
  # BOARD 1-A (Pink)
  s_flipper_left:
    number: 1-0
    tags: left_flipper
  s_flipper_right:
    number: 1-1
    tags: right_flipper
  s_start_button:
    number: 1-2
    tags: start
    ignore_window_ms: 1000
  s_tilt:
    number: 1-3
    tags: tilt_warning
  s_outlane_left:
    number: 1-4
  s_return_lane_left:
    number: 1-5
  s_left_slingshot:
    number: 1-6
  s_left_ramp_exit:
    number: 1-7
    tags: switch_hold_entrance
  # BOARD 1-D (Green)
  s_missionselect:
    number: 1-24
  s_hitbank_top:
    number: 1-25
  s_hitbank_bottom:
    number: 1-26
  s_tenpoints:
    number: 1-27
  s_outlane_right:
    number: 1-28
  # NOT USED: 1-29
  s_right_slingshot:
    number: 1-30
  s_return_lane_right:
    number: 1-31
    ignore_window_ms: 1000
  # BOARD 2 (UPPER)
  s_bumper_bottom:
    number: 2-0
    tags: bumper
  s_bumper_right:
    number: 2-1
    tags: bumper
  s_bumper_left:
    number: 2-2
    tags: bumper
  s_top_lane_left:
    number: 2-3
  s_top_lane_right:
    number: 2-4
  s_right_orbit:
    number: 2-5
    ignore_window_ms: 1100
  s_left_orbit:
    number: 2-6
    ignore_window_ms: 1100
  s_right_ramp_exit:
    number: 2-7
    ignore_window_ms: 1100
  # BOARD 0
  s_lock_1:
    number: 0-0
    type: NC
  s_lock_2:
    number: 0-1
    type: NC
  s_lock_3:
    number: 0-2
    type: NC
  s_right_ramp_entrance:
    number: 0-3
    ignore_window_ms: 1500
  s_left_ramp_entrance:
    number: 0-4
    ignore_window_ms: 1500
  s_airlock_entrance:
    number: 0-5
    tags: lock_entrance
    ignore_window_ms: 1100
  s_kickback:
    number: 0-6
    ignore_window_ms: 600
  s_spinner:
    number: 0-7
  # BOARD 3 ?
  # s_door_open:
  #   number: 3-0
  #   tags: service_door_open, power_off
  # s_service_enter:
  #   number: 3-1
  #   tags: service_enter
  # s_service_esc:
  #   number: 3-2
  #   tags: service_esc
  # s_service_up:
  #   number: 3-3
  #   tags: service_up
  # s_service_down:
  #   number: 3-4
  #   tags: service_down
  # s_credit:
  #   number: 3-5
  # s_tilt:
  #   number: 3-6
  # s_slam_tilt:
  #   number: 3-7

light_rings:
  l_left_orbit_ring:
    number_start: 1
    number_template: 1-{}
    count: 6
    light_template:
      tags: light_lane_left_orbit
      type: grb
  l_kickback_ring:
    number_start: 8
    number_template: 1-{}
    count: 6
    light_template:
      tags: light_lane_kickback
      type: grb
  l_left_ramp_ring:
    number_start: 15
    number_template: 1-{}
    count: 6
    light_template:
      tags: light_lane_left_ramp
      type: grb
  l_right_ramp_ring:
    number_start: 22
    number_template: 1-{}
    count: 6
    light_template:
      tags: light_lane_right_ramp
      type: grb
  l_right_orbit_ring:
    number_start: 29
    number_template: 1-{}
    count: 6
    light_template:
      tags: light_lane_right_orbit
      type: grb

light_stripes:
  l_backwall_gi:
    number_start: 0
    number_template: 3-{}
    count: 10
    light_template:
      tags: light_backwall_gi, light_flash_alarm
      type: rgb
  l_backwall_ambient:
    number_start: 10
    number_template: 3-{}
    count: 14
    light_template:
      tags: light_backwall_ambient
      type: grb

lights:
  l_null:
    number: 0-63
    tags: gi, backbox

  # First chain of lights
  #------------------------------------------
  l_left_top_lane: # Left Top Lane [#75]
    number: 0-1
    type: grb
    tags: light_pf
  l_right_top_lane: # Right Top Lane [#76]
    number: 0-0
    type: grb
    tags: light_pf

  l_flash_left_orbit: # Left Loop (Spinner) [#102]
    number: 0-2
    type: grb
    tags: light_pf

  l_dropbank_top: # Left 3-Bank (Top) [#15]
    number: 0-3
    type: grb
    tags: light_dropbank_rgb, light_pf, l_dropbanks, outer_circles
    default_on_color: ff1f00  # color_shadowbroker
  l_dropbank_middle: # Left 3-Bank (Mid) [#14]
    number: 0-4
    type: grb
    tags: light_dropbank_rgb, light_pf, l_dropbanks, outer_circles
    default_on_color: ff1f00  # color_shadowbroker
  l_dropbank_bottom: # Left 3-Bank (Bot) [#13] #FF1F00
    number: 0-5
    type: grb
    tags: light_dropbank_rgb, light_pf, l_dropbanks, outer_circles
    default_on_color: ff1f00  # color_shadowbroker

  l_left_outlane: # Left Outlane [#11]
    number: 0-7
    type: grb
    tags: light_pf, l_outlane, outer_circles
  l_left_return_lane: # Left Return Lane [#12]
    number: 0-6
    type: grb
    tags: light_pf, l_return_lane, outer_circles
  l_left_medigel:
    number: 0-8
    type: grb
    tags: light_pf, light_medigel
  l_ball_save: # Shoot Again [#32]
    number: 0-9
    type: grb
    tags: light_pf, outer_circles
    default_on_color: ffcc00  # color_armor
  l_right_medigel:
    number: 0-10
    type: grb
    tags: light_pf, light_medigel
  l_right_return_lane: # Right Return Lane [#33]
    number: 0-12
    type: grb
    tags: light_pf, l_return_lane, outer_circles
  l_right_outlane: # Right Outlane [#34]
    number: 0-11
    type: grb
    tags: light_pf, l_outlane, outer_circles
  l_hitbank_bottom: # Right 2-Bank (Bot) [#39]
    number: 0-13
    type: grb
    tags: light_pf, light_hitbank_rgb, l_hitbanks, outer_circles
    default_on_color: 22ff33  # color_overlord
  l_hitbank_top: # Right 2-Bank (Top) [#38]
    number: 0-14
    type: grb
    tags: light_pf, light_hitbank_rgb, l_hitbanks, outer_circles
    default_on_color: 22ff33  # color_overlord
  l_standup_1: # Standup 1 [#44]
    number: 0-23
    type: grb
    tags: light_pf, l_targets
    default_on_color: ffcc00  # color_armor
  l_standup_2: # Standup 2 [#52]
    number: 0-21
    type: grb
    tags: light_pf, l_targets
    default_on_color: ffcc00  # color_armor
  l_standup_3: # Standup 3 [#59]
    number: 0-19
    type: grb
    tags: light_pf, l_targets
    default_on_color: ffcc00  # color_armor
  l_standup_4: # Standup 4 [#64]
    number: 0-17
    type: grb
    tags: light_pf, l_targets
    default_on_color: ffcc00  # color_armor
  l_standup_5: # Standup 5 [#70]
    number: 0-16
    type: grb
    tags: light_pf, l_targets
    default_on_color: ffcc00  # color_armor

  l_right_ramp_arrow_yellow:  # Right Ramp Arrow (Yellow) [#65]
    number: 0-15
    type: grb
    tags: light_pf, lane_wedges, l_upgrade
    default_on_color: eeff00  # color_kasumi
  l_battering_ram_top:  # Battering Ram 1 (Top) [#62]
    number: 0-18
    type: grb
    tags: light_pf, batram_multipliers, batram_arrow, light_reapercore
    default_on_color: "990000"  # color_health
  l_left_ramp_arrow_green:  # Left Ramp Arrow (Green) [#54]
    number: 0-20
    type: grb
    tags: light_pf, light_missionselect, lane_wedges
    default_on_color: white
  l_kickback_arrow_clear:  # Kickback Lane Arrow (Clear) [#45]
    number: 0-22  # shadowbroker mission start
    type: grb
    tags: light_pf, light_lock_lit, light_shadowbroker_start, l_store, lane_wedges
    default_on_color: ff1f00  # color_shadowbroker
  # When we get a separate light for the store, move l_store to it

  l_bbsquad_garrus:
    number: 2-5
    type: grb
    tags: light_bbsquad_garrus, light_bbsquad
  l_bbsquad_grunt:
    number: 2-7
    type: grb
    tags: light_bbsquad_grunt, light_bbsquad
  l_bbsquad_jack:
    number: 2-10
    type: grb
    tags: light_bbsquad_jack, light_bbsquad
  l_bbsquad_jacob:
    number: 2-8
    type: grb
    tags: light_bbsquad_jacob, light_bbsquad
  l_bbsquad_kasumi:
    number: 2-11
    type: grb
    tags: light_bbsquad_kasumi, light_bbsquad
  l_bbsquad_legion:
    number: 2-1
    type: grb
    tags: light_bbsquad_legion, light_bbsquad
  l_bbsquad_miranda:
    number: 2-6
    type: grb
    tags: light_bbsquad_miranda, light_bbsquad
  l_bbsquad_mordin:
    number: 2-4
    type: grb
    tags: light_bbsquad_mordin, light_bbsquad
  l_bbsquad_samara:
    number: 2-2
    type: grb
    tags: light_bbsquad_samara, light_bbsquad
  l_bbsquad_tali:
    number: 2-3
    type: grb
    tags: light_bbsquad_tali, light_bbsquad
  l_bbsquad_thane:
    number: 2-9
    type: grb
    tags: light_bbsquad_thane, light_bbsquad
  l_bbsquad_zaeed:
    number: 2-0
    type: grb
    tags: light_bbsquad_zaeed, light_bbsquad


  # NeoPixel Jewels (Center Lights)
  #------------------------------------------
  l_left_orbit_shield_rgb: # Left Loop Sigil R [#40]
    type: grb
    number: 1-0
    tags: light_pf, shot_shields, lane_shields, shot_shield_grunt, shot_shield_zaeed, l_left_orbit_arrow_red
  l_kickback_shield_rgb: # Kickback Sigil R [#47]
    type: grb
    number: 1-7
    tags: light_pf, shot_shields, lane_shields, shot_shield_jack, shot_shield_legion, light_lock_entrance, l_kickback_arrow_red
  l_left_ramp_shield_rgb: # Left Ramp Sigil R [#55]
    type: grb
    number: 1-14
    tags: light_pf, shot_shields, lane_shields, shot_shield_garrus, shot_shield_samara, l_left_ramp_arrow_red
  l_right_ramp_shield_rgb: # Right Ramp Sigil R [#66]
    type: grb
    number: 1-21
    tags: light_pf, shot_shields, lane_shields, shot_shield_kasumi, shot_shield_thane, l_right_ramp_arrow_red
  l_right_orbit_shield_rgb: # Right Loop Sigil R [#71]
    type: grb
    number: 1-28
    tags: light_pf, shot_shields, lane_shields, shot_shield_mordin, shot_shield_tali, l_right_orbit_arrow_red


  # Unassigned lights carried over from Spike
  #------------------------------------------
  # l_backbox:
  #   number: 1-63
  #   tags: backbox
  l_2x_multiplier: # 2x Multiplier [#28]
    number: 2-17
    tags: l_multipliers
  l_3x_multiplier: # 3x Multiplier [#29]
    number: 2-18
    tags: l_multipliers
  l_4x_multiplier: # 4x Multiplier [#30]
    number: 2-19
    tags: l_multipliers
  # l_5x_multiplier: # 5x Multiplier [#31]
  #   number: 1-13
  #   tags: l_multipliers
  l_battering_ram_arrow: # Battering Ram Arrow [#63]
    number: 2-28
    tags: lane_arrows
  # l_battering_ram_bot: # Battering Ram 3 (Bot) [#60]
  #   number: 3-19
  #   tags: batram_multipliers
  # l_battering_ram_mid: # Battering Ram 2 (Mid) [#61]
  #   number: 3-20
  #   tags: batram_multipliers
  # # l_coin_enable: # Coin Enable [#1]
  # #   number: 0-0
  l_dragon_fire: # Dragon Fire [#51]
    number: 2-29
  l_flash_back_panel_left: # Back Panel Left [#100]
    number: 2-27
  l_flash_back_panel_right: # Back Panel Right [#101]
    number: 2-26
  l_flash_battering_ram: # Battering Ram [#103]
    number: 2-25
  l_flash_kickback: # Kickback Lane [#99]
    number: 2-24
    tags: upfield_flashers
  l_flash_left_ramp: # Left Ramp [#98]
    number: 2-20
    tags: upfield_flashers
  l_flash_right_orbit: # Pop Bumpers [#97]
    number: 2-23
  l_flash_right_ramp: # Right Ramp [#96]
    number: 2-22
    tags: upfield_flashers
  l_flash_slingshots: # Left/Right Sling [#104]
    number: 2-21
  l_flash_sword_lock: # Sword Lock [#95]
    number: 2-16
    tags: upfield_flashers
  l_flash_throne: # Throne [#105]
    number: 2-30
  l_flash_dragon_right: # Dragon Right (Purple) [#106]
    number: 2-31
  l_flash_dragon_left: # Dragon Left (2x Red & White) [#107]
    number: 2-15
  # # l_gi_coin_door: # Coin Door GI [#85]
  # #   number: 0-1
  l_gi_left_playfield: # Left Playfield GI [#87]
    number: 2-49
    tags: gi
  l_gi_lower_playfield: # Lower Playfield GI [#86]
    number: 2-50
    tags: gi
  l_gi_upper: # Upper GI [#88]
    number: 2-51
    tags: gi
  l_hand_of_the_king: # Hand of the King [#19]
    number: 2-32
    tags: outer_circles
  l_iron_throne: # Iron Throne [#21]
    number: 2-33
    tags: outer_circles
  # l_kickback_arrow_amber: # Kickback Lane Arrow (Amber) [#46]
  #   number: 1-40
  #   tags: lane_wedges
  # l_kickback_arrow_red: # Kickback Lane Arrow (Red) [#50]
  #   number: 1-41
  #   tags: lane_arrows, light_firewalker, light_firewalker_kickback
  # l_left_orbit_arrow_red: # Left Loop Arrow [#43]
  #   number: 3-12
  #   tags: lane_arrows, light_firewalker, light_firewalker_left_orbit
  # l_left_ramp_arrow_clear: # Left Ramp Arrow (Clear) [#53]
  #   number: 3-16
  #   tags: lane_wedges
  # l_left_ramp_arrow_red: # Left Ramp Arrow (Red) [#58]
  #   number: 3-18
  #   tags: lane_arrows, light_firewalker, light_firewalker_left_ramp
  l_pop_bumper_bottom: # Pop Bumper Bottom [#79]
    number: 2-12
    tags: l_pop_bumpers
  l_pop_bumper_left: # Pop Bumper Left [#77]
    number: 2-13
    tags: l_pop_bumpers
  l_pop_bumper_right: # Pop Bumper Right [#78]
    number: 2-14
    tags: l_pop_bumpers
  # l_right_orbit_arrow_red: # Right Loop Arrow [#74]
  #   number: 1-20
  #   tags: lane_arrows, light_firewalker, light_firewalker_right_orbit
  # l_right_ramp_arrow_red: # Right Ramp Arrow (Red) [#69]
  #   number: 1-18
  #   tags: lane_arrows, light_firewalker, light_firewalker_right_ramp
  l_shield_baratheon: # Sigil Baratheon [#23]
    number: 2-52
    tags: color_shields, color_shield_yellow
  l_shield_greyjoy: # Sigil Greyjoy [#25]
    number: 2-53
    tags: color_shields, color_shield_purple
  l_shield_lannister: # Sigil Lannister [#24]
    number: 2-54
    tags: color_shields, color_shield_red
  l_shield_martell: # Sigil Martell [#27]
    number: 2-55
    tags: color_shields, color_shield_orange
  l_shield_stark: # Sigil Stark [#22]
    number: 2-56
    tags: color_shields, color_shield_white
  l_shield_targaryen: # Sigil Targaryen [#20]
    number: 2-57
    tags: color_shields, color_shield_blue
  l_shield_tyrell: # Sigil Tyrell [#26]
    number: 2-58
    tags: color_shields, color_shield_green
  l_start_button: # Start Button [#2]
    number: 2-62
  # # l_tournament_start: # Tournament Start [#3]
  # #   number: 0-3
  # l_hitbank_shield_rgb: # Right 2-Bank Sigil R [#35]
  #   type: grb
  #   number: 2-47
  #   tags: shot_shields
  l_action_button_rgb: # Lockdown R [#4]
    type: grb
    number: 2-48
    tags: l_action_button
  # l_dropbank_shield_rgb: # Left Bank Sigil R [#16]
  #   type: grb
  #   number: 2-44
  #   tags: shot_shields
