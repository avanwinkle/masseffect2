#config_version=5

#####
# AIRLOCK MODE
#
# This is the sister config to lockhandler.yaml, but simpler. The FAST hardware
# setup uses separate ball devices for missionselect and ball lock, so the
# complex logic handling of lockhandler is no longer necessary.
#####

mode:
  start_events: start_mode_lockhandler
  stop_events: ball_will_end
  code: airlock.Airlock
  priority: 1000

event_player:
  ball_hold_missionselect_hold_held_ball: start_mode_missionselect
  # Relay these events to be agnostic with lockhandler
  sw_airlock_entrance_active{device.multiball_locks.fmball_lock.enabled}:
    overlord_ball_will_lock{device.achievements.arrival.state=="disabled"}:
      total_balls_locked:
        value: device.multiball_locks.fmball_lock.locked_balls + 1
        type: int
    arrival_ball_will_lock{device.achievements.arrival.state!="disabled"}:
      total_balls_locked:
        value: device.multiball_locks.fmball_lock.locked_balls + 1
        type: int
  # Hold open the gates if no balls are there
  s_battering_ram_active{not device.multiball_locks.fmball_lock.enabled and device.multiball_locks.fmball_lock.locked_balls==0}:
    - bypass_lock_release_pulse_long
  # Delay the release of suicide balls
  infiltration_specialist_selected: release_suicide_hold|2s
  longwalk_specialist_selected: release_suicide_hold|2s

queue_relay_player:
  mode_missionselect_starting:
    post: check_slide_queue
    wait_for: slide_queue_clear

ball_holds:
  missionselect_hold:
    balls_to_hold: 1
    hold_devices: bd_hold
    debug: true
    enable_events:
      - mode_field_started{current_player.available_missions>0 and not current_player.bypass_missionselect}
      - player_available_missions{player_num==current_player.number and value>0 and mode.field.active}
      - s_left_ramp_exit_active{current_player.status_garrus==2 or current_player.status_samara==2}
    disable_events:
      - mode_field_stopped
      - mode_missionselect_stopped
      - player_available_missions{value<=0}
    release_all_events:
      - mode_missionselect_will_stop
  suicide_hold:
    balls_to_hold: 1
    hold_devices: bd_hold
    debug: true
    enable_events:
      - infiltration_complete
      - longwalk_complete
      - tubes_complete
    disable_events: mode_suicide_huddle_will_stop
    release_all_events: release_suicide_hold

multiball_locks:
  fmball_lock:
    balls_to_lock: 3
    balls_to_replace: 2
    lock_devices: bd_lock
    reset_count_for_current_player_events: fmball_stopped, mode_collectorship_base_started
    enable_events: enable_fmball_lock
    disable_events: multiball_lock_fmball_lock_locked_ball, mode_collectorship_base_started
    debug: true
