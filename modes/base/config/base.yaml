# config_version=5
mode:
  start_events: ball_starting
  priority: 100

config:
  - base_debug.yaml

achievements:
  collectorship:
    enable_events: enable_collectorship
    start_events: mode_collectorship_base_started
    complete_events:
      - mode_collectorship_praetorian_complete # Track the first praetorian completion to award a levelup
      - mode_collectorship_base_stopped # Once the mode has been played, the achievement is complete
  derelictreaper:
    enable_events: enable_derelictreaper
    start_events: start_mode_derelictreaper
  collectorattack:
    enable_events: enable_collectorattack
    start_events: mode_collectorattack_started
    complete_events: mode_collectorattack_stopped # Only played once, completed after playing
  hagalaz:
    enable_events: logicblock_sbhagalaz_counter_complete
    start_events: mode_shadowbroker_hagalaz_started
    stop_events: mode_shadowbroker_hagalaz_stopped
    complete_events: shadowbroker_hagalaz_complete
  shadowbroker:
    enable_events: shadowbroker_hagalaz_complete
    start_events: mode_shadowbroker_boss_started
    stop_events: mode_shadowbroker_boss_stopped
    complete_events: shadowbroker_boss_complete
  suicidemission:
    enable_events: enable_suicidemission
    start_events: mode_suicidemission_base_started
    stop_events: mode_suicidemission_base_stopped
    complete_events: suicidemission_complete
  vasir:
    enable_events: logicblock_sbvasir_counter_complete
    start_events: mode_shadowbroker_vasir_started
    stop_events: mode_shadowbroker_vasir_stopped
    complete_events: shadowbroker_vasir_complete

event_player:
  mode_base_started:
    - start_mode_pause
    - start_mode_recruitbase
    - start_mode_lockhandler
    - start_mode_planets
    - start_mode_upgrades
    - enable_orbitswitches
    - reenable_nonrecruit_modes
    # - enable_collectorship
  mode_overlordmultiball_started:
    - stop_mode_recruitbase
    - disable_nonrecruit_modes
  mode_overlordmultiball_stopped:
    - start_mode_recruitbase
    - reenable_nonrecruit_modes
  disable_recruit_modes:
    - stop_mode_recruitbase
    - stop_mode_recruitfield
    - stop_mode_planets
  disable_nonrecruit_modes:
    - stop_mode_arrival
    - stop_mode_overlordlight
    - stop_mode_shadowbroker_base
    - stop_mode_shopping
    - stop_mode_upgrades
  reenable_recruit_modes:
    - start_mode_recruitbase
    - start_mode_recruitfield
    - start_mode_planets
  reenable_nonrecruit_modes:
    - start_mode_shadowbroker_base
    - start_mode_shopping
    - start_mode_upgrades
    # Prior to collector attack: overlord; after: arrival
    - start_mode_overlordlight{device.achievements.collectorship.state!="complete"}
    - start_mode_arrival{device.achievements.collectorship.state=="complete"}
  # When we have 6 squadmates (aka 4 recruits completed), go to collector ship
  player_squadmates_count{current_player.squadmates_count == 6}:
    - enable_collectorship
  missionselect_collectorship_selected:
    - disable_recruit_modes
    - disable_nonrecruit_modes
    - start_mode_collectorship_base
  mode_collectorship_base_stopped:
    - reenable_recruit_modes
    - reenable_nonrecruit_modes
    - start_mode_planets
  enter_shadowbroker_modes:
    - disable_recruit_modes
    - stop_mode_arrival
    - stop_mode_overlordlight
    - stop_mode_shopping
  exit_shadowbroker_modes:
    - reenable_recruit_modes
    - start_mode_arrival
    - start_mode_overlordlight
    - start_mode_shopping
  fullorbit_enter_hit:
    - enable_gates
    - disable_orbitswitches
    - disable_gates|900ms
    - enable_orbitswitches|900ms
  fullorbit_fromplunger_hit:
    - enable_gates
    - disable_orbitswitches
    - disable_gates|1500ms
    - enable_orbitswitches|2000ms
  s_plunger_lane_inactive:
    - disable_orbitswitches
    - enable_orbitswitches|1000ms

accruals:
  recruitment_missions:
    persist_state: true
    reset_on_complete: false
    events:
      - recruit_garrus_complete
      - recruit_grunt_complete
      - recruit_jack_complete
      - recruit_kasumi_complete
      - recruit_legion_complete
      - recruit_mordin_complete
      - recruit_samara_complete
      - recruit_tali_complete
      - recruit_thane_complete
      - recruit_zaeed_complete

ball_saves:
  default:
    active_time: 20s
    grace_period: 2s
    hurry_up_time: 5s
    enable_events: mode_base_started
    timer_start_events: playfield_active
    auto_launch: true
    balls_to_save: 1
    early_ball_save_events: s_outlane_left_active, s_outlane_right_active

counters:
  recruited_count:
    starting_count: 2
    count_events: recruit_mission_success
    count_complete_value: 12
    disable_on_complete: true
    reset_on_complete: false
    persist_state: true
  mission_count:
    starting_count: 0
    count_events: recruit_mission_success
    persist_state: true

scoring:
  levelup:
    level: 1
  recruit_mission_success:
    available_missions: -1
  enable_collectorship:
    available_missions: 1
  mode_collectorship_base_stopped:
    available_missions: -1

shots:
# These "core" shots for the main shots
# This way, the mode-specific shots can always be enabled and show shows, but
# they won't trigger hits unless the underlying core shot is enabled. This allows
# us to use global methods of disabling core shots, e.g. ball save and full orbit,
# without having to duplicate the logic in modes or re-sync mode shot shows.
  sh_left_ramp:
    switch: s_left_ramp_exit
  sh_left_orbit:
    switch: s_left_orbit
    enable_events: enable_orbitswitches
    disable_events: disable_orbitswitches
  sh_right_ramp:
    switch: s_right_ramp_exit
  sh_right_orbit:
    switch: s_right_orbit
    enable_events: enable_orbitswitches
    disable_events: disable_orbitswitches
  sh_spinner:
    switch: s_spinner_left
    enable_events: enable_orbitswitches
    disable_events: disable_orbitswitches
  sh_kickback:
    switch: s_kickback
  sh_hitbank_top:
    switch: s_hitbank_top
  sh_hitbank_bottom:
    switch: s_hitbank_bottom
  sh_dropbank_top:
    switch: s_dropbank_top
  sh_dropbank_middle:
    switch: s_dropbank_middle
  sh_dropbank_bottom:
    switch: s_dropbank_bottom
  # Other commonly-used or commonly-behaving shots
  fullorbit_enter:
    switches: s_left_orbit, s_right_orbit
    enable_events: enable_fullorbit
    disable_events: disable_fullorbit
  fullorbit_fromplunger:
    hit_events: balldevice_bd_plunger_ejecting_ball
    enable_events: enable_fullorbit
    disable_events: disable_fullorbit

show_player:
  ball_save_default_enabled:
    ball_save_show:
      action: play
      loops: 0
  ball_save_default_timer_start:
    ball_save_show:
      action: play
      speed: 3
  ball_save_default_hurry_up:
    ball_save_show:
      action: play
      speed: 9
  ball_save_default_timer_grace_period:
    ball_save_show:
      action: stop
  ball_save_default_disabled:
    ball_save_show:
      action: stop

shows:
  ball_save_show:
    - time: 0
      lights:
        l_ball_save:
          color: black
    - time: '+1'
      lights:
        l_ball_save:
          color: white
  flash_all_shields_show:
    - time: 0
      lights:
        l_left_orbit_shield_rgb: (color)
        l_left_ramp_shield_rgb: (color)
        l_kickback_shield_rgb: (color)
        l_right_ramp_shield_rgb: (color)
        l_right_orbit_shield_rgb: (color)
        l_dropbank_shield_rgb: (color)
        l_hitbank_shield_rgb: (color)
    - time: '+1'
      lights:
        l_left_orbit_shield_rgb: black
        l_left_ramp_shield_rgb: black
        l_kickback_shield_rgb: black
        l_right_ramp_shield_rgb: black
        l_right_orbit_shield_rgb: black
        l_dropbank_shield_rgb: black
        l_hitbank_shield_rgb: black
        l_null: (color)
  flash_color_show:
    - time: 0
      lights:
        (leds): (color)
    - time: '+1'
      lights:
        (leds): black
        l_null: (color)
  color_off:
    - time: 0
      lights:
        (leds): black
        l_null: (color)

slide_player:
  mode_base_started: base_slide
  levelup:
    levelup_slide:
      expire: 5s

slides:
  base_slide: []
  levelup_slide:
    widgets:
      - type: text
        text: LEVEL UP!
        font_size: 14
        style: dmd_big
        anchor_y: bottom
        y: 10

sound_player:
  levelup:
    music_mission_success:
      action: play
      priority: 100

sounds:
  music_mission_success:
    file: mus_gui_mission_completion.ogg
    track: levelup # Use a special track to avoid music fadeout conflicts
    loop: 0
    fade_in: 500ms
    fade_out: 1s

widget_player:
  mode_base_started:
    base_score_widget:
      slide: base_slide
    base_level_widget:
      slide: base_slide
    base_ball_widget:
      slide: base_slide
  levelup:
    levelup_mission:
      slide: levelup_slide

widgets:
  base_score_widget:
    - type: text
      text: (score)
      number_grouping: true
      min_digits: 2
      font_size: 12
      font_name: Quadrit-10
      anchor_x: left
      anchor_y: top
      x: 2
      y: top-4
  base_level_widget:
      - type: text
        text: LVL (player|level)
        style: dmd_small
        anchor_x: left
        anchor_y: bottom
        x: left+2
        y: 2
  base_ball_widget:
      - type: text
        text: BALL (ball)
        style: dmd_small
        x: right-2
        y: 2
        anchor_x: right
        anchor_y: bottom
  levelup_mission:
    - type: text
      text: (last_mission)
      style: dmd_small
      anchor_y: bottom
      y: 3
