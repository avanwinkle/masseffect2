#config_version=5
mode:
  start_events: ball_starting
  stop_events: ball_will_end
  # code: base.Base
  priority: 100

config:
  - base_debug.yaml
  - base_endsounds.yaml
  - base_medigel.yaml

achievements:
  # SHADOW BROKER
  chase:
    enable_events: logicblock_sbdrops_counter_hit{count==3}
    start_events: mode_shadowbroker_chase_started
    stop_events: mode_shadowbroker_chase_will_stop
    complete_events: shadowbroker_chase_complete
  vasir:
    enable_events: shadowbroker_chase_complete
    start_events: mode_shadowbroker_vasir_started
    stop_events: mode_shadowbroker_vasir_will_stop
    complete_events: shadowbroker_vasir_complete
  hagalaz:
    enable_events: logicblock_sbdrops_counter_complete
    start_events: mode_shadowbroker_hagalaz_started
    stop_events: mode_shadowbroker_hagalaz_will_stop
    complete_events: shadowbroker_hagalaz_complete
  shadowbroker:
    enable_events: shadowbroker_hagalaz_complete
    start_events: mode_shadowbroker_boss_started
    stop_events: mode_shadowbroker_boss_will_stop
    complete_events: shadowbroker_boss_complete
  # MULTIBALLS
  overlord:
    enable_events: multiball_lock_overlordlock_full
    start_events: mode_overlordmultiball_started
    stop_events: mode_overlordmultiball_stopped
    complete_events: logicblock_jackpots_hit_counter_hit{count==3}
  # COLLECTOR MISSIONS
  collectorship:
    enable_events: enable_collectorship
    start_events: mode_collectorship_base_started
    stop_events: mode_collectorship_base_stopped
    complete_events:
      - collectorship_praetorian_complete # Track the first praetorian completion to award a levelup
      # - mode_collectorship_base_stopped # Once the mode has been played, the achievement is complete
  derelictreaper:
    enable_events: enable_derelictreaper
    start_events: start_mode_derelictreaper
  collectorattack:
    enable_events: enable_collectorattack
    start_events: mode_collectorattack_started
    complete_events: mode_collectorattack_stopped # Only played once, completed after playing
  # SUICIDE MISSION
  suicidemission:
    enable_events: enable_suicidemission
    start_events: mode_suicidemission_base_started
    stop_events: mode_suicidemission_base_stopped
    complete_events: suicidemission_complete

event_player:
  mode_base_started:
    - start_mode_global
    - start_mode_lockhandler
    - start_mode_environment
    - enable_orbitswitches
    - flippers_on
  mode_base_will_stop:
    - stop_mode_global
    - stop_mode_lockhandler
    - stop_mode_environment
    - stop_wizards
    - flippers_off
  mode_type_wizard_started:
    - stop_mode_global
  mode_type_wizard_stopped{not mode.base.stopping}:
    - start_mode_global

  # When we have 6 squadmates (aka 4 recruits completed), go to collector ship
  player_squadmates_count{current_player.squadmates_count == 6}:
    - enable_collectorship
  missionselect_collectorship_selected:
    - start_mode_collectorship_base
  fullorbit_enter_hit:
    - enable_gates
    - disable_orbitswitches
    - disable_gates|900ms
    - enable_orbitswitches|900ms
  # From an auto-plunger launch, open the gates and disable the switches
  # TODO: don't open the gates during multiball, to keep left orbit open for shots
  fullorbit_fromplunger_hit:
    - enable_gates
    - disable_orbitswitches
    - disable_gates|1500ms
    - enable_orbitswitches|2000ms
  # From a plunger launch, disable orbit switches to avoid cheat-easy hits
  s_plunger_lane_inactive:
    - disable_orbitswitches
    - enable_orbitswitches|2000ms
  # From a plunger orbit launch, re-enable orbit switches once left orbit is hit
  fullorbit_complete_hit:
    - enable_orbitswitches|200ms

accruals:
  recruitment_missions:
    persist_state: true
    reset_on_complete: false
    events:
      - recruit_success_garrus
      - recruit_success_grunt
      - recruit_success_jack
      - recruit_success_kasumi
      - recruit_success_legion
      - recruit_success_mordin
      - recruit_success_samara
      - recruit_success_tali
      - recruit_success_thane
      - recruit_success_zaeed

# ball_holds:
#   # This must exist in field AND wizard modes, so... put it in base?
#   shadowbroker_hold:
#     balls_to_hold: 1
#     hold_devices: bd_hold
#     enable_events:
#       - enable_shadowbroker_hold
#       - logicblock_sbchase_counter_updated{value==4}
#       - enable_hatch
#     release_one_events: release_shadowbroker_hold
#     disable_events:
#       - ball_hold_shadowbroker_hold_balls_released
#       - disable_shadowbroker_hold
#     debug: true

ball_saves:
  default:
    active_time: 20s
    grace_period: 2s
    hurry_up_time: 5s
    enable_events:
      - mode_base_started
    timer_start_events:
      - balldevice_bd_plunger_ball_eject_success #mode_base_started
    disable_events:
      - ball_will_end
      - ball_save_recruitsave_enabled # Only allow one active save at a time
    auto_launch: true
    balls_to_save: 1
    early_ball_save_events: s_outlane_left_active, s_outlane_right_active

variable_player:
  levelup:
    level: 1
  recruit_success:
    available_missions: -1
  enable_collectorship:
    available_missions: 1
  mode_collectorship_base_stopped:
    available_missions: -1
  # If a new mission becomes available, disable the bypass
  player_available_missions{value>0}:
    bypass_missionselect:
      action: set
      int: 0

shots:
# These "core" shots for the main shots
# This way, the mode-specific shots can always be enabled and show shows, but
# they won't trigger hits unless the underlying core shot is enabled. This allows
# us to use global methods of disabling core shots, e.g. ball save and full orbit,
# without having to duplicate the logic in modes or re-sync mode shot shows.
  sh_left_ramp:
    switch: s_left_ramp_exit
  sh_left_orbit:
    switch: s_left_orbit
    enable_events: enable_orbitswitches, enable_leftorbit
    disable_events: disable_orbitswitches
  sh_right_ramp:
    switch: s_right_ramp_exit
  sh_right_orbit:
    switch: s_right_orbit
    enable_events: enable_orbitswitches, enable_rightorbit
    disable_events: disable_orbitswitches
  sh_spinner:
    switch: s_spinner
    enable_events: enable_orbitswitches
    disable_events: disable_orbitswitches
  sh_kickback:
    switch: s_kickback
  sh_hitbank_top:
    switch: s_hitbank_top
  sh_hitbank_bottom:
    switch: s_hitbank_bottom
  sh_dropbank_top:
    switch: s_dropbank_top
  sh_dropbank_middle:
    switch: s_dropbank_middle
  sh_dropbank_bottom:
    switch: s_dropbank_bottom
  # Other commonly-used or commonly-behaving shots
  fullorbit_enter:
    switches: s_left_orbit, s_right_orbit
    enable_events: enable_fullorbit
    disable_events: disable_fullorbit
  fullorbit_fromplunger:
    hit_events: balldevice_bd_plunger_ejecting_ball
    enable_events: enable_fullorbit
    disable_events: disable_fullorbit
  # Re-enable orbit switches IMMEDIATELY if the ball moves from plunger to
  # left orbit, i.e. completes an orbit. It could be hit up to right orbit very
  # quickly, faster than the normal orbit timeout
  fullorbit_complete:
    switch: s_left_orbit
    enable_events: fullorbit_fromplunger_hit
    disable_events: enable_orbitswitches

sequence_shots:
  left_to_right_orbit:
    switch_sequence: s_spinner, s_left_orbit, s_right_orbit
    sequence_timeout: 800ms # How long to finish the orbit?
                            # How fast to fall down left orbit and get shot up?

show_player:
  ball_save_default_enabled:
    ball_save_preshow:
      action: play
  ball_save_default_timer_start:
    ball_save_preshow:
      action: stop
    ball_save_show:
      action: play
      speed: 3
      priority: 10
  ball_save_default_hurry_up:
    ball_save_show:
      action: play
      speed: 9
  ball_save_default_grace_period:
    ball_save_show:
      action: stop
  ball_save_default_disabled:
    ball_save_show:
      action: stop

shows:
  ball_save_preshow:
    - lights:
        l_ball_save: on
  ball_save_show:
    - time: 0
      lights:
        l_ball_save:
          color: black
    - time: '+1'
      lights:
        l_ball_save:
          color: white
  flash_all_shields_show:
    - time: 0
      lights:
        l_left_orbit_shield_rgb: (color)
        l_left_ramp_shield_rgb: (color)
        l_kickback_shield_rgb: (color)
        l_right_ramp_shield_rgb: (color)
        l_right_orbit_shield_rgb: (color)
        l_dropbank_shield_rgb: (color)
        l_hitbank_shield_rgb: (color)
    - time: '+1'
      lights:
        l_left_orbit_shield_rgb: black
        l_left_ramp_shield_rgb: black
        l_kickback_shield_rgb: black
        l_right_ramp_shield_rgb: black
        l_right_orbit_shield_rgb: black
        l_dropbank_shield_rgb: black
        l_hitbank_shield_rgb: black
        l_null: (color)
    - time: '+1'
  flash_color_show:
    - time: 0
      lights:
        (leds): (color)
    - time: '+1'
      lights:
        (leds): black
        l_null: (color)
  flasher_show_single:
    - duration: 200ms
      flashers:
        (flashers): 120ms
    - duration: 10s
  flasher_show_double:
    - duration: 200ms
      flashers:
        (flashers): 120ms
    - duration: 200ms
      flashers:
        (flashers): 120ms
    - duration: 10s
  flasher_show_triple:
    - duration: 200ms
      flashers:
        (flashers): 120ms
    - duration: 200ms
      flashers:
        (flashers): 120ms
    - duration: 200ms
      flashers:
        (flashers): 120ms
    - duration: 10s
  color_on:
    - lights:
        (leds): (color)
  color_off:
    - lights:
        (leds): black
        l_null: (color)

slide_player:
  levelup:
    levelup_slide:
      expire: 4s
      priority: 10000
  n7_assignment_shot_hit:
    n7_complete_slide:
      priority: 600
      expire: 3s

slides:
  levelup_slide:
    widgets:
      - type: text
        text: LEVEL UP!
        font_size: 14
        style: dmd_big
        anchor_y: bottom
        y: 10
        z: 100
      - type: rectangle
        height: 32
        width: 128
        color: black
        z: 10
  n7_complete_slide:
    widgets:
      - type: text
        text: Assignment Complete!

sound_player:
  s_plunger_lane_inactive: galaxy_whoosh
  levelup:
    music_mission_success:
      action: play
      priority: 2 # Field music is 1, so this trumps only that

sounds:
  galaxy_whoosh:
    file: sfxgame.Wwise_Generic_Galaxy_Map.gui_galaxy_whoosh_long.ogg
    track: sfx
  music_mission_success:
    file: mus_gui_mission_completion.ogg
    track: levelup # Use a special track to avoid music fadeout conflicts
    loop: 0
    fade_in: 500ms
    fade_out: 1s
    ducking:
      target: music
      delay: 2s
      attack: 2s
      attenuation: 0
      release_point: 5s
      release: 3s

track_player:
  ball_will_end:
    __all__:
      action: stop_all_sounds
      fade: 500ms

widget_player:
  levelup:
    levelup_mission:
      slide: levelup_slide

widgets:
  levelup_mission:
    - type: text
      text: (mission_name)
      style: dmd_small
      anchor_y: bottom
      y: 3
