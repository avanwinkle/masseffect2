#config_version=5

#####
# COLLECTOR SHIP: AMBUSH PHASE
#
# This phase lights all shots on a hurryup and is completed when all shots have
# been hit once. This is the first phase of the Collector Ship multiball, and
# each shot hit will add a ball (up to the multiball maximum).
#
# Scoring is based on the hurryup value, which resets every time a shot is hit.
#
# This mode will end if the multiball ends.
#####

mode:
  start_events: start_mode_collectorship_ambush
  stop_events: stop_mode_collectorship_ambush
  priority: 500

event_player:
  ship_shots_complete: mode_collectorship_ambush_complete
  # The below event has not been vetted and probably doesn't work yet
  ship_shots_hit{game.balls_in_play<4}: collectorship_add_ball

scoring:
  mode_collectorship_ambush_started:
    temp_hurryup_value:
      action: set
      score: 1000
  ship_shots_ship_shot_profile_lit_hit:
   temp_hurryup_value: 1000 * current_player.collectorship_ambush_shipshottimer_tick
  mode_collectorship_ambush_will_stop:
    score: current_player.temp_hurryup_value

shot_groups:
  ship_shots:
    shots: ship_left_ramp, ship_left_orbit, ship_right_ramp, ship_right_orbit, ship_kickback

shot_profiles:
  ship_shot_profile:
    states:
      - name: lit
        show: ship_lit_show
      - name: hit
        show: off

shots:
  ship_left_ramp:
    hit_events: sh_left_ramp_hit
    profile: ship_shot_profile
    show_tokens:
      led: l_left_ramp_shield_rgb
  ship_left_orbit:
    hit_events: sh_left_orbit_hit
    profile: ship_shot_profile
    show_tokens:
      led: l_left_orbit_shield_rgb
  ship_right_ramp:
    hit_events: sh_right_ramp_hit
    profile: ship_shot_profile
    show_tokens:
      led: l_right_ramp_shield_rgb
  ship_right_orbit:
    hit_events: sh_right_orbit_hit
    profile: ship_shot_profile
    show_tokens:
      led: l_right_orbit_shield_rgb
  ship_kickback:
    hit_events: sh_kickback_hit
    profile: ship_shot_profile
    show_tokens:
      led: l_kickback_shield_rgb

shows:
  ship_lit_show:
    - time: 0
      lights:
        (led): 992600
    - time: 0.5s
      lights:
        (led): black

timers:
  shipshottimer:
    start_value: 25
    end_value: 1
    tick_interval: 0.5s
    direction: down
    start_running: yes
    control_events:
      - event: ship_shots_ship_shot_profile_lit_hit
        action: add
        value: 24
      - event: stop_mode_collectorship_ambush
        action: stop

widget_player:
  mode_collectorship_ambush_started:
    collectorship_debug:
      target: window
  shipshottimer_start: shipshottimer_remaining_widget
  shipshottimer_tick:
    shipshottimer_remaining_widget:
      action: update
  stop_mode_collectorship_ambush:
    collectorship_debug:
      action: remove

widgets:
  shipshottimer_remaining_widget:
    - type: text
      text: (ticks_remaining)
      anchor_x: left
      anchor_y: top
      x: left+2
      y: top-2
      font_size: 8
  collectorship_debug:
    - type: text
      text: "Build Value: (player|ambush_buildvalue)"
      anchor_x: left
      anchor_y: bottom
      x: 10
      y: 10
    - type: text
      text: "Timer: (player|collectorship_ambush_shipshottimer_tick)"
      anchor_x: left
      anchor_y: bottom
      x: 460
      y: 10
