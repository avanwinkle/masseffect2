#config_version=5

#####
# COLLECTOR SHIP: AMBUSH PHASE
#
# This phase lights all shots on a hurryup and is completed when all shots have
# been hit once. This is the first phase of the Collector Ship multiball, and
# each shot hit will add a ball (up to the multiball maximum).
#
# Scoring is based on the hurryup value, which resets every time a shot is hit.
#
# This mode will end if the multiball ends.
#####

mode:
  start_events: start_mode_collectorship_ambush
  stop_events: stop_mode_collectorship_ambush
  priority: 500

event_player:
  ship_shots_complete: collectorship_ambush_complete
  # The below event has not been vetted and probably doesn't work yet
  ship_shots_lit_hit{game.balls_in_play<4}: collectorship_add_ball
  collectorship_ambush_complete: stop_mode_collectorship_ambush

variable_player:
  mode_collectorship_ambush_started:
    temp_hurryup_value:
      action: set
      int: 12000
  ship_shots_lit_hit:
    score: current_player.temp_hurryup_value
    temp_hurryup_value:
     action: add
     int: 12000
  timer_ambushtimer_tick{current_player.temp_hurryup_value > 0}:
    temp_hurryup_value: -250

counters:
  collector_shots_counter:
    starting_count: 5
    count_complete_value: 0
    direction: down
    count_events: ship_shots_lit_hit

shot_groups:
  ship_shots:
    shots: ship_left_ramp, ship_left_orbit, ship_right_ramp, ship_right_orbit, ship_kickback

shot_profiles:
  ship_shot_profile:
    states:
      - name: lit
        show: ship_lit_show
      - name: hit
        show: off

shots:
  ship_left_ramp:
    hit_events: sh_left_ramp_hit
    reset_events: mode_collectorship_ambush_started
    profile: ship_shot_profile
    show_tokens:
      led: l_left_ramp_shield_rgb
  ship_left_orbit:
    hit_events: sh_left_orbit_hit
    reset_events: mode_collectorship_ambush_started
    profile: ship_shot_profile
    show_tokens:
      led: l_left_orbit_shield_rgb
  ship_right_ramp:
    hit_events: sh_right_ramp_hit
    reset_events: mode_collectorship_ambush_started
    profile: ship_shot_profile
    show_tokens:
      led: l_right_ramp_shield_rgb
  ship_right_orbit:
    hit_events: sh_right_orbit_hit
    reset_events: mode_collectorship_ambush_started
    profile: ship_shot_profile
    show_tokens:
      led: l_right_orbit_shield_rgb
  ship_kickback:
    hit_events: sh_kickback_hit
    reset_events: mode_collectorship_ambush_started
    profile: ship_shot_profile
    show_tokens:
      led: l_kickback_shield_rgb


show_player:
  mode_collectorship_ambush_started:
    flasher_show_double|3s:
      key: ambush_flasher_battering
      speed: 0.9
      show_tokens:
        flashers: l_flash_battering_ram
    flasher_show_triple|4s:
      key: ambush_flasher_dragon
      speed: 1.35
      show_tokens:
        flashers: l_flash_dragon_left
    flasher_show_single:
      key: ambush_flasher_backpanel
      speed: 1.7
      show_tokens:
        flashers: l_flash_back_panel_left
    ambush_show:
      action: play
  stop_mode_collectorship_ambush:
    ambush_flasher_backpanel:
      action: stop
    ambush_flasher_dragon:
      action: stop
    ambush_flasher_battering:
      action: stop
    ambush_show:
      action: stop

shows:
  ambush_show:
    - duration: 2s
      lights:
        l_dragon_fire:
          color: FFFFFF
          fade: 50ms
    - duration: 2ms
      lights:
        l_dragon_fire:
          color: 444444
          fade: 300ms
  ship_lit_show:
    - duration: 250ms
      lights:
        (led): 551100
    - duration: 500ms
      lights:
        (led): black

sound_player:
  logicblock_collector_shots_counter_hit{count==1}:
    squadmate_just_one_left:
      action: play
      volume: 1

sound_pools:
  squadmate_just_one_left:
    track: voice
    type: random
    ducking:
      target: music
      delay: 0
      attenuation: 0.5
      attack: 100ms
      release: 100ms
    sounds:
      - jol_garrus_1{current_player.status_garrus==4}
      - jol_garrus_2{current_player.status_garrus==4}
      - jol_garrus_3{current_player.status_garrus==4}
      - jol_kasumi_1{current_player.status_kasumi==4}
      - jol_kasumi_2{current_player.status_kasumi==4}
      - jol_miranda_1
      - jol_miranda_2
      - jol_miranda_3

sounds:
  jol_garrus_1:
    file: en_us_hench_garrus_ss_global_hench_garrus_00303076_m.ogg
    track: voice
  jol_garrus_2:
    file: en_us_hench_garrus_ss_global_hench_garrus_00303077_m.ogg
    track: voice
  jol_garrus_3:
    file: en_us_hench_garrus_ss_global_hench_garrus_00303078_m.ogg
    track: voice
  jol_kasumi_1:
    file: DLC_HEN_MT_Int.193.ogg
    track: voice
  jol_kasumi_2:
    file: DLC_HEN_MT_Int.195.ogg
    track: voice
  jol_miranda_1:
    file: en_us_hench_vixen_ss_global_hench_vixen_00257402_m.ogg
    track: voice
  jol_miranda_2:
    file: en_us_hench_vixen_ss_global_hench_vixen_00257403_m.ogg
    track: voice
  jol_miranda_3:
    file: en_us_hench_vixen_ss_global_hench_vixen_00257404_m.ogg
    track: voice

widget_player:
  logicblock_collector_shots_counter_updated:
    collector_shots_widget:
      action: update

widgets:
  collector_shots_widget:
    - type: text
      text: "Shots: (value)"
      style: small
      anchor_y: bottom
      anchor_x: right
      y: 2
      x: right-2

timers:
  ambushtimer:
    start_value: 96
    end_value: 0
    tick_interval: 0.5s
    direction: down
    start_running: yes
    control_events:
      - event: logicblock_collector_shots_counter_hit
        action: restart
      - event: stop_mode_collectorship_ambush
        action: stop
