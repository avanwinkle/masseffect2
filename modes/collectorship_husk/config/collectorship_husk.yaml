#config_version=5

#####
# COLLECTOR SHIP: HUSK PHASE
#
# This phase lights targets to build value and shots to collect the built value.
# It runs on a fixed 60s timer and automatically advances to the Praetorian
# phase when the timer completes.
#
# This mode will also end if the multiball ends.
#####

mode:
  start_events: start_mode_collectorship_husk
  stop_events: stop_mode_collectorship_husk
  events_when_started: disable_harbinger
  priority: 500

event_player:
  mode_collectorship_husk_started.2:
    set_mission_shots:
      shots_total: 10
      is_resumable: 1
      ticks: 20
  mode_collectorship_husk_started: missiontimer_start
  husk_collect_shot_hit: mission_shot_hit
  timer_missiontimer_complete:
    - mission_collect_score
    - collectorship_husk_complete
  collectorship_husk_complete: stop_mode_collectorship_husk

random_event_player:
  husk_build_shot_hit{current_player.temp_multiplier<=2}: # the multiplier increments so we know not to keep enabling shots
    force_different: true
    force_all: false
    events:
      - enable_husk_left_ramp
      - enable_husk_left_orbit
      - enable_husk_right_ramp
      - enable_husk_right_orbit
      - enable_husk_kickback

variable_player:
  husk_build_shot_hit:
    # Hitting more build shots multiplies the value of the collected shot by 10%
    temp_multiplier:
      action: add
      float: 0.1
  husk_collect_shot_hit:
    temp_multiplier:
      action: set
      float: 1.0

light_player:
  mode_collectorship_husk_started:
    light_backwall_gi:
      color: color_husk
      fade: 500ms

shot_groups:
  husk_collect_shot:
    shots: husk_left_ramp, husk_right_ramp, husk_left_orbit, husk_right_orbit, husk_kickback

shot_profiles:
  husk_shot_profile:
    show_when_disabled: false
    show: husk_shot_show
    states:
      - name: on

shots:
  husk_build_shot:
    hit_events: sw_standuptarget_active, sw_bumper_active
  husk_left_ramp:
    hit_events: sh_left_ramp_hit
    profile: husk_shot_profile
    enable_events: enable_husk_left_ramp
    disable_events: husk_collect_shot_hit
    show_tokens:
      leds: l_left_ramp_shield_rgb
  husk_left_orbit:
    hit_events: sh_left_orbit_hit
    profile: husk_shot_profile
    enable_events: enable_husk_left_orbit
    disable_events: husk_collect_shot_hit
    show_tokens:
      leds: l_left_orbit_shield_rgb
  husk_right_ramp:
    hit_events: sh_right_ramp_hit
    profile: husk_shot_profile
    enable_events: enable_husk_right_ramp
    disable_events: husk_collect_shot_hit
    show_tokens:
      leds: l_right_ramp_shield_rgb
  husk_right_orbit:
    hit_events: sh_right_orbit_hit
    profile: husk_shot_profile
    enable_events: enable_husk_right_orbit
    disable_events: husk_collect_shot_hit
    show_tokens:
      leds: l_right_orbit_shield_rgb
  husk_kickback:
    hit_events: sh_kickback_hit
    profile: husk_shot_profile
    enable_events: enable_husk_kickback
    disable_events: husk_collect_shot_hit
    show_tokens:
      leds: l_kickback_shield_rgb

show_player:
  mode_collectorship_husk_started:
    husk_standup_show:
      action: play
  husk_build_shot_hit:
    husk_standup_flash_show:
      action: play
      loops: 6
      priority: 1
      speed: 5
    flasher_show_double:
      loops: 0
      show_tokens:
        flashers: l_flash_slingshots, l_flash_throne, l_flash_battering_ram
  husk_collect_shot_hit:
    flasher_show_triple:
      loops: 0
      show_tokens:
        flashers: l_flash_left_ramp, l_flash_sword_lock, l_flash_throne, l_flash_right_orbit
  mode_collectorship_husk_will_stop:
    husk_standup_show:
      action: stop

shows:
  husk_standup_show:
    - time: 0
      lights:
        l_targets: on
        l_flash_slingshots:
          color: 999999
  husk_standup_flash_show:
    - time: 0
      lights:
        l_targets: off
    - time: '+1'
      lights:
        l_targets: on
  husk_shot_show:
    - time: 0
      lights:
        (leds): color_husk
    - time: '+1'
      lights:
        (leds): off

sound_player:
  husk_build_shot_hit:
    husk_sound_short:
      action: play
    husk_squadmate|1s:
      action: play
      volume: 1
  husk_collect_shot_hit:
    husk_sound_long:
      action: play

sound_pools:
  # TODO: Add more squadmate sounds for husks!
  husk_squadmate:
    track: voice
    type: random
    sounds:
      - husk_garrus_1{current_player.status_garrus==4}
      - husk_garrus_2{current_player.status_garrus==4}
      - husk_grunt_1{current_player.status_grunt==4}
      - husk_grunt_2{current_player.status_grunt==4}
      - husk_jack_1{current_player.status_jack==4}
      - husk_jack_2{current_player.status_jack==4}
      - husk_kasumi_1{current_player.status_kasumi==4}
      - husk_jacob_1
      - husk_jacob_2
      - husk_miranda_1
      - husk_miranda_2
      - husk_miranda_3

sounds:
  husk_garrus_1:
    file: en_us_hench_garrus_ss_global_hench_garrus_00303132_m.ogg
    track: voice
  husk_garrus_2:
    file: en_us_hench_garrus_ss_global_hench_garrus_00303133_m.ogg
    track: voice
  husk_grunt_1:
    file: en_us_hench_grunt_ss_global_hench_grunt_00295838_m.ogg
    track: voice
  husk_grunt_2:
    file: en_us_hench_grunt_ss_global_hench_grunt_00295839_m.ogg
    track: voice
  husk_jack_1:
    file: en_us_hench_convict_ss_global_hench_convict_00296157_m.ogg
    track: voice
  husk_jack_2:
    file: en_us_hench_convict_ss_global_hench_convict_00296158_m.ogg
    track: voice
  husk_jacob_1:
    file: en_us_hench_leading_ss_global_hench_leading_00299273_m.ogg
    track: voice
  husk_jacob_2:
    file: en_us_hench_leading_ss_global_hench_leading_00299274_m.ogg
    track: voice
  husk_kasumi_1:
    file: DLC_HEN_MT_Int.101.ogg
    track: voice
  husk_miranda_1:
    file: en_us_hench_vixen_ss_global_hench_vixen_00310134_m.ogg
    track: voice
  husk_miranda_2:
    file: en_us_hench_vixen_ss_global_hench_vixen_00310135_m.ogg
    track: voice
  husk_miranda_3:
    file: en_us_hench_vixen_ss_global_hench_vixen_00310136_m.ogg
    track: voice


