#config_version=5

#####
# COLLECTOR SHIP: PRAETORIAN PHASE
#
# This is the final phase of the Collector Ship multiball and lights two random
# shots (one long lane, one close shot). Each hit randomizes two new shots; the
# player must hit four shots total to complete the mode. Completing the mode
# awards a levelup and returns to the Ambush phase for more add-a-balls.
#
# This mode features a countdown timer that restarts every time a lit shot is
# hit. If the timer runs out once, a random flipper is disabled until the player
# hits another lit shot. If the timer runs out a second time before a lit shot
# is hit, the mode fails and the multiball returns to the Husk phase.
#
# Scoring for this mode is based on the total built value from the preceeding 
# Husk phase.
#####

mode:
  start_events: start_mode_praetorian
  stop_events: stop_mode_praetorian
  priority: 500

event_player:
  mode_collectorship_praetorian_started:
    - enable_praet_main_shot
    - enable_praet_side_shot
  mode_collectorship_praetorian_will_stop: flippers_on
  praetorian_shot_hit:
    - flippers_on
    - enable_praet_main_shot
    - enable_praet_side_shot
  praet_attack_timer_complete: disable_flipper
  praetorian_hits_counter_complete: mode_collectorship_praetorian_complete

random_event_player:
  enable_praet_main_shot:
    force_different: true
    force_all: true
    events:
      - enable_praet_left_ramp
      - enable_praet_left_orbit
      - enable_praet_right_ramp
      - enable_praet_right_orbit
  enable_praet_side_shot:
    force_different: true
    force_all: false
    events:
      - enable_praet_kickback
      - enable_praet_dropbank
      - enable_praet_hitbank
  disable_flipper:
    force_different: false
    force_all: false
    events:
      - left_flipper_off
      - right_flipper_off

counters:
  praetorian_hits_counter:
    starting_count: 0
    count_complete_value: 4
    count_events:
      - praetorian_shot_hit
    direction: up
    reset_events: mode_praetorian_started

# For scoring, the temp_hurryup_value carried over from husks is our base
scoring:
  # Add a little for each shot hit
  praetorian_shot_hit: current_player.temp_hurryup_value * 0.25
  # Add a bunch for defeating the praetorian
  praetorian_hits_counter_complete: current_player.temp_hurryup_value * 10

shot_groups:
  praetorian_shot:
    shots: praet_left_ramp, praet_left_orbit, praet_right_ramp, praet_right_orbit, praet_kickback, praet_dropbank, praet_hitbank

shot_profiles:
  praet_shot_profile:
    show_when_disabled: false
    show: praet_shot_show

shots:
  praet_build_shot:
    hit_events: standuptarget_hit
  praet_left_ramp:
    hit_events: sh_left_ramp_hit
    profile: praet_shot_profile
    enable_events: enable_praet_left_ramp
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_left_ramp_shield_rgb
  praet_left_orbit:
    hit_events: sh_left_orbit_hit
    profile: praet_shot_profile
    enable_events: enable_praet_left_orbit
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_left_orbit_shield_rgb
  praet_right_ramp:
    hit_events: sh_right_ramp_hit
    profile: praet_shot_profile
    enable_events: enable_praet_right_ramp
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_right_ramp_shield_rgb
  praet_right_orbit:
    hit_events: sh_right_orbit_hit
    profile: praet_shot_profile
    enable_events: enable_praet_right_orbit
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_right_orbit_shield_rgb
  praet_kickback:
    hit_events: sh_kickback_hit
    profile: praet_shot_profile
    enable_events: enable_praet_kickback
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_kickback_shield_rgb
  # These are trying to use the "dropbank" device object, but dunno if it'll work?
  praet_dropbank:
    hit_events: drop_target_top_down, drop_target_middle_down, drop_target_bottom_down
    profile: praet_shot_profile
    enable_events: enable_praet_dropbank
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_dropbank_shield_rgb
  praet_hitbank:
    hit_events: sh_hitbank_top_hit, sh_hitbank_bottom_hit
    profile: praet_shot_profile
    enable_events: enable_praet_hitbank
    disable_events: praetorian_shot_hit
    show_tokens:
      led: l_hitbank_shield_rgb

shows:
  praet_shot_show:
    - time: 0
      lights:
        (led): purple
    - time: '+1'
      lights:
        (led): off

timers:
  praet_attack_timer:
    start_value: 25
    end_value: 0
    tick_interval: 1s
    direction: down
    start_running: yes
    restart_on_complete: true
    control_events:
      - event: stop_mode_collectorship_praetorian
        action: stop
      - event: praetorian_shot_hit
        action: restart
