#config_version=5

#####
# Bumpers: Field
#
# This field mode tracks bumper hits to enable N7 assignments during field mode,
# except for when the collector attack achievement is enabled. During that time,
# the bumper hits countdown to the IFF test and triggers the Normandy Attack
# mode when complete. After, the N7 assignments come back.
#####

event_player:
  logicblock_n7_hits_counter_complete: start_mode_n7_assignments
  logicblock_iff_counter_complete: start_mode_normandyattack
  # Force an event to show n7/iff count when the first bumper hits
  # TBD if somebody else is listening for "hit" events we might get bad results
  slide_minerals_slide_active:
    logicblock_n7_hits_counter_hit{device.achievements.normandyattack.state!="enabled"}:
      count:
        value: device.counters.n7_hits_counter.value
    logicblock_iff_counter_hit{device.achievements.normandyattack.state=="enabled"}:
      count:
        value: device.counters.iff_counter.value

counters:
  n7_hits_counter:
    starting_count: 30 + (5 * current_player.assignments_completed)
    count_complete_value: 0
    direction: down
    count_events: n7_advance_shot_hit
    reset_events:
      - logicblock_iff_counter_complete # Reset the counter after IFF
      - player_assignments_completed{change!=0} # Reset when an assignment is completed to increase count
    disable_on_complete: false
    reset_on_complete: true
    persist_state: true
    # TODO: Validate that this counter state persists on a per-player basis
  iff_counter:
    starting_count: 30
    count_complete_value: 0
    direction: down
    count_events: iff_advance_shot_hit
    persist_state: true

shots:
  n7_advance_shot:
    switches: s_bumper_bottom, s_bumper_right, s_bumper_left
    enable_events: mode_field_started{device.achievements.normandyattack.state!="enabled"}
    # Won't automatically re-disable on mode start, so explicitly disable
    disable_events:
      - achievement_normandyattack_state_enabled
      - mode_field_started{device.achievements.normandyattack.state=="enabled"}
  iff_advance_shot:
    switches: s_bumper_bottom, s_bumper_right, s_bumper_left
    enable_events: mode_field_started{device.achievements.normandyattack.state=="enabled"}
    disable_events: logicblock_iff_counter_complete

sound_player:
  logicblock_iff_counter_hit.1{count==25}: joker_iff_ready_to_go
  logicblock_iff_counter_hit.2{count==15}: edi_iff_almost_ready

sounds:
  edi_iff_almost_ready:
    file: en_us_hench_ai_norcr3_edi_hints_a_00344755_m.ogg
    track: voice
    volume: 0.9
  joker_iff_ready_to_go:
    file: en_us_hench_joker_norcr3_joker_shuttle_d_00192591_m.ogg
    track: voice
