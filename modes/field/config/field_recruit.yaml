#config_version=5

#####
# RECRUIT FIELD MODE
#
# This mode is the "generic" gameplay experience, i.e. what's happening when no
# other mode is active. It's got logic for lighting all the recruitment mission
# shots and tracking the hit counts for each of them.
#
# For now, it also has responsibility for the N7 Assignments counter and mode
# start logic, because we will only want to start N7 Assignments when we're
# in Recruit Field mode (i.e. never during any other mode)
#####

mode:
  events_when_started: disable_fullorbit
  events_when_stopped: enable_fullorbit

config:
  - field_recruit_sounds.yaml
  - field_recruit_shows.yaml

event_player:
  play_queued_slide_recruit_advance_slide_1:
    - play_recruit_advance_(squadmate)|50ms
    - remove_popup|4s
  play_queued_slide_recruit_advance_slide_2:
    - play_recruit_advance_(squadmate)|50ms
    - remove_popup|4s
  play_queued_slide_recruit_advance_slide_3:
    - play_recruit_advance_(squadmate)|50ms
    - remove_popup|4s

variable_player:
  recruit_advance:
    score: 500

shot_profiles:
  recruit_shot_profile:
    show_when_disabled: false
    show: color_on
    states:
      - name: active

shots:
  recruit_garrus_shot:
    hit_events: sh_left_ramp_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_garrus<3}
    disable_events:
      - recruit_lit{squadmate=="garrus"}
    show_tokens:
      leds: shot_shield_garrus
      color: 0055FF #color_garrus
    tags: envshot_left_ramp
  recruit_grunt_shot:
    hit_events: sh_left_orbit_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_grunt<3}
    disable_events:
      - recruit_lit{squadmate=="grunt"}
    show_tokens:
      leds: shot_shield_grunt
      color: FF6611 #color_grunt
    tags: envshot_left_orbit
  recruit_jack_shot:
    hit_events: sh_kickback_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_jack<3}
    disable_events:
      - recruit_lit{squadmate=="jack"}
    show_tokens:
      leds: shot_shield_jack
      color: 4D00CC #color_jack
    tags: envshot_kickback
  recruit_kasumi_shot:
    hit_events: sh_right_ramp_hit
    profile: recruit_shot_profile
    enable_events:
      # No kasumi on casual mode
      - mode_field_started{current_player.status_kasumi<3 and current_player.casual==0}
    disable_events:
      - recruit_lit{squadmate=="kasumi"}
    show_tokens:
      leds: shot_shield_kasumi
      color: EEFF00 #color_kasumi
    tags: envshot_right_ramp
  recruit_legion_shot:
    hit_events: sh_kickback_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_jack>3 and current_player.status_legion<3}
    disable_events:
      - recruit_lit{squadmate=="legion"}
    show_tokens:
      leds: shot_shield_legion
      color: FFFFFF #color_legion
    tags: envshot_kickback
  recruit_mordin_shot:
    hit_events: sh_right_orbit_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_mordin<3}
    disable_events:
      - recruit_lit{squadmate=="mordin"}
    show_tokens:
      leds: shot_shield_mordin
      color: 440000 #color_mordin
    tags: envshot_right_orbit
  recruit_samara_shot:
    hit_events: sh_left_ramp_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_garrus>3 and current_player.status_samara<3}
    disable_events:
      - recruit_lit{squadmate=="samara"}
    show_tokens:
      leds: shot_shield_samara
      color: 008899 #color_samara
    tags: envshot_left_ramp
  recruit_tali_shot:
    hit_events: sh_right_orbit_hit
    profile: recruit_shot_profile
    enable_events:
      - mode_field_started{current_player.status_mordin>3 and current_player.status_tali<3}
    disable_events:
      - recruit_lit{squadmate=="tali"}
    show_tokens:
      leds: shot_shield_tali
      color: FF11DD #color_tali
    tags: envshot_right_orbit
  recruit_thane_shot:
    hit_events: sh_right_ramp_hit
    profile: recruit_shot_profile
    enable_events:
      # If casual mode, thane lights after grunt. Otherwise, thane lights after kasumi.
      - mode_field_started{(current_player.status_kasumi>3 if current_player.casual==0 else current_player.status_grunt>3) and current_player.status_thane<3}
    disable_events:
      - recruit_lit{squadmate=="thane"}
    show_tokens:
      leds: shot_shield_thane
      color: 00FF11 #color_thane
    tags: envshot_right_ramp
  recruit_zaeed_shot:
    hit_events: sh_left_orbit_hit
    profile: recruit_shot_profile
    enable_events:
      # No zaeed on casual mode
      - mode_field_started{current_player.status_grunt>3 and current_player.status_zaeed<3 and current_player.casual==0}
    disable_events:
      - recruit_lit{squadmate=="zaeed"}
    show_tokens:
      leds: shot_shield_zaeed
      color: FF7700 #color_zaeed
    tags: envshot_left_orbit

# slide_player:
#   # Use queue playback of main slides to show portraits
#   play_queued_widget_recruit_advance_widget_1:
#     portrait_slide_advance:
#       target: lcd_right
#       priority: 200
#       expire: 4s

# slides:
#   portrait_slide_advance:
#     - widget: portrait_widget_(squadmate)_advance

widget_player:
  play_queued_slide_recruit_advance_widget_1:
    portrait_widget_advance:
      target: lcd_right
      widget_settings:
        expire: 4s
        z: 200
  play_queued_slide_recruit_advance_widget_2:
    portrait_widget_advance:
      target: lcd_right
      widget_settings:
        expire: 4s
        z: 200
  play_queued_slide_recruit_advance_widget_3:
    portrait_widget_advance:
      target: lcd_right
      widget_settings:
        expire: 4s
        z: 200

widgets:
  portrait_widget_advance:
    - widget: portrait_widget_(squadmate)_advance
  portrait_widget_complete:
    - widget: portrait_widget_(squadmate)_complete
  portrait_widget_garrus_advance:
    - type: image
      image: portrait_garrus_recruit
  portrait_widget_grunt_advance:
    - type: image
      image: portrait_grunt_recruit
  portrait_widget_jack_advance:
    - type: image
      image: portrait_jack_recruit
      # TODO: fade out the galaxy map instead of fading in every widget popup
      opacity: 0
      animations:
        add_to_slide: portrait_enter_animation
        remove_popup: portrait_exit_animation
  portrait_widget_kasumi_advance:
    - type: image
      image: portrait_kasumi_recruit
  portrait_widget_legion_advance:
    - type: image
      image: portrait_legion_recruit
  portrait_widget_mordin_advance:
    - type: image
      image: portrait_mordin_recruit
  portrait_widget_samara_advance:
    - type: image
      image: portrait_samara_recruit
  portrait_widget_tali_advance:
    - type: image
      image: portrait_tali_recruit
  portrait_widget_thane_advance:
    - type: image
      image: portrait_thane_recruit
  portrait_widget_zaeed_advance:
    - type: image
      image: portrait_zaeed_recruit
