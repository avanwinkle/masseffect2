#config_version=5

#####
# OVERLORD & ARRIVAL LIGHT MODE
#
# This mode handles the ball lock advancement for the Overlord and Arrival
# multiballs, using shots and events to light lock, enable devices, and
# illuminate indicators.
#
# This is a separate mode to help debug the complex multiball_lock/ball_hold
# combo logic, but eventually this mode may be integrated with another base
# or ball-lock common mode.
#####

event_player:
  # This needs to be in event_player because mpf-mc controls sound_player and
  # doesn't have access to machine modes
  overrival_lightshot_hit:
    - play_overlord_hit_sound{device.achivements.collectorship.state!="completed"}
    - play_arrival_hit_sound{device.achivements.collectorship.state=="completed"}
  enable_overrival_lock{mode.field.active and device.achivements.collectorship.state!="completed"}: # player_shot_overlord_lock_ball_shot_enabled{mode.field.active}:
    - play_overlord_station_sound_1{device.ball_devices.bd_lock.balls==0}|1.5s
    - play_overlord_station_sound_2{device.ball_devices.bd_lock.balls==1}|1.5s
    - play_overlord_station_sound_3{device.ball_devices.bd_lock.balls==2}|1.5s
  enable_overrival_lock{mode.field.active and device.achivements.collectorship.state=="completed"}: # player_shot_overlord_lock_ball_shot_enabled{mode.field.active}:
    - play_arrival_station_sound_1{device.ball_devices.bd_lock.balls==0}|1.5s
    - play_arrival_station_sound_2{device.ball_devices.bd_lock.balls==1}|1.5s
    - play_arrival_station_sound_3{device.ball_devices.bd_lock.balls==2}|1.5s

shot_groups:
  overrival_lightshot:
    shots: light_lock_overrival_top, light_lock_overrival_bottom
    enable_events:
      - enable_lock_lightshot
      - multiball_overlord_multiball_ended
      - multiball_arrival_multiball_ended
    disable_events:
      - disable_lock_lightshot
      - multiball_overlord_multiball_started
      - multiball_arrival_multiball_ended
    reset_events: multiball_lock_overrival_locked_ball

shot_profiles:
  overrival_light_profile:
    show_when_disabled: false
    states:
      - name: unlit
        show: off
      - name: lit
        show: on

shots:
  light_lock_overrival_top:
    switch: s_hitbank_top
    profile: overrival_light_profile
    show_tokens:
      led: l_hitbank_top
  light_lock_overrival_bottom:
    switch: s_hitbank_bottom
    profile: overrival_light_profile
    show_tokens:
      led: l_hitbank_bot

show_player:
  overrival_light_shot_hit:
    overrival_lock_flash:
      priority: 100
      loops: 6
      speed: 10
  multiball_overlord_multiball_started:
    ball_save_show:
      action: play
      speed: 3
  multiball_overlord_multiball_shoot_again_ended:
    ball_save_show:
      action: stop

shows:
  overrival_lock_flash:
    - time: 0
      lights:
        l_hitbank_bot: white
        l_hitbank_top: white
    - time: '+1'
      lights:
        l_hitbank_bot: black
        l_hitbank_top: black

slide_player:
  # This show event comes from lockhandler.py
  show_overlord_locked_slide:
    overlord_ball_locked_slide:
      expire: 3s
      priority: 600 # Enough to beat recruit timer?
  show_arrival_locked_slide:
    arrival_ball_locked_slide:
      expire: 3s
      priority: 600
  multiball_overlord_multiball_started:
    overlord_ball_locked_slide_full:
      expire: 4s
  multiball_arrival_multiball_started:
    arrival_ball_locked_slide_full:
      expire: 4s

slides:
  overlord_ball_locked_slide:
    widgets:
      - type: text
        text: OVERLORD
        style: dmd_small
        anchor_y: top
        y: top-2
        z: 2
      - type: text
        text: Ball (total_balls_locked) Locked!
        style: dmd_small
        anchor_y: bottom
        y: 2
        z: 2
      - type: rectangle
        width: 128
        height: 32
        color: black
        z: 0
  overlord_ball_locked_slide_full:
    widgets:
      - type: text
        text: OVERLORD
        style: dmd_big
        anchor_y: bottom
        y: middle+2
      - type: text
        text: MULTIBALL
        style: dmd_big
        anchor_y: top
        y: middle-2
  arrival_ball_locked_slide:
    widgets:
      - type: text
        text: ARRIVAL
        style: dmd_small
        anchor_y: top
        y: top-2
        z: 2
      - type: text
        text: Ball (total_balls_locked) Locked!
        style: dmd_small
        anchor_y: bottom
        y: 2
        z: 2
      - type: rectangle
        width: 128
        height: 32
        color: black
        z: 0
  arrival_ball_locked_slide_full:
    widgets:
      - type: text
        text: ARRIVAL
        style: dmd_big
        anchor_y: bottom
        y: middle+2
      - type: text
        text: MULTIBALL
        style: dmd_big
        anchor_y: top
        y: middle-2

sound_player:
  play_overlord_hit_sound:
    geth_hit_sfx:
      action: play
      max_queue_time: 1s
  play_overlord_station_sound_1:
    archer_need_to_go_to_both:
      action: play
      max_queue_time: 1s
  play_overlord_station_sound_2:
    archer_still_need_to_go_to_prometheus:
      action: play
      max_queue_time: 1s
  play_overlord_station_sound_3:
    archer_lockdown_cancelled:
      action: play
      max_queue_time: 1s
  show_overlord_locked_slide{total_balls_locked==1}:
    vulcan_success:
      action: play
      max_queue_time: 2s
  show_overlord_locked_slide{total_balls_locked==2}:
    archer_lockdown_cancelled_short:
      action: play
      max_queue_time: 2s

sound_pools:
  geth_hit_sfx:
    sounds: geth_hit_1, geth_hit_2, geth_hit_3, geth_hit_4
    type: random_force_all
    track: sfx
  vulcan_success:
    sounds: archer_vulcan_success, shepard_hit_override_vulcan
    type: random
    track: voice
    max_queue_time: 1s
  archer_still_need_to_go_to_prometheus:
    sounds: archer_still_need_to_go_to_prometheus_1, archer_still_need_to_go_to_prometheus_2
    type: random
    track: voice
    max_queue_time: 1s
  archer_lockdown_cancelled:
    sounds: archer_lockdown_cancelled_1, archer_lockdown_cancelled_2, archer_lockdown_cancelled_3
    type: random
    track: voice
    max_queue_time: 1s

sounds:
  archer_lockdown_cancelled_1:
    file: DLC_UNC_Pack01_Int.097.ogg
    track: voice
  archer_lockdown_cancelled_2:
    file: DLC_UNC_Pack01_Int.099.ogg
    track: voice
  archer_lockdown_cancelled_3:
    file: DLC_UNC_Pack01_Int.491.ogg
    track: voice
  archer_lockdown_cancelled_short:
    file: DLC_UNC_Pack01_Int.098.ogg
    track: voice
  archer_still_need_to_go_to_vulcan_1:
    file: DLC_UNC_Pack01_Int.100.ogg
    track: voice
  archer_still_need_to_go_to_vulcan_2:
    file: DLC_UNC_Pack01_Int.485.ogg
    track: voice
  archer_still_need_to_go_to_prometheus_1:
    file: DLC_UNC_Pack01_Int.102.ogg
    track: voice
  archer_still_need_to_go_to_prometheus_2:
    file: DLC_UNC_Pack01_Int.487.ogg
    track: voice
  archer_still_need_to_go_to_both:
    file: DLC_UNC_Pack01_Int.104.ogg
    track: voice
  archer_need_to_go_to_both:
    file: DLC_UNC_Pack01_Int.484.ogg
    track: voice
  archer_prometheus_success:
    file: DLC_UNC_Pack01_Int.486.ogg
    track: voice
  archer_vulcan_success:
    file: DLC_UNC_Pack01_Int.488.ogg
    track: voice
  shepard_hit_override_vulcan:
    file: DLC_UNC_Pack01_Int.219.ogg
    track: voice
  vi_override_accepted_atlas_1:
    file: DLC_UNC_Pack01_Int.221.ogg
    track: voice
  vi_override_accepted_atlas_2:
    file: DLC_UNC_Pack01_Int.289.ogg
    track: voice
  geth_hit_1:
    file: sfx_ss_geth_trooper_ss_geth_trooper_00307868_m.ogg
    track: sfx
  geth_hit_2:
    file: sfx_ss_geth_trooper_ss_geth_trooper_00307894_m.ogg
    track: sfx
  geth_hit_3:
    file: sfx_ss_geth_trooper_ss_geth_trooper_00307881_m.ogg
    track: sfx
  geth_hit_4:
    file: sfx_ss_geth_trooper_ss_geth_trooper_00307899_m.ogg
    track: sfx

widget_player:
  show_overlord_locked_slide{total_balls_locked==1}:
    overlord_widget_ball1:
      slide: overlord_ball_locked_slide
    overlord_widget_ball2:
      action: remove
    overlord_widget_ball3:
      action: remove
  show_overlord_locked_slide{total_balls_locked==2}:
    overlord_widget_ball1:
      action: remove
    overlord_widget_ball2:
      slide: overlord_ball_locked_slide
    overlord_widget_ball3:
      action: remove
  show_overlord_locked_slide{total_balls_locked==3}:
    overlord_widget_ball1:
      action: remove
    overlord_widget_ball2:
      action: remove
    overlord_widget_ball3:
      slide: overlord_ball_locked_slide
  show_arrival_locked_slide{total_balls_locked==1}:
    arrival_widget_ball1:
      slide: arrival_ball_locked_slide
    arrival_widget_ball2:
      action: remove
    arrival_widget_ball3:
      action: remove
  show_arrival_locked_slide{total_balls_locked==2}:
    arrival_widget_ball1:
      action: remove
    arrival_widget_ball2:
      slide: arrival_ball_locked_slide
    arrival_widget_ball3:
      action: remove
  show_arrival_locked_slide{total_balls_locked==3}:
    arrival_widget_ball1:
      action: remove
    arrival_widget_ball2:
      action: remove
    arrival_widget_ball3:
      slide: arrival_ball_locked_slide

widgets:
  overlord_widget_ball1:
    - type: text
      text: Vulcan Station
      style: dmd_big
      z: 2
  overlord_widget_ball2:
    - type: text
      text: Prometheus Station
      style: dmd_big
      z: 2
  overlord_widget_ball3:
    - type: text
      text: Atlas Station
      style: dmd_big
      z: 2
  arrival_widget_ball1:
    - type: text
      text: Cooling Rods Activated
      style: dmd_big
      z: 2
  arrival_widget_ball2:
    - type: text
      text: Engines Powering On
      style: dmd_big
      z: 2
  arrival_widget_ball3:
    - type: text
      text: Escape Project Base
      style: dmd_big
      z: 2
