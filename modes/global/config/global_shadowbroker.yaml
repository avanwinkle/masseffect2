#config_version=5

#####
# LAIR OF THE SHADOW BROKER: BASE MODE
#
# This mode is the base mode for handling progress through the Shadow Broker
# side missions. It primarily handles tracking the dropbank completions and
# lighting their progress, then enabling shots to start the various modes that
# progress through the Shadow Broker story.
#
#####
mode:
  events_when_started: enable_sbdrops_counter
  events_when_stopped: disable_sbdrops_counter

event_player:
  mode_global_started:
    - manual_sbdrops_counter_advance{device.counters.sbdrops_counter.value==3 and current_player.state_machine_shadowbroker=="pre_hagalaz"}

  # QUEUE SLIDE
  logicblock_sbdrops_counter_hit:
    queue_slide{current_player.state_machine_shadowbroker=="start"}:
      priority: 2
      slide: shadowbroker_advance_slide
      portrait: shadowbroker_advance_1
      count:
        value: device.counters.sbdrops_counter.value
        type: int
    queue_slide{current_player.state_machine_shadowbroker=="pre_hagalaz"}:
      priority: 1
      slide: shadowbroker_advance_slide
      portrait: shadowbroker_advance_2
      count:
        value: device.counters.sbdrops_counter.value
        type: int
  drop_target_bank_dropbank_down{current_player.state_machine_shadowbroker=="completed"}:
    queue_slide:
      priority: 3
      slide: shadowbroker_advance_slide
      portrait: shadowbroker_advance_3
      count: 8

variable_player:
  drop_target_bank_dropbank_down:
    intel: 1
    earned_intel: 1
  # Track the value of this counter as a player variable (for saved careers)
  logicblock_sbdrops_counter_hit:
    counter_sbdrops_counter:
      action: set
      int: device.counters.sbdrops_counter.value

shot_profiles:
  sbdrops_profile:
    states:
      - name: up
      - name: down
  advance_sbdrops_profile:
    show_when_disabled: false
    show: sbdrops_show
    states:
      - name: unlit
      - name: one_lit
      - name: two_lit
      - name: three_lit

shots:
  sbdroptarget_bottom_shot:
    hit_events: drop_target_bottom_down
    reset_events: drop_target_bank_dropbank_down
    profile: sbdrops_profile
  sbdroptarget_middle_shot:
    hit_events: drop_target_middle_down
    reset_events: mode_shadowbroker_base_started, drop_target_bank_dropbank_down
    profile: sbdrops_profile
  sbdroptarget_top_shot:
    hit_events: drop_target_top_down
    reset_events: mode_shadowbroker_base_started, drop_target_bank_dropbank_down
    profile: sbdrops_profile

show_player:
  drop_target_bank_dropbank_mixed:
    sbdrops_flash:
      priority: 100
      loops: 3
      speed: 12
  drop_target_bank_dropbank_down:
    sbdrops_flash:
      priority: 100
      loops: 12
      speed: 12

shows:
  sbdrops_flash:
    - time: 0
      lights:
        l_dropbank_bottom: dropbank_color_shadowbroker
        l_dropbank_middle: dropbank_color_shadowbroker
        l_dropbank_top: dropbank_color_shadowbroker
    - time: '+1'
      lights:
        l_dropbank_bottom: black
        l_dropbank_middle: black
        l_dropbank_top: black


slides:
  shadowbroker_advance_slide:
    - type: text
      text: Lair of the Shadow Broker
      style: header_xs, row_top, col_left_anchor, mission_title
    - type: text
      text: Intel Collected
      style: header_md, row_main, col_left_anchor
    - widget: background_console

sound_player:
  # Have to deal with duplicate events until MC handles event priority with conditions
  play_queued_slide_shadowbroker_advance_slide.1{count==1}:
    shepard_sounds_like_liara_found_something_big:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide.2{count==2}:
    vasir_i_know_where_the_trade_center_is:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide.3{count==3}:
    vasir_they_took_out_three_floors:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide.4{count==4}:
    liara_shepard_im_glad_youre_here:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide.5{count==5}:
    liara_sukets_datapad_this_has_what_we_need:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide.6{count==6}:
    liara_we_can_be_at_base_in_a_few_hours:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide.7{count==7}:
    liara_land_outside_and_hunt_for_a_hatch:
      max_queue_time: 2s
  # Relays:
  play_shepard_ill_start_down_here:
    shepard_ill_start_down_here:
      max_queue_time: 2s
  play_queued_slide_shadowbroker_advance_slide{count==8}:
    glyph:
      max_queue_time: 1s

sound_pools:
  glyph:
    type: random_force_all
    track: voice
    sounds:
      - glyph_repairs_are_underway
      - glyph_i_can_log_that_in_the_archives
      - glyph_let_me_know_if_i_can_organize
      - glyph_welcome_back_shadowbroker
      - glyph_operations_almost_fully_recovered

sounds:
  shadowbroker_vasir_music:
    file: SBK.05.Vasir_Combat.ogg
    track: music
    fade_out: 1s
    loops: -1
  # Dropbanks for Vasir
  shepard_sounds_like_liara_found_something_big:
    file: DLC_EXP_Part01_Int.143.ogg
    track: voice
  shepard_ive_got_something_here:
    file: DLC_EXP_Part01_Int.146.ogg
    track: voice
  shepard_liara_knew_i_was_coming:
    file: DLC_EXP_Part01_Int.179.ogg
    track: voice
  shepard_liaras_in_there:
    file: DLC_EXP_Part01_Int.636.ogg
    track: voice
  shepard_ill_start_down_here:
    file: DLC_EXP_Part01_Int.628.ogg
    track: voice
  vasir_i_know_where_the_trade_center_is:
    file: DLC_EXP_Part01_Int.169.ogg
    track: voice
  vasir_they_took_out_three_floors:
    file: DLC_EXP_Part01_Int.634.ogg
    events_when_stopped: play_shepard_ill_start_down_here
    track: voice
  # After Vasir
  liara_shepard_im_glad_youre_here:
    file: DLC_EXP_Part01_Int.871.ogg
    track: voice
    volume: 1
  # Dropbanks for Hagalaz
  liara_sukets_datapad_this_has_what_we_need:
    file: DLC_EXP_Part01_Int.797.ogg
    track: voice
    volume: 1
  liara_sb_agents_still_shooting_illium:
    file: DLC_EXP_Part01_Int.878.ogg
    track: voice
    volume: 1
  liara_well_need_normandy_stealth_system:
    file: DLC_EXP_Part01_Int.879.ogg
    track: voice
    volume: 1
  liara_i_can_get_us_there:
    file: DLC_EXP_Part01_Int.885.ogg
    track: voice
    volume: 1
  liara_we_can_be_at_base_in_a_few_hours:
    file: DLC_EXP_Part01_Int.884.ogg
    track: voice
    volume: 1
  liara_land_outside_and_hunt_for_a_hatch:
    file: DLC_EXP_Part01_Int.944.ogg
    track: voice
    volume: 1
  glyph_operations_almost_fully_recovered:
    file: DLC_EXP_Part01_Int.1289.ogg
    track: voice
  glyph_i_can_log_that_in_the_archives:
    file: DLC_EXP_Part01_Int.1291.ogg
    track: voice
  glyph_repairs_are_underway:
    file: DLC_EXP_Part01_Int.1314.ogg
    track: voice
  glyph_let_me_know_if_i_can_organize:
    file: DLC_EXP_Part01_Int.1316.ogg
    track: voice
  glyph_welcome_back_shadowbroker:
    file: DLC_EXP_Part01_Int.1317.ogg
    track: voice

widgets:
  portrait_shadowbroker_advance_1:
    - type: image
      image: portrait_shadowbroker_advance_1
  portrait_shadowbroker_advance_2:
    - type: image
      image: portrait_shadowbroker_advance_2
  portrait_shadowbroker_advance_3:
    - type: image
      image: portrait_shadowbroker_advance_3
