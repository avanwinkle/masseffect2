#config_version=5

#####
# MISSION SELECT MODE
#
# This is a game logic mode to present a selection carousel to the player when
# missions are available for them to play. Usually this means any of the
# recruitment missions they've unlocked, but also Collecter Ship and the Suicide
# Mission will be present here.
#
# Due to the arbitrary nature of which missions are available, this mode uses
# a custom Python class (missionselect.py) to assess the state of each squadmate
# and dynamically populate the carousel items when the mode starts.
#####

mode:
  start_events: start_mode_missionselect
  stop_events: stop_mode_missionselect, missionselect_item_selected
  priority: 1000
  code: missionselect.MissionSelect
  file_log: full
  ##### Look into this:
  # Possible queue events:
  #   outgoing_balls_handler: balldevice_(name)_ball_eject_attempt
  #   mode: mode_(name)_starting, mode_(name)_stopping
  use_wait_queue: true

mode_settings:
  # All squadmates are included via missionselect.py, no need to list them here
  selectable_items: pass, suicide
  select_item_events: s_action_button_active
  next_item_events: s_flipper_right_active, missionselect_skip_forwards, mode_missionselect_started
  previous_item_events: s_flipper_left_active, missionselect_skip_backwards

event_player:
  mode_missionselect_started:
    - disable_recruit_shots
    - flippers_off
  missionselect_item_selected:
    - enable_recruit_shots
    - flippers_on

show_player:
  mode_missionselect_started: missionselect_show
  mode_missionselect_will_stop:
    missionselect_show:
      action: stop
    missionselect_highlight_show:
      action: stop
  missionselect_pass_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: black
  missionselect_collectorship_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: FF2200
  missionselect_recruit_highlighted:
    missionselect_highlight_show{squadmate=="garrus"}:
      show_tokens:
        leds: shot_shield_garrus
        color: 0055FF
    missionselect_highlight_show{squadmate=="grunt"}:
      show_tokens:
        leds: shot_shield_grunt
        color: BB1100
    missionselect_highlight_show{squadmate=="jack"}:
      show_tokens:
        leds: shot_shield_jack
        color: 4D00CC #color_jack
    missionselect_highlight_show{squadmate=="kasumi"}:
      show_tokens:
        leds: shot_shield_kasumi
        color: EEFF00 #color_kasumi
    missionselect_highlight_show{squadmate=="legion"}:
      show_tokens:
        leds: shot_shield_legion
        color: FFFFFF #color_legion
    missionselect_highlight_show{squadmate=="mordin"}:
      show_tokens:
        leds: shot_shield_mordin
        color: 440000 #color_mordin
    missionselect_highlight_show{squadmate=="samara"}:
      show_tokens:
        leds: shot_shield_samara
        color: 00FFAA #color_samara
    missionselect_highlight_show{squadmate=="tali"}:
      show_tokens:
        leds: shot_shield_tali
        color: FF11DD #color_tali
    missionselect_highlight_show{squadmate=="thane"}:
      show_tokens:
        leds: shot_shield_thane
        color: 00FF11 #color_thane
    missionselect_highlight_show{squadmate=="zaeed"}:
      show_tokens:
        leds: shot_shield_zaeed
        color: FF4400 #color_zaeed

shows:
  missionselect_show:
    - lights:
        gi: off
        l_left_ramp_arrow_clear: off
        l_dropbank_bottom: off
        l_dropbank_middle: off
        l_dropbank_top: off
        shot_shields: off
        l_pop_bumpers: off
        l_left_top_lane: off
        l_right_top_lane: off

  missionselect_highlight_show:
    - duration: 500ms
      lights:
        (leds): (color)
    - duration: 500ms
      lights:
        (leds): black
        (l_null): (color)

slide_player:
  mode_missionselect_started:
    missionselect_intro_slide:
      action: play
      expire: 3s
  sw_flipper_active:
    missionselect_intro_slide:
      action: remove
  missionselect_pass_highlighted: missionselect_pass_slide
  missionselect_collectorship_highlighted: missionselect_collectorship_slide
  missionselect_suicide_highlighted: missionselect_suicide_slide
  # Recruitment Missions:
  missionselect_recruit_highlighted:
    missionselect_recruit_slide:
      action: play

slides:
  missionselect_intro_slide:
    priority: 100
    widgets:
      - type: text
        text: Select a Mission
        style: quadrit_big
        anchor_y: bottom
        y: bottom+45%
      - type: text
        text: < FLIPPERS >
        anchor_y: bottom
        style: dmd_small
        y: 3
  missionselect_recruit_slide:
    priority: 1
    widgets:
      - type: text
        text: (squadmate)
        style: quadrit_big
        anchor_y: bottom
        y: bottom+45%
        casing: title
      - type: text
        text: Start Recruitment Mission
        style: dmd_small
        anchor_y: bottom
        y: 3
  missionselect_collectorship_slide:
    priority: 1
    widgets:
      - type: text
        text: Disabled
        anchor_y: bottom
        y: 50%
      - type: text
        text: Collector Vessel
        anchor_y: top
        y: 50%
  missionselect_suicide_slide:
    priority: 1
    widgets:
      - type: text
        text: LAUNCH THE
        style: dmd_small
        bold: true
        anchor_y: top
        y: top-3
      - type: text
        text: SUICIDE MISSION
        font_size: 14
        style: quadrit_big
        anchor_y: bottom
        y: 3
  missionselect_pass_slide:
    priority: 10
    widgets:
      - type: text
        text: Pass for Now
        style: quadrit_big
        anchor_y: bottom
        y: bottom+45%

scoring:
  mode_missionselect_started:
    missionselect_init:
      action: set
      score: 0
  slide_missionselect_intro_slide_active:
    missionselect_init: 1
