#config_version=5

#####
# MISSION SELECT MODE
#
# This is a game logic mode to present a selection carousel to the player when
# missions are available for them to play. Usually this means any of the
# recruitment missions they've unlocked, but also Collecter Ship and the Suicide
# Mission will be present here.
#
# Due to the arbitrary nature of which missions are available, this mode uses
# a custom Python class (missionselect.py) to assess the state of each squadmate
# and dynamically populate the carousel items when the mode starts.
#####

mode:
  start_events: start_mode_missionselect
  stop_events: stop_mode_missionselect, missionselect_item_selected
  events_when_started: flippers_off
  events_when_stopped: flippers_on
  priority: 3000
  code: missionselect.MissionSelect
  file_log: full
  use_wait_queue: true

mode_settings:
  # All squadmates are included via missionselect.py, no need to list them here
  selectable_items: intro, pass
  select_item_events: s_action_button_active
  next_item_events: s_flipper_right_active, missionselect_skip_forwards, mode_missionselect_started, missionselect_specialist_highlighted
  previous_item_events: s_flipper_left_active, missionselect_skip_backwards

show_player:
  mode_missionselect_started: missionselect_show
  mode_missionselect_will_stop:
    missionselect_show:
      action: stop
    missionselect_highlight_show:
      action: stop
  missionselect_pass_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: black
  missionselect_collectorship_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: FF2200 #color_collector
  missionselect_derelictreaper_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: FF2200 #color_collector
  missionselect_recruit_highlighted:
    missionselect_highlight_show{squadmate=="garrus"}:
      show_tokens:
        leds: shot_shield_garrus, l_action_button
        color: 0055FF
    missionselect_highlight_show{squadmate=="grunt"}:
      show_tokens:
        leds: shot_shield_grunt, l_action_button
        color: BB1100
    missionselect_highlight_show{squadmate=="jack"}:
      show_tokens:
        leds: shot_shield_jack, l_action_button
        color: 4D00CC #color_jack
    missionselect_highlight_show{squadmate=="kasumi"}:
      show_tokens:
        leds: shot_shield_kasumi, l_action_button
        color: EEFF00 #color_kasumi
    missionselect_highlight_show{squadmate=="legion"}:
      show_tokens:
        leds: shot_shield_legion, l_action_button
        color: FFFFFF #color_legion
    missionselect_highlight_show{squadmate=="mordin"}:
      show_tokens:
        leds: shot_shield_mordin, l_action_button
        color: 440000 #color_mordin
    missionselect_highlight_show{squadmate=="samara"}:
      show_tokens:
        leds: shot_shield_samara, l_action_button
        color: 00FFAA #color_samara
    missionselect_highlight_show{squadmate=="tali"}:
      show_tokens:
        leds: shot_shield_tali, l_action_button
        color: FF11DD #color_tali
    missionselect_highlight_show{squadmate=="thane"}:
      show_tokens:
        leds: shot_shield_thane, l_action_button
        color: 00FF11 #color_thane
    missionselect_highlight_show{squadmate=="zaeed"}:
      show_tokens:
        leds: shot_shield_zaeed, l_action_button
        color: FF4400 #color_zaeed
  missionselect_suicide_highlighted:
    missionselect_suicide_show:
      action: play
      key: missionselect_highlight_show
      speed: 6
      show_tokens:
        color: FF0000
        fadetime: 20ms

shows:
  missionselect_show:
    - lights:
        gi:
          color: off
          fade: 2s
        l_left_ramp_arrow_clear: off
        l_dropbank_bottom: off
        l_dropbank_middle: off
        l_dropbank_top: off
        shot_shields: off
        l_pop_bumpers: off
        l_left_top_lane: off
        l_right_top_lane: off
  missionselect_highlight_show:
    - duration: 500ms
      lights:
        (leds): (color)
    - duration: 500ms
      lights:
        (leds): black
        (l_null): (color)
  missionselect_suicide_show:
    - time: 0
      lights:
        l_dropbank_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_right_orbit_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_left_orbit_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_hitbank_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_kickback_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_dropbank_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_left_ramp_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_left_orbit_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_right_ramp_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_kickback_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_right_orbit_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_left_ramp_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_hitbank_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_right_ramp_shield_rgb:
          color: 0
          fade: (fadetime)

slide_player:
  missionselect_intro_highlighted: missionselect_intro_slide
  missionselect_recruit_highlighted: missionselect_recruit_slide
  missionselect_pass_highlighted: missionselect_pass_slide
  missionselect_collectorship_highlighted: missionselect_collectorship_slide
  missionselect_derelictreaper_highlighted: missionselect_derelictreaper_slide
  missionselect_suicide_highlighted: missionselect_suicide_slide
  mode_missionselect_started: missionselect_specialist_slide

slides:
  missionselect_intro_slide:
    widgets:
      - type: text
        text: Select a Mission
        style: quadrit_big
        anchor_y: bottom
        y: bottom+45%
  missionselect_recruit_slide:
    priority: 1
    widgets:
      - type: text
        text: (squadmate)
        style: quadrit_big
        anchor_y: bottom
        y: bottom+45%
        casing: title
      - type: text
        text: Start Recruitment Mission
        style: dmd_small
        anchor_y: bottom
        y: 3
  missionselect_collectorship_slide:
    priority: 1
    widgets:
      - type: text
        text: Disabled
        anchor_y: bottom
        y: 50%
      - type: text
        text: Collector Vessel
        anchor_y: top
        y: 50%
  missionselect_derelictreaper_slide:
    priority: 1
    widgets:
      - type: text
        text: Derelict
        anchor_y: bottom
        y: 50%
      - type: text
        text: Reaper
        anchor_y: top
        y: 50%
  missionselect_suicide_slide:
    priority: 1
    widgets:
      - type: text
        text: LAUNCH THE
        style: dmd_small
        bold: true
        anchor_y: top
        y: top-3
      - type: text
        text: SUICIDE MISSION
        font_size: 14
        style: quadrit_big
        anchor_y: bottom
        y: 3
  missionselect_pass_slide:
    priority: 10
    widgets:
      - type: text
        text: Pass for Now
        style: quadrit_big
        anchor_y: bottom
        y: bottom+45%
  missionselect_specialist_slide:
    priority: 2500 # Suicide runs at 2000
    widgets:
      - type: rectangle
        color: black
        width: 128
        height: 32
        z: 1

widget_player:
  # The intro slide appears whenever there are multiple options, so show arrows
  missionselect_intro_highlighted: select_arrows_widget
  missionselect_specialist_garrus_default:
    specialist_garrus_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_garrus_highlighted:
    specialist_garrus_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_garrus_dead:
    specialist_garrus_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_jack_default:
    specialist_jack_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_jack_highlighted:
    specialist_jack_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_jack_dead:
    specialist_jack_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_jacob_default:
    specialist_jacob_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_jacob_highlighted:
    specialist_jacob_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_jacob_dead:
    specialist_jacob_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_kasumi_default:
    specialist_kasumi_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_kasumi_highlighted:
    specialist_kasumi_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_kasumi_dead:
    specialist_kasumi_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_legion_default:
    specialist_legion_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_legion_highlighted:
    specialist_legion_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_legion_dead:
    specialist_legion_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_miranda_default:
    specialist_miranda_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_miranda_highlighted:
    specialist_miranda_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_miranda_dead:
    specialist_miranda_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_mordin_default:
    specialist_mordin_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_mordin_highlighted:
    specialist_mordin_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_mordin_dead:
    specialist_mordin_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_samara_default:
    specialist_samara_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_samara_highlighted:
    specialist_samara_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_samara_dead:
    specialist_samara_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_tali_default:
    specialist_tali_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_tali_highlighted:
    specialist_tali_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_tali_dead:
    specialist_tali_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead
  missionselect_specialist_thane_default:
    specialist_thane_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_default
  missionselect_specialist_thane_highlighted:
    specialist_thane_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_highlight
  missionselect_specialist_thane_dead:
    specialist_thane_widget:
      action: update
      slide: missionselect_specialist_slide
      widget_settings:
        style: spec_dead

widgets:
  select_arrows_widget:
    - type: text
      text: < FLIPPERS TO SELECT >
      anchor_y: bottom
      style: small
      y: 3
  specialist_garrus_widget:
    - type: text
      text: Garrus
      style: spec_default
      y: 24
      x: 2
      z: 2
  specialist_jack_widget:
    - type: text
      text: Jack
      style: spec_default
      y: 24
      x: 2
      z: 2
  specialist_jacob_widget:
    - type: text
      text: Jacob
      style: spec_default
      y: 13
      x: 2
      z: 2
  specialist_kasumi_widget:
    - type: text
      text: Kasumi
      style: spec_default
      y: 2
      x: 2
      z: 2
  specialist_legion_widget:
    - type: text
      text: Legion
      style: spec_default
      y: 24
      x: 44
      z: 2
  specialist_miranda_widget:
    - type: text
      text: Miranda
      style: spec_default
      y: 24
      x: 44
      z: 2
  specialist_mordin_widget:
    - type: text
      text: Mordin
      style: spec_default
      y: 13
      x: 44
      z: 2
  specialist_samara_widget:
    - type: text
      text: Samara
      style: spec_default
      y: 13
      x: 44
      z: 2
  specialist_tali_widget:
    - type: text
      text: Tali
      style: spec_default
      y: 2
      x: 44
      z: 2
  specialist_thane_widget:
    - type: text
      text: Thane
      style: spec_default
      y: 24
      x: 86
      z: 2
