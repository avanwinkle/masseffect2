#config_version=5

#####
# MISSION SELECT MODE
#
# This is a game logic mode to present a selection carousel to the player when
# missions are available for them to play. Usually this means any of the
# recruitment missions they've unlocked, but also Collecter Ship and the Suicide
# Mission will be present here.
#
# Due to the arbitrary nature of which missions are available, this mode uses
# a custom Python class (missionselect.py) to assess the state of each squadmate
# and dynamically populate the carousel items when the mode starts.
#####

mode:
  start_events: start_mode_missionselect
  stop_events: stop_mode_missionselect, missionselect_item_selected, s_return_lane_right_active
  events_when_started: flippers_off
  events_when_stopped: left_flipper_on, right_flipper_on
  priority: 3000
  code: missionselect.MissionSelect
  file_log: full
  use_wait_queue: true

mode_settings:
  # All squadmates are included via missionselect.py, no need to list them here
  selectable_items: intro, pass
  select_item_events: s_action_button_active, s_plunger_lane_inactive, flipper_cancel, timer_missionselect_timer_complete
  next_item_events: s_flipper_right_inactive, missionselect_skip_forwards, mode_missionselect_started, missionselect_specialist_highlighted
  previous_item_events: s_flipper_left_inactive, missionselect_skip_backwards

event_player:
  # The hold will release when intro is complete
  missionselect_pass_selected: mission_intro_complete
  # Fake the timer for the initial slide value
  mode_missionselect_started:
    missionselect_missionselect_timer_tick:
      action: set
      int: 12 if current_player.available_missions > 1 else 6

timers:
  missionselect_timer:
    start_value: 12 if current_player.available_missions > 1 else 6
    end_value: 0
    tick_interval: 1.2s
    direction: down
    start_running: true

show_player:
  mode_missionselect_started: missionselect_show
  mode_missionselect_will_stop:
    missionselect_show:
      action: stop
    missionselect_highlight_show:
      action: stop
  missionselect_recruitmission_selected:
    led_10_chase_delay:
      action: play
      loops: 1
      show_tokens:
        color: color_shields
        ledring: l_backwall_gi
        fade: 50ms
  missionselect_pass_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: black
  missionselect_collectorship_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: color_collectors
  missionselect_derelictreaper_highlighted:
    missionselect_highlight_show:
      show_tokens:
        leds: shot_shields
        color: color_collectors
  missionselect_recruit_highlighted:
    missionselect_highlight_show{squadmate=="garrus"}:
      show_tokens:
        leds: shot_shield_garrus, l_action_button
        color: color_garrus
    missionselect_highlight_show{squadmate=="grunt"}:
      show_tokens:
        leds: shot_shield_grunt, l_action_button
        color: color_grunt
    missionselect_highlight_show{squadmate=="jack"}:
      show_tokens:
        leds: shot_shield_jack, l_action_button
        color: color_jack
    missionselect_highlight_show{squadmate=="kasumi"}:
      show_tokens:
        leds: shot_shield_kasumi, l_action_button
        color: color_kasumi
    missionselect_highlight_show{squadmate=="legion"}:
      show_tokens:
        leds: shot_shield_legion, l_action_button
        color: color_legion
    missionselect_highlight_show{squadmate=="mordin"}:
      show_tokens:
        leds: shot_shield_mordin, l_action_button
        color: color_mordin
    missionselect_highlight_show{squadmate=="samara"}:
      show_tokens:
        leds: shot_shield_samara, l_action_button
        color: color_samara
    missionselect_highlight_show{squadmate=="tali"}:
      show_tokens:
        leds: shot_shield_tali, l_action_button
        color: color_tali
    missionselect_highlight_show{squadmate=="thane"}:
      show_tokens:
        leds: shot_shield_thane, l_action_button
        color: color_thane
    missionselect_highlight_show{squadmate=="zaeed"}:
      show_tokens:
        leds: shot_shield_zaeed, l_action_button
        color: color_zaeed
  missionselect_suicide_highlighted:
    missionselect_suicide_show:
      action: play
      key: missionselect_highlight_show
      speed: 6
      show_tokens:
        color: FF0000
        fadetime: 20ms

shows:
  missionselect_show:
    - lights:
        gi:
          color: off
          fade: 2s
        light_pf: off
        light_missionselect: off
        l_dropbank_bottom: off
        l_dropbank_middle: off
        l_dropbank_top: off
        shot_shields: off
        l_pop_bumpers: off
        l_left_top_lane: off
        l_right_top_lane: off
        l_hitbank_top: off
        l_hitbank_bottom: off
        l_upgrade: off
        light_lock_lit: off
  missionselect_highlight_show:
    - duration: 500ms
      lights:
        (leds): (color)
    - duration: 500ms
      lights:
        (leds): black
        (l_null): (color)
  missionselect_suicide_show:
    - time: 0
      lights:
        light_dropbank_rgb:
          color: (color)
          fade: (fadetime)
        l_right_orbit_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_left_orbit_shield_rgb:
          color: (color)
          fade: (fadetime)
        light_hitbank_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_kickback_shield_rgb:
          color: (color)
          fade: (fadetime)
        light_dropbank_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_left_ramp_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_left_orbit_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_right_ramp_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_kickback_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        l_right_orbit_shield_rgb:
          color: (color)
          fade: (fadetime)
        l_left_ramp_shield_rgb:
          color: 0
          fade: (fadetime)
    - time: '+1'
      lights:
        light_hitbank_rgb:
          color: (color)
          fade: (fadetime)
        l_right_ramp_shield_rgb:
          color: 0
          fade: (fadetime)

slide_player:
  check_slide_queue: {}
  missionselect_intro_highlighted:
    missionselect_intro_slide:
      target: main
  missionselect_recruit_highlighted.1{current_player.force_mission==0}:
    missionselect_recruit_slide:
      target: main
    missionselect_portrait_derelictreaper:
      action: remove
      target: lcd_right
    missionselect_portrait_suicide:
      action: remove
      target: lcd_right
  missionselect_recruit_highlighted.2{current_player.force_mission==1}:
    missionselect_recruit_force_slide:
      target: main
  missionselect_pass_highlighted:
    missionselect_pass_slide:
      target: main
    missionselect_portrait_derelictreaper:
      action: remove
      target: lcd_right
    missionselect_portrait_suicide:
      action: remove
      target: lcd_right
  missionselect_collectorship_highlighted:
    missionselect_collectorship_slide:
      target: main
    missionselect_portrait_collectorship:
      target: lcd_right
  missionselect_derelictreaper_highlighted:
    missionselect_derelictreaper_slide:
      target: main
    missionselect_portrait_derelictreaper:
      target: lcd_right
  missionselect_suicide_highlighted:
    missionselect_suicide_slide:
      target: main
    missionselect_portrait_suicide:
      target: lcd_right

slides:
  missionselect_intro_slide:
    widgets:
      - type: text
        text: Select a Mission
        style: header_md, row_main
      - type: text
        text: < FLIPPERS TO SELECT >
        style: body_sm, row_sub_under, row_dmd_bottom
      - widget: background_console
  missionselect_recruit_slide:
    priority: 1
    widgets:
      - type: text
        text: Recruit Your Squad
        style: header_sm, row_top
        opacity: 0.6
      - type: text
        text: (squadmate)
        style: header_md, row_main
        casing: title
      - type: text
        text: "Press Both Flippers\nTo Start Mission"
        style: body_sm, row_sub_under, row_dmd_bottom
        color: EEEEEE
      - widget: missionselect_count_widget
      - widget: missionselect_timer_widget
      - widget: background_console
  missionselect_recruit_force_slide:
    priority: 1
    widgets:
      - type: text
        text: Recruit Your Squad
        style: header_sm, row_top
        opacity: 0.6
      - type: text
        text: (squadmate)
        style: header_md, row_main
        casing: title
      - type: text
        text: Mission Starting in (missionselect_missionselect_timer_tick)
        style: body_sm, row_sub_under, row_dmd_bottom
        color: EEEEEE
      - type: text
        text: "\n(Press flippers to start immediately)"
        style: body_xs, row_sub_under
        color: EEEEEE
      - widget: background_console
  missionselect_collectorship_slide:
    priority: 1
    widgets:
      - type: text
        text: "Disabled\nCollector Vessel"
        style: header_md, row_main, row_main_dmd_low
      - widget: missionselect_timer_widget
      - widget: background_console
  missionselect_derelictreaper_slide:
    priority: 1
    widgets:
      - type: text
        text: "Derelict Reaper"
        style: header_md, row_main
      - widget: missionselect_timer_widget
      - widget: background_console
  missionselect_suicide_slide:
    priority: 1
    widgets:
      - type: text
        text: LAUNCH THE
        style: header_sm, row_top
      - type: text
        text: $suicidemission
        casing: upper
        style: header_lg
      - widget: background_console
  missionselect_pass_slide:
    priority: 10
    widgets:
      - type: text
        text: Pass for Now
        style: header_md, row_main
      - widget: missionselect_count_widget
      - widget: missionselect_timer_widget
      - widget: background_console
  missionselect_portrait_slide: []
  missionselect_portrait_collectorship:
    widgets:
      - type: image
        image: portrait_collectorship_intro
  missionselect_portrait_derelictreaper:
    widgets:
      - type: image
        image: portrait_derelictreaper_intro
  missionselect_portrait_suicide:
    widgets:
      - type: image
        image: portrait_suicide_intro

sound_player:
  missionselect_pass_selected: shep_i_should_go

