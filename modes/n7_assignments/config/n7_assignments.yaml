#config_version=5

#####
# N7 ASSIGNMENTS MODE
#
# This mode is a superjets-style countdown from the pop bumpers. Once the
# countdown hits zero, all other modes are temporarily disabled and a random
# N7 Assignment shot is lit. The player has a fixed amount of time to hit this
# shot and collect a hurryup value. Once collected or when the timer runs out,
# the mode ends and regular gameplay resumes.
#
# When enough missions are completed, the player unlocks the trilogy assignments
# for Wrecked Merchant Freighter, Abandoned Research Station, Hahne-Kedar Facility
#####

mode:
  start_events: start_mode_n7_assignments
  stop_events: stop_mode_n7_assignments, ball_will_end
  events_when_started: mode_type_wizard_started
  events_when_stopped: mode_type_wizard_stopped
  priority: 500

event_player:
  mode_n7_assignments_started.2:
    set_mission_shots:
      shots_total: 5  # Will yield base value / 25 = 4,000pts
      shots_remaining: 1
      ticks: 20
      multiplier:
        value: 1.0 + (0.25 * current_player.assignments_completed)
        type: float
  mode_n7_assignments_started.1:
    - missiontimer_start|1s
  n7_assignment_shot_hit:
    - mission_shot_hit
    - mission_collect_store
    - n7_assignment_ended
  timer_missiontimer_complete: n7_assignment_ended
  n7_assignment_ended:
    - stop_mode_n7_assignments
  player_shot_n7_anomalous_weather_shot_enabled:
    set_n7_mission:
      title: "Anomalous Weather Detected"
  player_shot_n7_eclipse_smuggling_depot_shot_enabled:
    set_n7_mission:
      title: "Eclipse Smuggling Depot"
  player_shot_n7_quarian_crash_site_shot_enabled:
    set_n7_mission:
      title: "Quarian Crash Site"
  player_shot_n7_imminent_ship_crash_shot_enabled:
    set_n7_mission:
      title: "Imminent Ship Crash"
  player_shot_n7_javelin_missiles_launched_shot_enabled:
    set_n7_mission:
      title: "Javelin Missiles Launched"
  player_shot_n7_lost_operative_shot_enabled:
    set_n7_mission:
      title: "Lost Operative"
  player_shot_n7_msv_strontium_mule_shot_enabled:
    set_n7_mission:
      title: "MSV Strontium Mule"

random_event_player:
  mode_n7_assignments_started:
    force_all: true
    events:
      - start_n7_anomalous_weather
      - start_n7_eclipse_smuggling_depot
      - start_n7_quarian_crash_site
      - start_n7_imminent_ship_crash
      - start_n7_javelin_missiles_launched
      - start_n7_lost_operative
      - start_n7_msv_strontium_mule

variable_player:
  n7_assignment_shot_hit:
    assignments_completed: 1
    earned_assignments_completed: 1
    xp: machine.assignment_xp

shot_groups:
  n7_assignment_shot:
    shots: n7_anomalous_weather_shot, n7_eclipse_smuggling_depot_shot, n7_quarian_crash_site_shot, n7_imminent_ship_crash_shot, n7_javelin_missiles_launched_shot, n7_lost_operative_shot, n7_msv_strontium_mule_shot
    rotate_right_events: sw_bumper_active  # Bumper hits determine randomness

shots:
  n7_anomalous_weather_shot:
    hit_events: sh_right_ramp_hit
    profile: n7_shot_profile
    enable_events: start_n7_anomalous_weather
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_right_ramp_shield_rgb
  n7_eclipse_smuggling_depot_shot:
    hit_events: sh_left_ramp_hit
    profile: n7_shot_profile
    enable_events: start_n7_eclipse_smuggling_depot
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_left_ramp_shield_rgb
  n7_quarian_crash_site_shot:
    hit_events: sh_left_orbit_hit
    profile: n7_shot_profile
    enable_events: start_n7_quarian_crash_site
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_left_orbit_shield_rgb
  n7_imminent_ship_crash_shot:
    hit_events: sh_right_orbit_hit
    profile: n7_shot_profile
    enable_events: start_n7_imminent_ship_crash
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_right_orbit_shield_rgb
  n7_javelin_missiles_launched_shot:
    hit_events: sh_right_orbit_hit
    profile: n7_shot_profile
    enable_events: start_n7_javelin_missiles_launched
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_right_orbit_shield_rgb
  n7_lost_operative_shot:
    hit_events: sh_hitbank_top_hit, sh_hitbank_bottom_hit
    profile: n7_shot_profile
    enable_events: start_n7_lost_operative
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_hitbank_shield_rgb
  n7_msv_strontium_mule_shot:
    hit_events: sh_right_ramp_hit
    profile: n7_shot_profile
    enable_events: start_n7_msv_strontium_mule
    disable_events: mode_n7_assignments_will_stop
    show_tokens:
      leds: l_right_ramp_shield_rgb

shot_profiles:
  n7_shot_profile:
    show_when_disabled: false
    states:
      - name: active
        show: n7_show
        speed: 12

show_player:
  mode_n7_assignments_started: n7_lightsdown
  mode_n7_assignments_will_stop:
    n7_lightsdown:
      action: stop

shows:
  n7_lightsdown:
    - lights:
        gi:
          color: 444444
          fade: 1s
  n7_show:
    - time: 0
      lights:
        (leds): red
    - time: '+3'
      lights:
        (leds): white
    - time: '+4'
      lights:
        (leds): red
    - time: '+5'
      lights:
        (leds): white

slide_player:
  set_n7_mission:
    n7_hurryupslide:
      action: play
      priority: 100
  n7_assignment_ended:
    n7_hurryupslide:
      action: remove

slides:
  n7_hurryupslide:
    widgets:
      - type: text
        text: N7 Assignment
        style: header_xs, row_top, col_left_anchor
        opacity: 0.5
      - type: text
        text: (title)
        style: header_sm, row_main, col_left_anchor
      - widget: n7_logo

sound_player:
  mode_n7_assignments_started:
    music_n7:
      action: play
      loops: -1
      fade_in: 3s
      fade_out: 1s
      mode_end_action: stop
  start_n7_anomalous_weather: intro_anomalous_weather
  start_n7_eclipse_smuggling_depot: aria_sending_you_cache_coordinates
  start_n7_imminent_ship_crash: intro_imminent_ship_crash
  start_n7_quarian_crash_site: intro_quarian_crash_site
  start_n7_javelin_missiles_launched: intro_javelin_missiles
  start_n7_lost_operative: edi_anomaly_detected
  start_n7_msv_strontium_mule: edi_distress_signal

sound_pools:
  music_n7:
    sounds: music_n7_stationalert, music_n7_breakingout, music_n7_combat_12, music_n7_combat_72, music_n7_combat_81
    type: random_force_all
    track: music
  edi_anomaly_detected:
    sounds: edi_anomaly_detected_1, edi_anomaly_detected_2, edi_anomaly_detected_3, edi_anomaly_detected_4
    track: voice
    type: random
  edi_distress_signal:
    sounds: edi_distress_signal_1, edi_distress_signal_2, edi_distress_signal_3, edi_distress_signal_4
    track: voice
    type: random


sounds:
  music_n7_stationalert:
    file: ARR.03.Station_Alert.ogg
    start_at: 35s
    track: music
    fade: 1s
  music_n7_breakingout:
    file: ARR.05.Breaking_Out.ogg
    track: music
    fade: 1s
  music_n7_combat_12:
    file: mus_n7_1_combat_2.ogg
    track: music
  music_n7_combat_72:
    file: mus_n7_7_combat_2.ogg
    track: music
  music_n7_combat_81:
    file: mus_n7_8_combat_1.ogg
    track: music
  intro_imminent_ship_crash:
    file: en_us_hench_ai_n7mmnt4_impact_imminent_00344656_m.ogg  # "Warning: collision imminent"
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  intro_javelin_missiles:
    file: en_us_hench_ai_n7mmnt7_warning_00344483_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  intro_anomalous_weather:
    file: en_us_hench_ai_n7bldinv1_fog_00344671_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  intro_quarian_crash_site:
    file: en_us_hench_ai_n7mmnt2_biosign_detected_00344662_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  aria_sending_you_cache_coordinates:
    file: en_us_omghub_asari_ruler_omghub_asari_ruler_d_00284069_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_anomaly_detected_1:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333696_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_anomaly_detected_2:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333697_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_anomaly_detected_3:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333698_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_anomaly_detected_4:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333699_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_distress_signal_1:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333701_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_distress_signal_2:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333702_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_distress_signal_3:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333703_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms
  edi_distress_signal_4:
    file: en_us_hench_ai_nor_ai_edi_hint_h_00333704_m.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.3
      attack: 200ms
      release: 200ms
      release_point: 100ms

widget_player:
  timer_missiontimer_started: timer_widget
  timer_missiontimer_tick:
    timer_widget:
      action: update
  stop_mode_n7_assignments:
    timer_widget:
      action: remove

widgets:
  timer_widget:
    - type: text
      text: (ticks_remaining)
      style: timer_primary, row_gutter, col_right_indent
