#config_version=5
mode:
  start_events: start_mode_n7_assignments
  stop_events: stop_mode_n7_assignments
  priority: 400

event_player:
  logicblock_n7_hits_counter_complete: start_n7_assignment
  n7_assignment_shot_hit: n7_assignment_ended
  timer_n7timer_complete: n7_assignment_ended
  start_n7_assignment:
    - restart_n7timer|500ms
    - stop_mode_recruitfield
    - disable_nonrecruit_modes
  n7_assignment_ended:
    - start_mode_recruitfield
    - reenable_nonrecruit_modes
  player_shot_n7_anomalous_weather_shot_enabled:
    set_n7_mission:
      title: "Anomalous Weather Detected"
  player_shot_n7_eclipse_smuggling_depot_shot_enabled:
    set_n7_mission:
      title: "Eclipse Smuggling Depot"
  player_shot_n7_hahne_kedar_facility_shot_enabled:
    set_n7_mission:
      title: "Hahne-Kedar Facility"
  player_shot_n7_imminent_ship_crash_shot_enabled:
    set_n7_mission:
      title: "Imminent Ship Crash"
  player_shot_n7_javelin_missiles_launched_shot_enabled:
    set_n7_mission:
      title: "Javelin Missiles Launched"
  player_shot_n7_lost_operative_shot_enabled:
    set_n7_mission:
      title: "Lost Operative"
  player_shot_n7_msv_strontium_mule_shot_enabled:
    set_n7_mission:
      title: "MSV Strontium Mule"

random_event_player:
  start_n7_assignment:
    force_all: true
    events:
      - start_n7_anomalous_weather
      - start_n7_eclipse_smuggling_depot
      - start_n7_hahne_kedar_facility
      - start_n7_imminent_ship_crash
      - start_n7_javelin_missiles_launched
      - start_n7_lost_operative
      - start_n7_msv_strontium_mule

counters:
  n7_hits_counter:
    starting_count: 4
    count_complete_value: 0
    direction: down
    count_events: n7_advance_shot_hit
    restart_events: n7_assignment_ended
    persist_state: true

scoring:
  start_n7_assignment:
    temp_build_value:
      action: set
      # Max value is 12000 plus 25% per mission completed
      score: 12000 * (1 + (0.25 * current_player.assignments_completed))
  timer_n7timer_tick:
    temp_build_value:
      action: add
      # Each tick is 1/2s, so burn 1/60th (200 + 25%) each time
      score: (1 + (0.25 * current_player.assignments_completed)) * -200
  n7_assignment_shot_hit:
    score: current_player.temp_build_value
    assignments_completed: 1

shot_groups:
  n7_assignment_shot:
    shots: n7_anomalous_weather_shot, n7_eclipse_smuggling_depot_shot, n7_hahne_kedar_facility_shot, n7_imminent_ship_crash_shot, n7_javelin_missiles_launched_shot, n7_lost_operative_shot, n7_msv_strontium_mule_shot
    rotate_right_events: s_bumper_right_active
    rotate_left_events: s_bumber_left_active

shots:
  n7_advance_shot:
    switches: s_bumper_bottom, s_bumper_right, s_bumper_left
    enable_events: mode_n7_assignments_started, n7_assignment_ended
    disable_events: start_n7_assignment
  n7_anomalous_weather_shot:
    switch: s_right_ramp_exit
    profile: n7_shot_profile
    enable_events: start_n7_anomalous_weather
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_right_ramp_shield_rgb
  n7_eclipse_smuggling_depot_shot:
    switch: s_kickback
    profile: n7_shot_profile
    enable_events: start_n7_eclipse_smuggling_depot
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_kickback_shield_rgb
  n7_hahne_kedar_facility_shot:
    switch: s_left_orbit
    profile: n7_shot_profile
    enable_events: start_n7_hahne_kedar_facility
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_left_orbit_shield_rgb
  n7_imminent_ship_crash_shot:
    switch: s_right_orbit
    profile: n7_shot_profile
    enable_events: start_n7_imminent_ship_crash
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_right_orbit_shield_rgb
  n7_javelin_missiles_launched_shot:
    switch: s_right_orbit
    profile: n7_shot_profile
    enable_events: start_n7_javelin_missiles_launched
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_right_orbit_shield_rgb
  n7_lost_operative_shot:
    switch: s_hitbank_top, s_hitbank_bottom
    profile: n7_shot_profile
    enable_events: start_n7_lost_operative
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_hitbank_shield_rgb
  n7_msv_strontium_mule_shot:
    switch: s_right_ramp_exit
    profile: n7_shot_profile
    enable_events: start_n7_msv_strontium_mule
    disable_events: n7_assignment_ended
    show_tokens:
      leds: l_right_ramp_shield_rgb

shot_profiles:
  n7_shot_profile:
    show_when_disabled: False
    states:
      - name: active
        show: n7_show
        speed: 12

shows:
  n7_show:
    - time: 0
      lights:
        (leds): red
    - time: '+5'
      lights:
        (leds): white
    - time: '+6'
      lights:
        (leds): red
    - time: '+7'
      lights:
        (leds): white

slide_player:
  n7_assignment_started:
    n7_intro_slide:
      action: play
      expire: 3s
  set_n7_mission:
    n7_hurryupslide:
      action: play
  n7_assignment_ended:
    n7_hurryupslide:
      action: remove

slides:
  n7_intro_slide:
    priority: 100
    widgets:
      - type: image
        image: n7_logo_33x11
        width: 33
        height: 11
        anchor_x: left
        anchor_y: bottom
        x: 2
        y: 3
      - type: text
        text: Hit the N7 Shot
        anchor_x: left
        anchor_y: top
        x: 2
        y: top-2
        font_size: 8
        font_name: pixelmix
  n7_hurryupslide:
    priority: 0
    widgets:
      - type: image
        image: n7_logo_33x11
        width: 33
        height: 11
        anchor_x: left
        anchor_y: bottom
        x: 2
        y: 3
      - type: text
        text: (title)
        anchor_x: left
        anchor_y: top
        x: 2
        y: top-2
        font_size: 8
        font_name: pixelmix

timers:
  n7timer:
    start_value: 60 # 2x the number of seconds
    end_value: 1
    direction: down
    tick_interval: 500ms
    control_events:
      - event: start_n7_assignment
        action: reset
      - event: restart_n7timer # Give a delay to start the mission
        action: restart
      - event: n7_assignment_shot_hit
        action: stop
      - event: ball_will_end
        action: stop

widget_player:
  logicblock_n7_hits_counter_updated:
    n7_progress_widget:
      action: update
      widget_settings:
        expire: 2s
  player_temp_build_value:
    hurryup_widget:
      action: update
      slide: n7_hurryupslide

widgets:
  n7_progress_widget:
    - type: text
      text: "(value) hits to N7 assignment"
      style: dmd_small
      anchor_y: bottom
      anchor_x: left
      y: 2
      x: 22
      z: 2
    - type: rectangle
      width: 128
      height: 8
      color: 000000
      anchor_y: bottom
      anchor_x: left
      x: 0
      y: 0
      z: 1
  hurryup_widget:
    - type: text
      text: (value)
      number_grouping: true
      anchor_x: left
      anchor_y: bottom
      x: 37
      y: 3
      font_size: 10
      font_name: quadrit

