#config_version=5

#####
# OVERLORD MULTIBALL MODE
#
# The Overlord multiball is available during regular play prior to the Collector
# Ship mission. Hitting either of the Geth/Batarian hitbank targets will light
# lock up to three balls (for Prometheus, Vulcan, and Atlas stations). On the
# third ball lock, a three-ball multiball begins.
#
# All lane shots are lit on a 30 second timer, hitting a lit shot "freezes" it
# and adds 10 seconds. Once any shot is hit, the jackpot shot (hitbank) lights
# and a hurry-up value is added to a buildup. Hitting the jackpot awards the
# build value times a multiplier for how many lane shots have been hit, then
# the lane shots reset. If the timer runs out, all lit lane shots freeze and the
# jackpot shot must be hit to re-enable them.
#
# If the player successfully collects three jackpots, the mode has been
# “completed” and a levelup is earned. From this point the multiball continues
# so long as multiple balls are in play. Recruitment shots do not advance
# and no other ball locks take effect. When two of the balls have drained, the
# built value is collected and normal play resumes.
#
# TODO: After completing the Overlord multiball, it can be restarted the same
# way as before, except that both hitbank targets must be hit to light lock.
# Only the first completion will grant a levelup.
#####

mode:
  start_events: start_mode_overlordmultiball
  stop_events: stop_mode_overlordmultiball, stop_wizards
  events_when_started: mode_type_wizard_started
  events_when_stopped: mode_type_wizard_stopped
  priority: 500

counters:
  hackshots_hit_counter:
    starting_count: 0
    count_events: hackshots_lit_hit
    reset_events: reset_hackshots
  jackpots_hit_counter:
    starting_count: 0
    count_complete_value: 4
    disable_on_complete: true
    count_events: jackpotshot_hit

timers:
  overlord_timer:
    start_value: 30
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - event: reset_hackshots
        action: restart
      - event: hackshots_lit_hit
        action: add
        value: 10

event_player:
  mode_overlordmultiball_started.1:
    - reset_hackshots
    - play_music_1
  mode_overlordmultiball_started.2:
    set_environment:
      env: geth
  # To light the jackpot, you have to hit n hackshots where n = jackpots already hit
  logicblock_hackshots_hit_counter_hit{count>device.counters.jackpots_hit_counter.value}:
    - enable_jackpotshot
  jackpotshot_hit: reset_hackshots
  timer_overlord_timer_complete: disable_hackshots
  logicblock_jackpots_hit_counter_hit{count==3}:
    - levelup

scoring:
  reset_hackshots:
    temp_build_value:
      action: set
      score: 0
    temp_multiplier:
      action: set
      score: 30
  timer_overlord_timer_tick:
    temp_multiplier:
      action: set
      score: ticks
  hackshots_hit:
    score: 500
    temp_build_value: 100 * current_player.temp_multiplier
  jackpotshot_hit:
    score: current_player.temp_build_value * device.counters.hackshots_hit_counter.value * (1 + 0.25 * device.counters.jackpots_hit_counter.value)

shot_profiles:
  overlord_target_profile:
    show_when_disabled: false
    states:
      - name: lit
        show: overlord_lit_show
        priority: 5 # Higher priority than all-off show, lower priority than all-solid show
        speed: 4
      - name: frozen
        show: overlord_frozen_show
        priority: 15 # Higher priority than all-solid show, lower than all-frozen show
  overlord_jackpot_profile:
    show_when_disabled: false
    states:
      - name: lit
        show: overlord_jackpot_show
        speed: 4

shot_groups:
  hackshots:
    shots: hackshot_left_orbit, hackshot_left_ramp, hackshot_right_orbit, hackshot_right_ramp, hackshot_kickback

shots:
  jackpotshot:
    switches: s_hitbank_top, s_hitbank_bottom
    enable_events: enable_jackpotshot
    disable_events: disable_jackpotshot, jackpotshot_hit
    profile: overlord_jackpot_profile
    tags: envshot_hitbank
  hackshot_left_orbit:
    hit_events: sh_left_orbit_hit
    enable_events: reset_hackshots
    disable_events: disable_hackshots, hackshot_left_orbit_hit
    reset_events: reset_hackshots
    profile: overlord_target_profile
    show_tokens:
      leds: l_left_orbit_shield_rgb
    tags: envshot_left_orbit
  hackshot_right_orbit:
    hit_events: sh_right_orbit_hit
    enable_events: reset_hackshots
    disable_events: disable_hackshots, hackshot_right_orbit_hit
    reset_events: reset_hackshots
    profile: overlord_target_profile
    show_tokens:
      leds: l_right_orbit_shield_rgb
    tags: envshot_right_orbit
  hackshot_left_ramp:
    hit_events: sh_left_ramp_hit
    enable_events: reset_hackshots
    disable_events: disable_hackshots, hackshot_left_ramp_hit
    reset_events: reset_hackshots
    profile: overlord_target_profile
    show_tokens:
      leds: l_left_ramp_shield_rgb
    tags: envshot_left_ramp
  hackshot_right_ramp:
    hit_events: sh_right_ramp_hit
    enable_events: reset_hackshots
    disable_events: disable_hackshots, hackshot_right_ramp_hit
    reset_events: reset_hackshots
    profile: overlord_target_profile
    show_tokens:
      leds: l_right_ramp_shield_rgb
    tags: envshot_right_ramp
  hackshot_kickback:
    hit_events: sh_kickback_hit
    enable_events: reset_hackshots
    disable_events: disable_hackshots, hackshot_kickback_hit
    reset_events: reset_hackshots
    profile: overlord_target_profile
    show_tokens:
      leds: l_kickback_shield_rgb
    tags: envshot_kickback

show_player:
  reset_hackshots:
    overlord_hackshots_off_show:
      key: overlord_hackshots_show
      action: play
      priority: 1 # Lowest priority so individual shots will supercede
      show_tokens:
        leds: lane_shields
  enable_jackpotshot:
    overlord_hackshots_solid_show:
      key: overlord_hackshots_show
      action: play
      priority: 10  # Higher than lit hackshots, lower than frozen hackshots
  disable_hackshots:
    overlord_hackshots_frozen_show:
      key: overlord_hackshots_show
      action: play
      priority: 20 # Higher than all other hackshot shows
  hackshots_hit:
    flash_all_shields_show:
      speed: 8
      loops: 8
      priority: 50
      show_tokens:
        color: 11FF22 #color_overlord_green
  mode_overlordmultiball_will_stop:
    overlord_hackshots_show:
      action: stop

shows:
  # Shows for ALL of the lane shots
  overlord_hackshots_off_show:
    - lights:
        lane_shields: off
  overlord_hackshots_solid_show:
    - lights:
        lane_shields: 11FF22 #color_overlord_green
  overlord_hackshots_frozen_show:
    - lights:
        lane_shields: FF4400 #color_overlord_orange
  # Shows for an INDIVIDUAL lane shot
  overlord_hackshot_lit_show:
    - time: 0
      lights:
        (leds): 11FF22 #color_overlord_green
    - time: '+1'
      lights:
        (leds): black
  overlord_hackshot_frozen_show:
    - lights:
        (leds): FF4400 #color_overlord_orange
  # Show for the JACKPOT shot
  overlord_jackpot_show:
    - duration: 1s
      lights:
        l_hitbank_shield_rgb: FF4400  #color_overlord_orange
        l_hitbank_top: on
    - duration: 500ms
      lights:
        l_hitbank_shield_rgb: black
        l_hitbank_top: off
    - duration: 1s
      lights:
        l_hitbank_shield_rgb: 11FF22 #color_overlord_green
        l_hitbank_bot: on
    - duration: 500ms
      lights:
        l_hitbank_shield_rgb: black
        l_hitbank_bot: off

slide_player:
  mode_overlordmultiball_started:
    overlord_ball_locked_slide_full:
      expire: 4s

slides:
  overlord_ball_locked_slide_full:
    widgets:
      - type: text
        text: OVERLORD
        style: dmd_big
        anchor_y: bottom
        y: middle+2
      - type: text
        text: MULTIBALL
        style: dmd_big
        anchor_y: top
        y: middle-2

sound_player:
  play_music_1:
    overlord_music_1:
      action: play
      fade_out: 1s
      mode_end_action: stop
  play_music_2:
    overlord_music_2:
      action: play
      fade_out: 1s
      mode_end_action: stop
  mode_overlordmultiball_started: archer_start
  hackshots_frozen_hit{device.counters.jackpots_hit_counter.value==0}: vi_yell
  hackshots_frozen_hit{device.counters.jackpots_hit_counter.value==1}: vi_scream
  hackshots_frozen_hit{device.counters.jackpots_hit_counter.value>=2}: vi_quietplease
  enable_jackpotshot: upload_sound
  jackpotshot_hit: upload_lost

sound_pools:
  archer_start:
    sounds: archer_get_to_server_room, archer_you_have_to_hurry
    type: random_force_all
    track: voice
  upload_sound:
    sounds: upload_1, upload_2, upload_3, upload_4
    type: random_force_all
    track: voice
  vi_quietplease:
    sounds: vi_quietplease_1, vi_quietplease_2, vi_quietplease_3, vi_quietplease_4
    type: random
    track: sfx
  vi_scream:
    sounds: vi_scream_1, vi_scream_2, vi_scream_3
    type: random
    track: sfx
  vi_yell:
    sounds: vi_yell_1, vi_yell_2, vi_yell_3
    type: random
    track: sfx

sounds:
  overlord_music_1:
    file: OVR.04.Combat_Troops.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
    markers:
      - time: 90s
        events: play_music_2
  overlord_music_2:
    file: OVR.02.Boss_Combat.ogg
    track: music
    fade_out: 1s
    mode_end_action: stop
    markers:
      - time: 96s
        events: play_music_1
  archer_get_to_server_room:
    file: DLC_UNC_Pack01_Int.291.ogg
    track: voice
  archer_you_have_to_hurry:
    file: DLC_UNC_Pack01_Int.012.ogg
    track: voice
  upload_1:
    file: DLC_UNC_Pack01_Int.475.ogg
    track: voice
  upload_2:
    file: DLC_UNC_Pack01_Int.477.ogg
    track: voice
  upload_3:
    file: DLC_UNC_Pack01_Int.479.ogg
    track: voice
  upload_4:
    file: DLC_UNC_Pack01_Int.480.ogg
    track: voice
  upload_lost:
    file: DLC_UNC_Pack01_Int.478.ogg
    track: voice
  vi_quietplease_1:
    file: DLC_UNC_Pack01_Int.124.ogg
    track: sfx
  vi_quietplease_2:
    file: DLC_UNC_Pack01_Int.125.ogg
    track: sfx
  vi_quietplease_3:
    file: DLC_UNC_Pack01_Int.126.ogg
    track: sfx
  vi_quietplease_4:
    file: DLC_UNC_Pack01_Int.127.ogg
    track: sfx
  vi_scream_1:
    file: DLC_UNC_Pack01_Int.162.ogg
    track: sfx
  vi_scream_2:
    file: DLC_UNC_Pack01_Int.163.ogg
    track: sfx
  vi_scream_3:
    file: DLC_UNC_Pack01_Int.164.ogg
    track: sfx
  vi_yell_1:
    file: DLC_UNC_Pack01_Int.168.ogg
    track: sfx
  vi_yell_2:
    file: DLC_UNC_Pack01_Int.196.ogg
    track: sfx
  vi_yell_3:
    file: DLC_UNC_Pack01_Int.197.ogg
    track: sfx



