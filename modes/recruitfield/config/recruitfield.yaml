#config_version=5

#####
# RECRUIT FIELD MODE
#
# This mode is the "generic" gameplay experience, i.e. what's happening when no
# other mode is active. It's got logic for lighting all the recruitment mission
# shots and tracking the hit counts for each of them.
#
# For now, it also has responsibility for the N7 Assignments counter and mode
# start logic, because we will only want to start N7 Assignments when we're
# in Recruit Field mode (i.e. never during any other mode)
#####

mode:
  start_events: start_mode_recruitfield
  stop_events: stop_mode_recruitfield, ball_will_end
  priority: 400

event_player:
  mode_recruitfield_started: enable_recruit_shots, disable_fullorbit
  mode_recruitfield_will_stop: disable_recruit_shots, enable_fullorbit
  logicblock_n7_hits_counter_complete: start_mode_n7_assignments
  recruit_garrus_shot_hit: set_last_recruit_garrus
  recruit_grunt_shot_hit: set_last_recruit_grunt
  recruit_jack_shot_hit: set_last_recruit_jack
  recruit_kasumi_shot_hit: set_last_recruit_kasumi
  recruit_legion_shot_hit: set_last_recruit_legion
  recruit_mordin_shot_hit: set_last_recruit_mordin
  recruit_samara_shot_hit: set_last_recruit_samara
  recruit_tali_shot_hit: set_last_recruit_tali
  recruit_thane_shot_hit: set_last_recruit_thane
  recruit_zaeed_shot_hit: set_last_recruit_zaeed

# These are used to track how many times each recruitment shot has been hit.
# Could maybe be replaced with better shot profile implementation?
counters:
  n7_hits_counter:
    starting_count: 40
    count_complete_value: 0
    direction: down
    count_events: n7_advance_shot_hit
    disable_on_complete: false
    reset_on_complete: true
    persist_state: true
  recruit_garrus_counter:
    count_events: recruit_garrus_shot_hit
    multiple_hit_window: 500ms
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_hit: recruit_advance, recruit_advance_garrus
    events_when_complete: recruit_lit, recruit_garrus_lit
  recruit_grunt_counter:
    count_events: recruit_grunt_shot_hit
    multiple_hit_window: 1000ms
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_hit: recruit_advance, recruit_advance_grunt
    events_when_complete: recruit_lit, recruit_grunt_lit
  recruit_jack_counter:
    count_events: recruit_jack_shot_hit
    multiple_hit_window: 300ms
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_hit: recruit_advance, recruit_advance_jack
    events_when_complete: recruit_lit, recruit_jack_lit
  recruit_kasumi_counter:
    count_events: recruit_kasumi_shot_hit
    multiple_hit_window: 500ms
    events_when_hit: recruit_advance, recruit_advance_kasumi
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_kasumi_lit
  recruit_legion_counter:
    count_events: recruit_legion_shot_hit
    events_when_hit: recruit_advance, recruit_advance_legion
    multiple_hit_window: 500ms
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_legion_lit
  recruit_mordin_counter:
    count_events: recruit_mordin_shot_hit
    multiple_hit_window: 800ms
    events_when_hit: recruit_advance, recruit_advance_mordin
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_mordin_lit
  recruit_samara_counter:
    count_events: recruit_samara_shot_hit
    multiple_hit_window: 500ms
    events_when_hit: recruit_advance, recruit_advance_samara
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_samara_lit
  recruit_tali_counter:
    count_events: recruit_tali_shot_hit
    multiple_hit_window: 500ms
    events_when_hit: recruit_advance, recruit_advance_tali
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_tali_lit
  recruit_thane_counter:
    count_events: recruit_thane_shot_hit
    multiple_hit_window: 500ms
    events_when_hit: recruit_advance, recruit_advance_thane
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_thane_lit
  recruit_zaeed_counter:
    count_events: recruit_zaeed_shot_hit
    multiple_hit_window: 1000ms
    events_when_hit: recruit_advance, recruit_advance_zaeed
    starting_count: 4
    count_complete_value: 1
    direction: down
    persist_state: true
    disable_on_complete: true
    reset_on_complete: false
    events_when_complete: recruit_lit, recruit_zaeed_lit

scoring:
  recruit_advance_garrus:
    status_garrus: -1
  recruit_advance_grunt:
    status_grunt: -1
  recruit_advance_jack:
    status_jack: -1
  recruit_advance_kasumi:
    status_kasumi: -1
  recruit_advance_legion:
    status_legion: -1
  recruit_advance_mordin:
    status_mordin: -1
  recruit_advance_samara:
    status_samara: -1
  recruit_advance_tali:
    status_tali: -1
  recruit_advance_thane:
    status_thane: -1
  recruit_advance_zaeed:
    status_zaeed: -1

shots:
  n7_advance_shot:
    switches: s_bumper_bottom, s_bumper_right, s_bumper_left
    enable_events: enable_recruit_shots
    disable_events: disable_recruit_shots
  # These shots need to exist in base so mission events will advance them
  # even when the field mode is not running
  recruit_garrus_shot:
    hit_events: sh_left_ramp_hit
    profile: recruit_profile
    advance_events: recruit_garrus_lit
    enable_events:
      enable_recruit_shots{current_player.status_garrus>0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_garrus
      lit: color_shield_blue
      color: 0E1B4F #color_garrus
    tags: recruit_shot
    debug: true
  recruit_grunt_shot:
    hit_events: sh_left_orbit_hit
    profile: recruit_profile
    advance_events: recruit_grunt_lit
    enable_events:
      enable_recruit_shots{current_player.status_grunt>0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_grunt
      lit: color_shield_orange
      color: ED3A00 #color_grunt
    tags: recruit_shot
    debug: true
  recruit_jack_shot:
    hit_events: sh_kickback_hit
    profile: recruit_profile
    advance_events: recruit_jack_lit
    enable_events:
      enable_recruit_shots{current_player.status_jack>0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_jack
      lit: color_shield_purple
      color: 6F00FF #color_jack
    tags: recruit_shot
  recruit_kasumi_shot:
    hit_events: sh_right_ramp_hit
    profile: recruit_profile
    advance_events: recruit_kasumi_lit
    enable_events:
      enable_recruit_shots{current_player.status_kasumi>0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_kasumi
      lit: color_shield_yellow
      color: F7F315 #color_kasumi
    tags: recruit_shot
  recruit_legion_shot:
    hit_events: sh_kickback_hit
    profile: recruit_profile
    advance_events: recruit_legion_lit
    enable_events:
      enable_recruit_shots{current_player.status_jack<=0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_legion
      lit: color_shield_white
      color: FFFFFF #color_legion
    tags: recruit_shot
  recruit_mordin_shot:
    hit_events: sh_right_orbit_hit
    profile: recruit_profile
    advance_events: recruit_mordin_lit
    enable_events:
      enable_recruit_shots{current_player.status_mordin>0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_mordin
      lit: color_shield_red
      color: BD000A #color_mordin
    tags: recruit_shot
  recruit_samara_shot:
    hit_events: sh_left_ramp_hit
    profile: recruit_profile
    advance_events: recruit_samara_lit
    enable_events:
      enable_recruit_shots{current_player.status_garrus<=4}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_samara
      color: 0037FF #color_samara
    tags: recruit_shot
  recruit_tali_shot:
    hit_events: sh_right_orbit_hit
    profile: recruit_profile
    advance_events: recruit_tali_lit
    enable_events:
      enable_recruit_shots{current_player.status_mordin<=0}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_tali
      color: D323FF #color_tali
    tags: recruit_shot
  recruit_thane_shot:
    hit_events: sh_right_ramp_hit
    profile: recruit_profile
    advance_events: recruit_thane_lit
    enable_events:
      enable_recruit_shots{current_player.status_kasumi<=4}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_thane
      lit: color_shield_green
      color: 00FF00 #color_thane
    tags: recruit_shot
  recruit_zaeed_shot:
    hit_events: sh_left_orbit_hit
    profile: recruit_profile
    advance_events: recruit_zaeed_lit
    enable_events:
      enable_recruit_shots{current_player.status_grunt<=4}: 0
    disable_events: disable_recruit_shots
    show_tokens:
      led: shot_shield_zaeed
      color: FF0000 #color_zaeed
    tags: recruit_shot


show_player:
  mode_recruitfield_started{current_player.available_missions>0}:
    missions_available_show:
      action: play
  player_available_missions{value>0}:
    missions_available_show:
      action: play

shows:
  missions_available_show:
    - time: 0
      lights:
        l_left_ramp_arrow_clear: white
    - time: '+1'
      lights:
        l_left_ramp_arrow_clear: black

slide_player:
  recruit_advance{count==3}:
    recruiting_advance_slide_2:
      expire: 1s
  recruit_advance{count==2}:
    recruiting_advance_slide_1:
      expire: 1s
  recruit_advance{count==1}:
    recruiting_advance_slide_lit:
      expire: 2s

slides:
  recruiting_advance_slide_2:
    widgets:
      - type: text
        text: Recruit (last_recruit)
        font_name: Quadrit
        font_size: 10
        anchor_y: bottom
        y: bottom+45%
      - type: text
        text: 2 shots to light
        anchor_y: bottom
        style: dmd_small
        y: 3
  recruiting_advance_slide_1:
    widgets:
      - type: text
        text: Recruit (last_recruit)
        font_name: Quadrit
        font_size: 10
        anchor_y: bottom
        y: bottom+45%
      - type: text
        text: 1 shot to light
        style: dmd_small
        anchor_y: bottom
        y: 3
  recruiting_advance_slide_lit:
    widgets:
      - type: text
        text: (last_recruit) Ready!
        font_name: Quadrit
        font_size: 10
        anchor_y: bottom
        y: bottom+45%
      - type: text
        text: Left Ramp to Start Mission
        style: dmd_small
        anchor_y: bottom
        y: 3

sound_player:
  # mode_recruitfield_started:
  #   music_normandy_walkin_intro:
  #     action: play
  #     loops: -1
  #     mode_end_action: stop
  recruit_advance_garrus:
    shot_hit_garrus:
      action: play
      max_queue_time: 1s
  recruit_advance_grunt:
    shot_hit_grunt:
      action: play
      max_queue_time: 1s
  recruit_advance_jack:
    shot_hit_jack:
      action: play
      max_queue_time: 1s
  recruit_advance_mordin:
    shot_hit_mordin:
      action: play
      max_queue_time: 1s
  recruit_advance_tali:
    shot_hit_tali:
      action: play
      max_queue_time: 1s

sound_pools:
  shot_hit_garrus:
    type: random_force_all
    sounds: garrus_shot_sound_1, garrus_shot_sound_2, garrus_shot_sound_3
    track: voice
  shot_hit_grunt:
    type: random_force_all
    sounds: grunt_shot_sound_1, grunt_shot_sound_2, grunt_shot_sound_3, grunt_shot_sound_4, grunt_shot_sound_5
    track: voice
  shot_hit_jack:
    type: random_force_all
    sounds: jack_shot_sound_1, jack_shot_sound_2, jack_shot_sound_3, jack_shot_sound_4, jack_shot_sound_5
    track: voice
  shot_hit_mordin:
    type: random_force_all
    sounds: mordin_shot_sound_1, mordin_shot_sound_2, mordin_shot_sound_3, mordin_shot_sound_4, mordin_shot_sound_5
    track: voice
  shot_hit_samara:
    type: random_force_all
    sounds: samara_shot_sound_1, samara_shot_sound_2, samara_shot_sound_3, samara_shot_sound_4, samara_shot_sound_5
    track: voice
  shot_hit_tali:
    type: random_force_all
    sounds: tali_shot_sound_1, tali_shot_sound_2, tali_shot_sound_3, tali_shot_sound_4
    track: voice

sounds:
  garrus_shot_sound_1:
    file: en_us_hench_garrus_ss_global_hench_garrus_00303204_m.ogg
    track: voice
  garrus_shot_sound_2:
    file: en_us_hench_garrus_ss_global_hench_garrus_00330893_m.ogg
    track: voice
  garrus_shot_sound_3:
    file: en_us_hench_garrus_ss_global_hench_garrus_00330906_m.ogg
    track: voice
  grunt_shot_sound_1:
    file: en_us_hench_grunt_ss_global_hench_grunt_00316600_m.ogg
    track: voice
  grunt_shot_sound_2:
    file: en_us_hench_grunt_ss_global_hench_grunt_00317212_m.ogg
    track: voice
  grunt_shot_sound_3:
    file: en_us_hench_grunt_ss_global_hench_grunt_00331036_m.ogg
    track: voice
  grunt_shot_sound_4:
    file: en_us_hench_grunt_ss_global_hench_grunt_00331040_m.ogg
    track: voice
  grunt_shot_sound_5:
    file: en_us_hench_grunt_ss_global_hench_grunt_00295739_m.ogg
    track: voice
  jack_shot_sound_1:
    file: en_us_hench_convict_ss_global_hench_convict_00286790_m.ogg
    track: voice
  jack_shot_sound_2:
    file: en_us_hench_convict_ss_global_hench_convict_00286854_m.ogg
    track: voice
  jack_shot_sound_3:
    file: en_us_hench_convict_ss_global_hench_convict_00286835_m.ogg
    track: voice
  jack_shot_sound_4:
    file: en_us_hench_convict_ss_global_hench_convict_00286855_m.ogg
    track: voice
  jack_shot_sound_5:
    file: en_us_hench_convict_ss_global_hench_convict_00286853_m.ogg
    track: voice
  mordin_shot_sound_1:
    file: en_us_hench_professor_ss_global_hench_professor_00316910_m.ogg
    track: voice
  mordin_shot_sound_2:
    file: en_us_hench_professor_ss_global_hench_professor_00316952_m.ogg
    track: voice
  mordin_shot_sound_3:
    file: en_us_hench_professor_ss_global_hench_professor_00316963_m.ogg
    track: voice
  mordin_shot_sound_4:
    file: en_us_hench_professor_ss_global_hench_professor_00316964_m.ogg
    track: voice
  mordin_shot_sound_5:
    file: en_us_hench_professor_ss_global_hench_professor_00331211_m.ogg
    track: voice
  samara_shot_sound_1:
    file: en_us_hench_mystic_ss_global_hench_mystic_00316732_m.ogg
    track: voice
  samara_shot_sound_2:
    file: en_us_hench_mystic_ss_global_hench_mystic_00331131_m.ogg
    track: voice
  samara_shot_sound_3:
    file: en_us_hench_mystic_ss_global_hench_mystic_00331153_m.ogg
    track: voice
  samara_shot_sound_4:
    file: en_us_hench_mystic_ss_global_hench_mystic_00331158_m.ogg
    track: voice
  samara_shot_sound_5:
    file: en_us_hench_mystic_ss_global_hench_mystic_00331164_m.ogg
    track: voice
  tali_shot_sound_1:
    file: en_us_hench_tali_ss_global_hench_tali_00285102_m.ogg
    track: voice
  tali_shot_sound_2:
    file: en_us_hench_tali_ss_global_hench_tali_00285168_m.ogg
    track: voice
  tali_shot_sound_3:
    file: en_us_hench_tali_ss_global_hench_tali_00289284_m.ogg
    track: voice
  tali_shot_sound_4:
    file: en_us_hench_tali_ss_global_hench_tali_00289285_m.ogg
    track: voice

widget_player:
  logicblock_n7_hits_counter_hit:
    n7_progress_widget:
      action: update
      widget_settings:
        expire: 2s

widgets:
  n7_progress_widget:
    - type: text
      text: "N7 assignment in (count)"
      style: dmd_small
      anchor_y: bottom
      anchor_x: left
      y: 2
      x: 2
      z: 2
    - type: rectangle
      width: 128
      height: 8
      color: 000000
      anchor_y: bottom
      anchor_x: left
      x: 0
      y: 0
      z: 1
