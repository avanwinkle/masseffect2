#config_version=5

#####
# GARRUS RECRUIT MISSION
#
# This mode begins with three security doors to close, on a timer, indicated by
# three lit shots. The doors are on a hurry-up and hitting one adds some time.
# Failing the timer ends the mode; hitting all three shots will light the right
# ramp to collect the combined hurry-up value and complete the mission. The
# standup targets are worth points as eclipse, blood pack, and blue suns
# mercenaries.
#
# Progress is not saved and this mode must be restarted if failed.
#####

mode:
  start_events: start_mode_recruitgarrus
  stop_events: stop_mode_recruitgarrus, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

event_player:
  mode_recruitgarrus_started.1:
    set_environment:
      env: bloodpack
    show_recruit_instructions:
      squadmate: garrus
      portrait: recruitgarrus
      instructions_main: Defend Archangel
      instructions_sub: Close the Shutters
    set_mission_shots:
      shots_total: 4
      is_resumable: 0
      shots_remaining:
        value: device.counters.doors_closed_counter.value
        type: int
  mode_recruitgarrus_started.2:
    - play_garrus_intro_shutters{device.counters.doors_closed_counter.value>1}
    - play_garrus_intro_upstairs{device.counters.doors_closed_counter.value==1}
  logicblock_doors_closed_counter_hit.100: mission_shot_hit
  logicblock_doors_closed_counter_hit{count==1}:
    mission_collect_score: {}
    show_recruit_instructions:
      squadmate: garrus
      portrait: recruitgarrus
      instructions_main: Shutters Closed
      instructions_sub: Get back upstairs!
  logicblock_doors_closed_counter_complete: mission_collect_score, recruit_garrus_complete

counters:
  doors_closed_counter:
    starting_count: 4
    count_complete_value: 0
    direction: down
    count_events:
      - close_doors_lit_hit
      - clear_upstairs_hit
    reset_events: mode_recruitgarrus_started{device.counters.doors_closed_counter.value>1}
    persist_state: true

shot_groups:
  close_doors:
    shots: center_door, left_door, right_door
    reset_events: mode_recruitgarrus_started
    disable_events: close_doors_hit_complete
  clear_upstairs:
    shots: stairs
    reset_events: mode_recruitgarrus_started

shots:
  center_door:
    hit_events: sh_kickback_hit
    profile: lane_shot_profile
    show_tokens:
      leds: l_kickback_ring
      color: color_garrus
    tags: envshot_kickback, power_target, power_target_kickback
  left_door:
    hit_events: sh_left_orbit_hit
    profile: lane_shot_profile
    show_tokens:
      leds: l_left_orbit_ring
      color: color_garrus
    tags: envshot_left_orbit, power_target, power_target_left_orbit
  right_door:
    hit_events: sh_right_orbit_hit
    profile: lane_shot_profile
    show_tokens:
      leds: l_right_orbit_ring
      color: color_garrus
    tags: envshot_right_orbit, power_target, power_target_right_orbit
  stairs:
    hit_events: sh_right_ramp_hit
    profile: lane_shot_profile
    enable_events: close_doors_hit_complete
    show_tokens:
      leds: l_right_ramp_ring
      color: color_garrus
    tags: envshot_right_ramp, power_target, power_target_right_ramp

sound_player:
  mode_recruitgarrus_started:
    music_recruit_garrus:
      action: play
      loops: -1
  play_garrus_intro_shutters:
    garrus_mission_start:
      action: play
  play_garrus_intro_upstairs:
    garrus_last_shutter:
      action: play
  logicblock_doors_closed_counter_hit{count==3}:
    garrus_two_more_shutters:
      max_queue_time: 1s
  logicblock_doors_closed_counter_hit{count==2}:
    garrus_one_more_shutter:
      max_queue_time: 1s
  logicblock_doors_closed_counter_hit{count==1}:
    garrus_last_shutter:
      max_queue_time: 2s
  logicblock_doors_closed_counter_complete:
    music_recruit_garrus:
      action: stop
  envshot_outlane_hit: boss_sound

sound_pools:
  garrus_mission_start:
    type: random
    track: voice
    sounds: garrus_give_these_bastards_everything, garrus_get_those_doors_closed, garrus_you_deal_with_shutters
    max_queue_time: 1s
  garrus_last_shutter:
    type: random
    track: voice
    sounds: garrus_final_1, garrus_final_2, garrus_final_3
    max_queue_time: 1s
  boss_sound:
    sounds: boss_finish_her, boss_now_youre_mine_archangel, boss_i_told_you_id_finish_you
    track: voice
    max_queue_time: 500ms

sounds:
  music_recruit_garrus:
    file: mus_garrus_acq_combat_1.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  garrus_give_these_bastards_everything:
    file: en_us_hench_garrus_omggra_garrus_intro_d_00206435_m.ogg
    track: voice
  garrus_get_those_doors_closed:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00227793_m.ogg
    track: voice
  garrus_you_deal_with_shutters:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00228351_m.ogg
    track: voice
  garrus_two_more_shutters:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00205199_m.ogg
    track: voice
  garrus_one_more_shutter:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00205200_m.ogg
    track: voice
  garrus_final_1:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00206067_m.ogg
    track: voice
  garrus_final_2:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00206056_m.ogg
    track: voice
  garrus_final_3:
    file: en_us_hench_garrus_omggra_garrus_wave1_a_00206090_m.ogg
    track: voice
  boss_finish_her:
    file: en_us_omggra_bloodpack_boss_ss_omggra_bloodpack_boss_00243130_m.ogg
    track: voice
  boss_now_youre_mine_archangel:
    file: en_us_omggra_bloodpack_boss_ss_omggra_bloodpack_boss_00243152_m.ogg
    track: voice
  boss_i_told_you_id_finish_you:
    file: en_us_omggra_bloodpack_boss_ss_omggra_bloodpack_boss_00243158_m.ogg
    track: voice

light_player:
  mode_recruitgarrus_started:
    light_backwall_ambient:
      color: color_garrus
