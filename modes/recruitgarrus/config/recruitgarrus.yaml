#config_version=5
mode:
  start_events: start_mode_recruitgarrus
  stop_events: stop_mode_recruitgarrus
  priority: 500

event_player:
  door_closed: add_time
  clear_upstairs_complete: recruit_garrus_complete
  recruit_garrus_complete:
    recruit_mission_success:
      squadmate: garrus
    stop_mode_recruitgarrus:
      delay: 2s
  timer_garrustimer_complete: stop_mode_recruitgarrus
  mode_recruitgarrus_stopping: recruit_mission_ended

counters:
  doors_closed_counter:
    starting_count: 0
    count_complete_value: 3
    count_events: close_doors_door_shot_profile_lit_hit
    events_when_hit: door_closed
    direction: up
    disable_on_complete: true
    reset_events: mode_recruitgarrus_started
    reset_on_complete: false

timers:
  garrustimer:
    start_value: 40
    end_value: 0
    tick_interval: 1s
    direction: down
    start_running: yes
    control_events:
      - event: add_time
        action: add
        value: 12
      - event: clear_upstairs_complete
        action: stop

sound_player:
  mode_recruitgarrus_started:
    music_recruit_garrus:
      action: play
      loops: -1
    garrus_upstairs_complete:
      action: play
  door_closed{count==1}: garrus_two_more_shutters
  door_closed{count==2}: garrus_one_more_shutter
  door_closed{count==3}: garrus_last_shutter
  clear_upstairs_complete:
    garrus_upstairs_complete:
      action: play
    music_recruit_garrus:
      action: stop

sounds:
  music_recruit_garrus:
    file: mus_garrus_acq_combat_1.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  garrus_mission_start:
    file: en_us_hench_garrus_omggra_garrus_intro_d_00206435_m.ogg
    track: voice
  garrus_two_more_shutters:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00205199_m.ogg
    track: voice
  garrus_one_more_shutter:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00205200_m.ogg
    track: voice
  garrus_last_shutter:
    file: en_us_hench_garrus_omggra_garrus_wave2_a_00206067_m.ogg
    track: voice
  garrus_upstairs_complete:
    file: en_us_hench_garrus_omggra_garrus_intro_d_00206434_m.ogg
    track: voice


shots:
  center_door:
    switch: s_kickback
    profile: door_shot_profile
    show_tokens:
      led: l_kickback_shield_rgb
  left_door:
    switch: s_left_orbit
    profile: door_shot_profile
    show_tokens:
      led: l_left_orbit_shield_rgb
  right_door:
    switch: s_right_orbit
    profile: door_shot_profile
    show_tokens:
      led: l_right_orbit_shield_rgb
  stairs:
    switch: s_right_ramp_exit
    profile: upstairs_shot_profile
    enable_events: close_doors_complete
    show_tokens:
      led: l_right_ramp_shield_rgb

shot_groups:
  close_doors:
    shots: center_door, left_door, right_door
    reset_events: mode_recruitgarrus_started
    disable_events: close_doors_complete
  clear_upstairs:
    shots: stairs
    reset_events: mode_recruitgarrus_started


shot_profiles:
  door_shot_profile:
    states:
      - name: lit
        show: door_shot_show
      - name: hit
        show: off
  upstairs_shot_profile:
    show_when_disabled: false
    states:
      - name: lit
        show: door_shot_show
      - name: hit
        show: on

shows:
  door_shot_show:
    - time: 0
      lights:
        (led): green
    - time: +1
      lights:
        (led): black

slide_player:
  close_doors_complete:
    doors_closed_slide:
      expire: 2s

slides:
  doors_closed_slide:
    widgets:
      - type: text
        text: Shutters Closed
        style: dmd_med
        anchor_y: bottom
        y: middle+2
      - type: text
        text: Get Back Upstairs!
        style: dmd_med
        anchor_y: top
        y: middle-2

widget_player:
  timer_garrustimer_start: time_remaining_widget
  timer_garrustimer_tick:
    time_remaining_widget:
      action: update

widgets:
  time_remaining_widget:
    - type: text
      text: (ticks_remaining)
      anchor_x: left
      anchor_y: top
      x: left+2
      y: top-2
      font_size: 8
