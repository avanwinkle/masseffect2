#config_version=5

#####
# GRUNT RECRUITMENT MISSION
#
# All shots are lit on this mode with a brief timer; hitting a shot un-lights it
# and adds to the timer. Values are collected immediately based on the timer
# amount remaining with a multiple of the number of consecutive shots hit (i.e.
# restarting the mode reduces maximum value). The mode is completed when all
# shots have been hit, and ends if the timer expires.
#
# Progress is saved after every shot hit.
#####

mode:
  start_events: start_mode_recruitgrunt
  stop_events: stop_mode_recruitgrunt, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

event_player:
  mode_recruitgrunt_started:
    set_environment:
      env: krogan
  recruittimer_start: recruittimer_set_twenty
  # Add time for each successful shot, but jump directly to 12 instead of adding 12
  logicblock_grunt_shots_counter_hit{device.timers.recruittimer.ticks<=12}: recruittimer_set_twelve
  logicblock_grunt_shots_counter_complete: recruit_grunt_complete

counters:
  grunt_shots_counter:
    starting_count: 0
    count_complete_value: 5
    count_events: grunt_shots_lit_hit
    disable_on_complete: true
    reset_on_complete: false
    persist_state: true

#####
# GRUNT variable_player:
#    Hurryup starts at 8,000
#    Hit any lit shot to collect the hurryup
#    New hurryup is 8,000 plus 50% bonus for each hit shot *since mode start*
#    Hurryup depletion is fixed (always 390 points-per-second)
#    Hit all 5 shots to complete the mission
#    Progress is saved after each shot (but the bonus multiplier resets)
#####
variable_player:
  mode_recruitgrunt_started:
    temp_hurryup_value:
      action: set
      int: 8000
    temp_multiplier:
      action: set
      int: 1
    temp_build_value:
      action: set
      int: 0
  timer_recruittimer_tick{current_player.temp_multiplier>0}:
    temp_hurryup_value: -390
  logicblock_grunt_shots_counter_hit:
    # Capture the net hurryup value, but display the cumulative captured + hurryup
    score: current_player.temp_hurryup_value- current_player.temp_build_value
    # temp_build value is how much has already been captured, while temp_hurryup is that plus new hurryup value
    temp_build_value:
      action: set
      int: current_player.temp_hurryup_value - current_player.temp_build_value
    # Each consecutive hit increases the hurryup starting value by 50%
    temp_hurryup_value:
      action: add
      int: 8000 * (1 + (current_player.temp_multiplier * 0.5))

shot_groups:
  grunt_shots:
    shots: grunt_left_ramp, grunt_left_orbit, grunt_right_ramp, grunt_right_orbit, grunt_kickback

shots:
  grunt_left_ramp:
    hit_events: sh_left_ramp_hit
    disable_events: grunt_left_ramp_hit
    profile: color_flashing_profile
    show_tokens:
      leds: l_left_ramp_shield_rgb
      color: FF6611 #color_grunt
    tags: envshot_left_ramp
  grunt_left_orbit:
    hit_events: sh_left_orbit_hit
    disable_events: grunt_left_orbit_hit
    profile: color_flashing_profile
    show_tokens:
      leds: l_left_orbit_shield_rgb
      color: FF6611 #color_grunt
    tags: envshot_left_orbit
  grunt_right_ramp:
    hit_events: sh_right_ramp_hit
    disable_events: grunt_right_ramp_hit
    profile: color_flashing_profile
    show_tokens:
      leds: l_right_ramp_shield_rgb
      color: FF6611 #color_grunt
    tags: envshot_right_ramp
  grunt_right_orbit:
    hit_events: sh_right_orbit_hit
    disable_events: grunt_right_orbit_hit
    profile: color_flashing_profile
    show_tokens:
      leds: l_right_orbit_shield_rgb
      color: FF6611 #color_grunt
    tags: envshot_right_orbit
  grunt_kickback:
    hit_events: sh_kickback_hit
    disable_events: grunt_kickback_hit
    profile: color_flashing_profile
    show_tokens:
      leds: l_kickback_shield_rgb
      color: FF6611 #color_grunt
    tags: envshot_kickback

show_player:
  logicblock_grunt_shots_counter_hit:
    flash_all_shields_show:
      loops: 6
      speed: 12
      priority: 100
      show_tokens:
        color: FF6611 #color_grunt

slide_player:
  mode_recruitgrunt_started:
    grunt_instructions_slide:
      expire: 3s

slides:
  grunt_instructions_slide:
    widgets:
      - type: text
        text: COMPLETE ALL SHOTS
        style: dmd_small
        anchor_y: bottom
        y: middle+4
        z: 1
      - type: text
        text: TO DEFEAT KROGAN
        style: dmd_small
        anchor_y: top
        y: middle-4
        z: 1
      - type: rectangle
        width: 128
        height: 32
        color: 000000

sound_player:
  mode_recruitgrunt_started:
    music_recruit_grunt:
      action: play
      mode_end_action: stop
  logicblock_grunt_shots_counter_hit{count<3}: grunt_dialogue
  logicblock_grunt_shots_counter_hit{count==3}: grunt_dialogue_4
  logicblock_grunt_shots_counter_hit{count==4}: grunt_bossdialogue
  grunt_shots_complete:
    music_recruit_grunt:
      action: stop

sound_pools:
  music_recruit_grunt:
    type: random
    sounds: music_recruit_grunt_1, music_recruit_grunt_2
    track: music
  grunt_bossdialogue:
    type: random
    sounds: grunt_bossdialogue_1, grunt_bossdialogue_2
    track: voice
  grunt_dialogue:
    type: random_force_all
    sounds: grunt_dialogue_1, grunt_dialogue_2, grunt_dialogue_3
    track: voice

sounds:
  music_recruit_grunt_1:
    file: mus_grunt_acq_combat_1.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  music_recruit_grunt_2:
    file: mus_grunt_acq_combat_2b.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  grunt_bossdialogue_1:
    file: en_us_jnkkga_boss_jnkkga_mercbossfight_a_00282305_m.ogg
    track: voice
    max_queue_time: 1s
  grunt_bossdialogue_2:
    file: en_us_jnkkga_boss_jnkkga_mercbossfight_a_00282306_m.ogg
    track: voice
    max_queue_time: 1s
  grunt_dialogue_1:
    file: en_us_jnkkga_moremercs_jnkkga_moremercs_a_00310955_m.ogg
    track: voice
    max_queue_time: 1s
  grunt_dialogue_2:
    file: en_us_jnkkga_moremercs_jnkkga_moremercs_a_00310956_m.ogg
    track: voice
    max_queue_time: 1s
  grunt_dialogue_3:
    file: en_us_jnkkga_moremercs_jnkkga_moremercs_a_00310953_m.ogg
    track: voice
    max_queue_time: 1s
  grunt_dialogue_4:
    file: en_us_jnkkga_moremercs_jnkkga_moremercs_a_00310959_m.ogg
    track: voice
    max_queue_time: 1s
