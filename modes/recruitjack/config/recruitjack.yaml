#config_version=5

#####
# JACK RECRUITMENT MISSION
#
# This round-based mode begins with three ramp/orbit shots lit for hurry-up, and
# a timer. Hitting any of the shots stops the hurry-up value depletion (but
# doesnâ€™t stop the timer) and lights the hitbank; hitting the hitbank captures
# the hurry-up value and starts the next round. The second round and third
# rounds have only two hurry-up shots lit. Collecting all three rounds completes
# the mode; the mode ends if the timer expires.
#
# Progress is saved after each round (ramp/orbit shot + hitbank shot).
#####
mode:
  start_events: start_mode_recruitjack
  stop_events: stop_mode_recruitjack, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

event_player:
  mode_recruitjack_started:
    set_environment:
      env: bluesuns
    show_recruit_instructions:
      squadmate: jack
      portrait: recruitjack
      instructions_main: Hit Shots to Light Bank
      instructions_sub: 3x Banks to Defeat Warden
    set_mission_shots:
      is_resumable: 1
      shots_total: 3  # Each round counts as a shot
      shots_remaining:
        value: device.counters.jack_rounds_counter.value
        type: int
  ### SCORING capture the value when the hurryup is hit, collect when the round is hit
  jack_hurryup_shots_hit: mission_shot_hit
  logicblock_jack_rounds_counter_hit: mission_collect_score
  logicblock_jack_rounds_counter_complete: recruit_jack_complete

counters:
  jack_rounds_counter:
    starting_count: 3
    count_complete_value: 0
    count_events: jack_hitbank_shot_hit
    multiple_hit_window: 500ms # In case both hitbanks are hit together
    direction: down
    disable_on_complete: true
    reset_on_complete: false
    persist_state: true

shot_groups:
  jack_hurryup_shots:
    shots: jack_left_orbit, jack_kickback, jack_left_ramp, jack_right_ramp, jack_right_orbit
    enable_events: just_dont
    disable_events: jack_hurryup_shots_hit, mode_recruitjack_will_stop
  jack_shots_one:
    shots: jack_kickback, jack_left_orbit, jack_right_orbit
    enable_events:
      - mode_recruitjack_started{device.counters.jack_rounds_counter.value==3}
  jack_shots_two:
    shots: jack_left_ramp, jack_right_ramp
    enable_events:
      - mode_recruitjack_started{device.counters.jack_rounds_counter.value==2}
      - logicblock_jack_rounds_counter_hit{count==2}
  jack_shots_three:
    shots: jack_left_orbit, jack_right_orbit
    enable_events:
      - mode_recruitjack_started{device.counters.jack_rounds_counter.value==1}
      - logicblock_jack_rounds_counter_hit{count==1}

shots:
  jack_left_orbit:
    hit_events: sh_left_orbit_hit
    profile: color_flashing_static
    show_tokens:
      leds: l_left_orbit_shield_rgb
      color: color_jack
    tags: envshot_left_orbit, power_target, power_target_left_orbit
  jack_kickback:
    hit_events: sh_kickback_hit
    profile: color_flashing_static
    show_tokens:
      leds: l_kickback_shield_rgb
      color: color_jack
    tags: envshot_kickback, power_target, power_target_kickback
  jack_left_ramp:
    hit_events: sh_left_ramp_hit
    profile: color_flashing_static
    show_tokens:
      leds: l_left_ramp_shield_rgb
      color: color_jack
    tags: envshot_left_ramp_exit, power_target, power_target_left_ramp
  jack_right_ramp:
    hit_events: sh_right_ramp_hit
    profile: color_flashing_static
    show_tokens:
      leds: l_right_ramp_shield_rgb
      color: color_jack
    tags: envshot_right_ramp_exit, power_target, power_target_left_ramp
  jack_right_orbit:
    hit_events: sh_right_orbit_hit
    profile: color_flashing_static
    show_tokens:
      leds: l_right_orbit_shield_rgb
      color: color_jack
    tags: envshot_right_orbit, power_target, power_target_right_orbit
  jack_hitbank_shot:
    hit_events: sh_hitbank_top_hit, sh_hitbank_bottom_hit
    enable_events: jack_hurryup_shots_hit
    disable_events: jack_hitbank_shot_hit, mode_recruitjack_will_stop
    reset_events: jack_hurryup_shots_hit
    profile: color_flashing_fast_profile
    show_tokens:
      leds: light_hitbank_rgb
      color: color_jack
    tags: envshot_hitbank, power_target_charge

sound_player:
  jack_shots_one_hit:
    jack_shot_hit_sound:
      action: play
      max_queue_time: 1s
      priority: 100
  jack_shots_two_hit:
    jack_shot_hit_sound:
      action: play
      max_queue_time: 1s
      priority: 100
  jack_shots_three_hit:
    jack_shot_hit_sound:
      action: play
      max_queue_time: 1s
      priority: 100
  logicblock_jack_rounds_counter_hit{count==2}:
    warden_shepard_1:
      action: play
      max_queue_time: 1s
      priority: 100
  logicblock_jack_rounds_counter_hit{count==1}:
    warden_shepard_2:
      action: play
      max_queue_time: 1s
      priority: 100
  mode_recruitjack_started:
    music_recruit_jack_1:
      action: play
    warden_start:
      action: play
  play_music_recruit_jack_2:
    music_recruit_jack_2:
      action: play

sound_pools:
  jack_shot_hit_sound:
    sounds: warden_guards_1, warden_guards_2, warden_guards_3
    type: random_force_all
    track: voice

sounds:
  music_recruit_jack_1:
    file: mus_jack_acq_combat_1.ogg
    track: music
    volume: 0.8
    mode_end_action: stop
    fade_out: 1s
    markers:
      - time: 40s
        events: play_music_recruit_jack_2
  music_recruit_jack_2:
    file: mus_jack_acq_combat_2.ogg
    track: music
    fade_out: 1s
    volume: 0.8
    mode_end_action: stop
  warden_start:
    file: en_us_prscva_warden_prscva_warden_pa_a_00282485_m.ogg
    track: voice
  warden_guards_1:
    file: en_us_prscva_warden_prscva_warden_pa_a_00254121_m.ogg
    track: voice
  warden_guards_2:
    file: en_us_prscva_warden_prscva_warden_pa_a_00254124_m.ogg
    track: voice
  warden_guards_3:
    file: en_us_prscva_warden_prscva_warden_pa_a_00271737_m.ogg
    track: voice
  warden_shepard_1:
    file: en_us_prscva_warden_prscva_boss_c_00198326_m.ogg
    track: voice
  warden_shepard_2:
    file: en_us_player_f_prscva_boss_c_00198332_f.ogg
    track: voice
