#config_version=5

#####
# MORDIN RECRUITMENT MISSION
#
# This mode begins with the spinner lit to build value. The first hit to the
# spinner lights the right orbit, hitting the orbit lights both ramps to
# activate the two ventilation fans. Additional spinner hits will continue to
# build value, each additional hit to the orbit increases the built value
# multiplier 1x.  Once both ramps are hit the mission is completed and the score
# is collected (built spinner value * number of orbit hits). The mode ends if
# the timer expires.
#
# Progress is not saved and this mode must be restarted if failed.
#####

mode:
  start_events: start_mode_recruitmordin
  stop_events: stop_mode_recruitmordin, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

event_player:
  mode_recruitmordin_started.1:
    set_environment:
      env: bloodpack
    show_recruit_instructions:
      squadmate: mordin
      portrait: recruitmordin
      instructions_main: Hit orbits to build value
      instructions_sub: 2X Ramps to turn on fans
    set_mission_shots:
      shots_total: 4
      is_resumable: 1
      shots_remaining:
        value: device.counters.cure_counter.value + device.counters.fans_counter.value
        type: int
  mode_recruitmordin_started.2:
    - play_intro_sound{not device.counters.cure_counter.completed}
    - play_cure_sound{device.counters.cure_counter.completed}
  fan_shots_hit_complete: recruit_mordin_complete

counters:
  # The counter lets us play the correct sound for each fan hit
  cure_counter:
    starting_count: 2
    count_complete_value: 0
    direction: down
    count_events: cure_left_lit_hit, cure_right_lit_hit
    events_when_hit: mission_shot_hit
    events_when_complete: enable_fans, play_cure_sound, mission_collect_score
    disable_on_complete: true
    reset_on_complete: false
    persist_state: true
  fans_counter:
    starting_count: 2
    count_complete_value: 0
    direction: down
    count_events: fan_left_lit_hit, fan_right_lit_hit
    events_when_hit: logicblock_fans_counter_hit, mission_shot_hit
    events_when_complete: mission_collect_score
    disable_on_complete: true
    reset_events: mode_recruitmordin_started

shot_groups:
  fan_shots:
    shots: fan_left, fan_right
    reset_events: mode_recruitmordin_started

shots:
  spinner:
    hit_events: sh_spinner_hit
    disable_events: spinner_hit
  cure_left:
    hit_events: sh_left_orbit_hit, right_to_left_orbit_hit
    enable_events: mode_recruitmordin_started
    profile: color_flashing_to_solid_profile
    # tags: envshot_right_orbit. # No env tag so we'll get a sound when its hit
    show_tokens:
      leds: l_left_orbit_shield_rgb
      color: color_mordin
  cure_right:
    hit_events: sh_right_orbit_hit, left_to_right_orbit_hit
    enable_events: cure_left_hit
    profile: color_flashing_to_solid_profile
    show_tokens:
      leds: l_right_orbit_shield_rgb
      color: color_mordin
    tags: envshot_right_orbit
  fan_left:
    hit_events: sh_left_ramp_hit
    enable_events: enable_fans
    profile: color_flashing_fast_profile
    show_tokens:
      leds: l_left_ramp_shield_rgb
      color: color_door_green
    tags: envshot_left_ramp
  fan_right:
    hit_events: sh_right_ramp_hit
    enable_events: enable_fans
    profile: color_flashing_fast_profile
    show_tokens:
      leds: l_right_ramp_shield_rgb
      color: color_door_green
    tags: envshot_right_ramp

light_player:
  mode_recruitgrunt_started:
    light_backwall_ambient:
      color: color_grunt

sound_player:
  mode_recruitmordin_started:
    music_recruit_mordin:
      action: play
      loops: -1
  play_intro_sound: mission_intro
  player_shot_cure_right_enabled{change==1}:
    step0_voice:
      max_queue_time: 1s
  # Use a special event so we can re-play the sound on mission resume
  play_cure_sound:
    step1_voice:
      max_queue_time: 1s
  logicblock_fans_counter_hit{count==1}:
    step2_voice:
      max_queue_time: 1s
  recruit_mordin_complete:
    music_recruit_mordin:
      action: stop
  envshot_outlane_hit:
    recruitmordin_failure_sounds:
      max_queue_time: 500ms

sound_pools:
  step0_voice:
    type: random
    track: voice
    sounds:
      - step0_voice_miranda
      - step0_voice_jacob
      - step0_voice_garrus{current_player.status_garrus>=4}|2
      - step0_voice_kasumi{current_player.status_kasumi>=4}|2
      - step0_voice_zaeed{current_player.status_zaeed>=4}|3
      - step0_voice_tali{current_player.status_tali>=4}|3
      - step0_voice_jack{current_player.status_jack>=4}|2
  step1_voice:
    type: random
    track: voice
    sounds:
      - step1_voice_miranda
      - step1_voice_jacob
      - step1_voice_garrus{current_player.status_garrus>=4}|2
      - step1_voice_kasumi{current_player.status_kasumi>=4}|2
      - step1_voice_grunt{current_player.status_grunt>=4}|2
      - step1_voice_zaeed{current_player.status_zaeed>=4}|3
      - step1_voice_tali{current_player.status_tali>=4}|3
      - step1_voice_jack{current_player.status_jack>=4}|2
  step2_voice:
    type: random
    track: voice
    sounds:
      - step2_voice_miranda
      - step2_voice_jacob
      - step2_voice_garrus{current_player.status_garrus>=4}|2
      - step2_voice_kasumi{current_player.status_kasumi>=4}|2
      - step2_voice_grunt{current_player.status_grunt>=4}|2
      - step2_voice_zaeed{current_player.status_zaeed>=4}|3
      - step2_voice_tali{current_player.status_tali>=4}|3
      - step2_voice_jack{current_player.status_jack>=4}|2
  step3_voice:
    type: random
    track: voice
    sounds: step3_voice_miranda, step3_voice_jacob
  recruitmordin_failure_sounds:
    sounds: vorcha_laughing, vorcha_got_you, krogan_strong_survive, krogan_fear_the_battlemaster
    track: voice
    type: random_force_all

sounds:
  music_recruit_mordin:
    file: mus_mordin_acq_bossbattle_a.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  mission_intro:
    file: en_us_hench_professor_omgpra_mordin_d_00210618_m.ogg
  step0_voice_jack:
    file: en_us_hench_convict_omgpra_plant_shutdown_a_00211827_m.ogg
  step0_voice_tali:
    file: en_us_hench_tali_omgpra_plant_shutdown_a_00211819_m.ogg
  step0_voice_garrus:
    file: en_us_hench_garrus_omgpra_plant_shutdown_a_00211828_m.ogg
  step0_voice_kasumi:
    file: en_us_hench_thief_omgpra_plant_shutdown_a_00211826_m.ogg
  step0_voice_zaeed:
    file: en_us_hench_veteran_omgpra_plant_shutdown_a_00211831_m.ogg
  step0_voice_jacob:
    file: en_us_hench_leading_omgpra_plant_shutdown_a_00211829_m.ogg
  step0_voice_miranda:
    file: en_us_hench_vixen_omgpra_plant_shutdown_a_00211830_m.ogg
  step1_voice_garrus:
    file: en_us_hench_garrus_omgpra_end_puzzle_a_00235508_m.ogg
  step2_voice_garrus:
    file: en_us_hench_garrus_omgpra_end_puzzle_a_00235498_m.ogg
  step3_voice_garrus:
    file: en_us_hench_garrus_omgpra_end_puzzle_a_00235488_m.ogg
  step1_voice_grunt:
    file: en_us_hench_grunt_omgpra_end_puzzle_a_00235486_m.ogg
  step2_voice_grunt:
    file: en_us_hench_grunt_omgpra_end_puzzle_a_00235504_m.ogg
  step3_voice_grunt:
    file: en_us_hench_grunt_omgpra_end_puzzle_a_00235494_m.ogg
  step1_voice_jack:
    file: en_us_hench_convict_omgpra_end_puzzle_a_00235485_m.ogg
  step2_voice_jack:
    file: en_us_hench_convict_omgpra_end_puzzle_a_00235503_m.ogg
  step3_voice_jack:
    file: en_us_hench_convict_omgpra_end_puzzle_a_00235493_m.ogg
  step1_voice_jacob:
    file: en_us_hench_leading_omgpra_end_puzzle_a_00235509_m.ogg
  step2_voice_jacob:
    file: en_us_hench_leading_omgpra_end_puzzle_a_00235499_m.ogg
  step3_voice_jacob:
    file: en_us_hench_leading_omgpra_end_puzzle_a_00235489_m.ogg
  step1_voice_kasumi:
    file: en_us_hench_thief_omgpra_end_puzzle_a_00235511_m.ogg
  step2_voice_kasumi:
    file: en_us_hench_thief_omgpra_end_puzzle_a_00235501_m.ogg
  step3_voice_kasumi:
    file: en_us_hench_thief_omgpra_end_puzzle_a_00235491_m.ogg
  step1_voice_miranda:
    file: en_us_hench_vixen_omgpra_end_puzzle_a_00235510_m.ogg
  step2_voice_miranda:
    file: en_us_hench_vixen_omgpra_end_puzzle_a_00235500_m.ogg
  step3_voice_miranda:
    file: en_us_hench_vixen_omgpra_end_puzzle_a_00235490_m.ogg
  step1_voice_tali:
    file: en_us_hench_tali_omgpra_end_puzzle_a_00235507_m.ogg
  step2_voice_tali:
    file: en_us_hench_tali_omgpra_end_puzzle_a_00235497_m.ogg
  step3_voice_tali:
    file: en_us_hench_tali_omgpra_end_puzzle_a_00235483_m.ogg
  step1_voice_zaeed:
    file: en_us_hench_veteran_omgpra_end_puzzle_a_00235484_m.ogg
  step2_voice_zaeed:
    file: en_us_hench_veteran_omgpra_end_puzzle_a_00235502_m.ogg
  step3_voice_zaeed:
    file: en_us_hench_veteran_omgpra_end_puzzle_a_00235492_m.ogg
  vorcha_got_you:
    file: en_us_ss_vorcha_ss_vorcha_00312966_m.ogg
  vorcha_laughing:
    file: en_us_ss_vorcha_ss_vorcha_00312970_m.ogg
  krogan_strong_survive:
    file: en_us_ss_sub_krogan_ss_sub_krogan_00304056_m.ogg
  krogan_fear_the_battlemaster:
    file: en_us_ss_sub_krogan_ss_sub_krogan_00303964_m.ogg
