#config_version=5

#####
# SAMARA RECRUITMENT MISSION
#
# This mode begins with all standup targets lit on a hurryup; hitting a lit
# standup collects “intel” and builds value. After each lit standup hit, two random
# shots are lit to pursue Morinth; each subsequent lit standup target hit lights
# (up to) two more shots. Unlit standups continue to build value but don’t light
# any more shots. Hitting a lit shot collects all standup target values built to
# that point. Hitting five lit shots completes the mission. The mode ends if the
# timer runs out.
#
# TODO: If the final shot is hit against the ball hold or ball lock, the player
# is given the option to recruit Morinth instead of Samara. They are
# functionally identical except that in the Suicide Mission, Samara provides the
# additional shot option bonus (like other biotics) while Morinth provides a
# damage multiplier bonus.
#
# Progress is saved after every shot, but the multiplier resets on restart
#####

mode:
  start_events: start_mode_recruitsamara
  stop_events: stop_mode_recruitsamara, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started, mode_intro_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

event_player:
  mode_recruitsamara_started:
    show_recruit_instructions:
      squadmate: samara
      portrait: recruitsamara
      instructions_main: Destroy the Gunship
      instructions_sub: Hit targets to weaken armor
  mode_powers_started:
    set_mission_shots:
      color: color_samara
      is_resumable: 1
      persist_name: recruitsamara
      shots_total: 5
      shots_remaining:
        value: device.counters.samara_shots_counter.value
        type: int
      starting_shots: none
  logicblock_samara_shots_counter_complete: recruit_samara_complete
  # Use each target to reset the shot to it "lit" state. Powers.py will
  # also rotate the targets during cloak, to avoid a stuck state
  samara_target1_lit_hit:
    advance_mission_shots:
        shots: left_orbit, kickback
        reset: true
  samara_target2_lit_hit:
    advance_mission_shots:
        shots: kickback, left_ramp
        reset: true
  samara_target3_lit_hit:
    advance_mission_shots:
        shots: left_ramp, right_ramp
        reset: true
  samara_target4_lit_hit:
    advance_mission_shots:
        shots: left_ramp, right_ramp
        reset: true
  samara_target5_lit_hit:
    advance_mission_shots:
        shots: right_ramp, right_orbit
        reset: true
  
counters:
  samara_shots_counter:
    starting_count: 5
    count_complete_value: 0
    direction: down
    persist_state: true
    count_events: power_shots_lit_hit
    events_when_hit: mission_shot_hit, mission_collect_score

shot_groups:
  samara_targets:
    shots: samara_target1, samara_target2, samara_target3, samara_target4, samara_target5
  
shots:
  samara_target1:
    switch: s_target1
    profile: color_flashing_profile
    show_tokens:
      leds: l_standup_1
      color: standup_color
  samara_target2:
    switch: s_target2
    profile: color_flashing_profile
    show_tokens:
      leds: l_standup_2
      color: standup_color
  samara_target3:
    switch: s_target3
    profile: color_flashing_profile
    show_tokens:
      leds: l_standup_3
      color: standup_color
  samara_target4:
    switch: s_target4
    profile: color_flashing_profile
    show_tokens:
      leds: l_standup_4
      color: standup_color
  samara_target5:
    switch: s_target5
    profile: color_flashing_profile
    show_tokens:
      leds: l_standup_5
      color: standup_color

show_player:
  mode_recruitsamara_started:
    recruitintro_samara:
      loops: 0
    gi_show:
      start_step: 4  # Illium
      manual_advance: True
      show_tokens:
        backwall_color: color_samara

shows:
  recruitintro_samara:
    # Temporary show until videos are done
    - time: 500ms
      sounds:
        gunship_sound:
          action: play
    - time: 3s
      events: mode_intro_complete

sound_player:
  mode_recruitsamara_started:
    music_recruit_samara:
      action: play
  mission_shot_hit: explosion  # Defined in base_endsounds
  recruit_samara_complete:
    music_recruit_samara:
      action: stop

sound_pools:
  gunship_sound:
    track: voice
    type: random_force_all
    sounds:
      - gunship_miranda
      - gunship_jacob
      - gunship_garrus{current_player.status_garrus>3}
      - gunship_kasumi{current_player.status_kasumi>3}
      - gunship_grunt{current_player.status_grunt>3}
      - gunship_zaeed{current_player.status_zaeed>3}
      - gunship_tali{current_player.status_tali>3}
      - gunship_jack{current_player.status_jack>3}

sounds:
  music_recruit_samara:
    file: mus_samara_acq_bossbattle_2.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  gunship_thane:
    file: en_us_hench_assassin_twrmwa_gun_ship_amb_h_00212350_m.ogg
    track: voice
  gunship_jack:
    file: en_us_hench_convict_twrmwa_gun_ship_amb_h_00212346_m.ogg
    track: voice
  gunship_garrus:
    file: en_us_hench_garrus_twrmwa_gun_ship_amb_h_00212343_m.ogg
    track: voice
  gunship_legion:
    file: en_us_hench_geth_twrmwa_gun_ship_amb_h_00212345_m.ogg
    track: voice
  gunship_grunt:
    file: en_us_hench_grunt_twrmwa_gun_ship_amb_h_00212342_m.ogg
    track: voice
  gunship_jacob:
    file: en_us_hench_leading_twrmwa_gun_ship_amb_h_00212341_m.ogg
    track: voice
  gunship_mordin:
    file: en_us_hench_professor_twrmwa_gun_ship_amb_h_00212348_m.ogg
    track: voice
  gunship_tali:
    file: en_us_hench_tali_twrmwa_gun_ship_amb_h_00212344_m.ogg
    track: voice
  gunship_kasumi:
    file: en_us_hench_thief_twrmwa_gun_ship_amb_h_00212349_m.ogg
    track: voice
  gunship_zaeed:
    file: en_us_hench_veteran_twrmwa_gun_ship_amb_h_00212347_m.ogg
    track: voice
  gunship_miranda:
    file: en_us_hench_vixen_twrmwa_gun_ship_amb_h_00212340_m.ogg
    track: voice

widget_player:
  logicblock_samara_shots_counter_updated:
    shots_remaining_widget:
      action: update
      slide: recruit_mission_slide
