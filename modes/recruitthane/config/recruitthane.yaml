#config_version=5

#####
# THANE RECRUITMENT MISSION
#
# This mode begins with the ramps lit to enter the Dantius towers, and each
# subsequent hit to either ramp advances the player up a floor and builds value.
# After 3 floors (1 if restarted) the orbits are lit to capture the value and
# complete the mode, and the ramps remain available to continue building value.
# The mode will end if the timer expires.
#
# Progress is not saved and this mode must be restarted if failed.
#
# TODO: This mode has only been mocked out, not tested or debugged
#####

mode:
  start_events: start_mode_recruitthane
  stop_events: stop_mode_recruitthane, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

event_player:
  mode_recruitthane_started:
    set_environment:
      env: eclipse
    show_recruit_instructions:
      squadmate: thane
      portrait: recruitthane
      instructions_main: Hit ramps to ascend
      instructions_sub: Hit orbits to complete
  tower_complete_shot_hit: recruit_thane_complete

counters:
  thane_ascent_counter:
    # Initially takes three shots to light, after it's been lit just one
    # TODO: Verify the initial state of a persisted player variable, it may not be undefined!
    starting_count: 2 if device.counters.thane_ascent_counter.value > 1 else 0
    count_complete_value: 3
    direction: up
    disable_on_complete: false
    reset_on_complete: false
    persist_state: true
    count_events: tower_ascent_shot_hit
    reset_events: mode_recruitthane_started

#####
# THANE variable_player:
#    Build value starts at 0
#    Hit either tower ascent shot to add (10,000 points * ascent_shots_hit)
#    Exponential growth! Maybe this should be mitigated or depleted over time?
#    After 3 ascent shots, hit either orbit to collect built value and complete
#      the mission (only 1 ascent shot required if mission was restarted)
#    Player can continue to try for ascent shots for maximum score buildup
#      before the timer runs out.. no maximum score for this mission?
#    Progress is not saved
#####
variable_player:
  mode_recruitthane_started:
    temp_build_value:
      action: set
      int: 0
  recruit_thane_complete:
    score: current_player.temp_build_value
  tower_ascent_shot_hit:
    temp_build_value: device.counters.thane_ascent_counter.value * 1000
  logicblock_thane_ascent_counter_complete:
    mission_instructions:
      string: "Hit orbits to complete!"
      action: set

shots:
  tower_ascent_shot:
    hit_events: sh_left_ramp_hit, sh_right_ramp_hit
    tags: envshot_left_ramp, envshot_right_ramp
  tower_complete_shot:
    hit_events: sh_left_orbit_hit, sh_right_orbit_hit
    enable_events: logicblock_thane_ascent_counter_complete
    disable_events: mode_recruitthane_started
    tags: envshot_left_orbit, envshot_right_orbit

show_player:
  mode_recruitthane_started:
    tower_shots_show:
      speed: 2
  tower_ascent_shot_hit:
    tower_flash_show:
      speed: 12
      loops: 4
      priority: 100
  logicblock_thane_ascent_counter_complete:
    tower_shots_show:
      action: stop
    tower_complete_show:
      speed: 2
  stop_mode_recruitthane:
    tower_shots_show:
      action: stop
    tower_complete_show:
      action: stop

shows:
  tower_shots_show:
    - time: 0
      lights:
        l_left_ramp_shield_rgb: green
        l_right_ramp_shield_rgb: green
    - time: '+1'
      lights:
        l_left_ramp_shield_rgb: black
        l_right_ramp_shield_rgb: black
  tower_flash_show:
    - time: 0
      lights:
        shot_shields: green
    - time: '+1'
      lights:
        shot_shields: black
  tower_complete_show:
    - time: 0
      lights:
        l_left_ramp_shield_rgb: green
        l_right_ramp_shield_rgb: green
        l_left_orbit_shield_rgb: green
        l_right_orbit_shield_rgb: green
    - time: '+1'
      lights:
        l_left_orbit_shield_rgb: black
        l_right_orbit_shield_rgb: black

sound_player:
  mode_recruitthane_started:
    music_thane:
      action: play
      fade_out: 2s
      mode_end_action: stop
    asari_youll_have_to_get_up_to_the_bridge: {}
  logicblock_thane_ascent_counter_hit{count!=3}: nas_misc_sounds
  logicblock_thane_ascent_counter_hit{count==3}: nas_no_one_gets_across_bridge
  envshot_outlane_hit: failure_sound

sound_pools:
  nas_misc_sounds:
    sounds: nas_damn_it, nas_where_is_everyone, nas_give_me_a_report, nas_answer_me_dammit, nas_find_out_whats_going_on, nas_just_kill_them, nas_finish_them_off, nas_sending_reinforcements
    track: voice
  failure_sound:
    sounds: nas_good_work, nas_thats_more_like_it
    track: voice

sounds:
  music_thane:
    file: mus_thane_acq_combat_3b.ogg
    track: music
  nas_damn_it:
    file: en_us_twrasa_nassana_twrasa_officeslowlevel_d_00178710_m.ogg
    track: voice
  nas_where_is_everyone:
    file: en_us_twrasa_nassana_twrasa_officeslowlevel_d_00189124_m.ogg
    track: voice
  nas_give_me_a_report:
    file: en_us_twrasa_nassana_twrasa_officeslowlevel_d_00189125_m.ogg
    track: voice
  nas_answer_me_dammit:
    file: en_us_twrasa_nassana_twrasa_officeslowlevel_d_00189126_m.ogg
    track: voice
  nas_find_out_whats_going_on:
    file: en_us_twrasa_nassana_twrasa_officeslowlevel_d_00189127_m.ogg
    track: voice
  nas_no_one_gets_across_bridge:
    file: en_us_twrasa_nassana_twrasa_bridge_orders_a_00199419_m.ogg
    track: voice
  nas_just_kill_them:
    file: en_us_twrasa_nassana_twrasa_bridge_orders_a_00199421_m.ogg
    track: voice
  nas_finish_them_off:
    file: en_us_twrasa_nassana_twrasa_bridge_orders_a_00199422_m.ogg
    track: voice
  nas_sending_reinforcements:
    file: en_us_twrasa_nassana_twrasa_bridge_orders_a_00199425_m.ogg
    track: voice
  nas_thats_more_like_it:
    file: en_us_twrasa_nassana_twrasa_bridge_orders_a_00199423_m.ogg
    track: voice
  nas_good_work:
    file: en_us_twrasa_nassana_twrasa_bridge_orders_a_00199750_m.ogg
    track: voice
  asari_youll_have_to_get_up_to_the_bridge:
    file: en_us_twrasa_quest_giver_twrasa_shuttle_ride_d_00187374_m.ogg
    track: voice



