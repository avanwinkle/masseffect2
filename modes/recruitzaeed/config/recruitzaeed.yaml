#config_version=5

#####
# ZAEED RECRUITMENT MISSION
#
# This mode begins with both orbit shots lit, and the objective varies depending
# on which shot the player hits. Once an orbit is hit, either orbit can be hit
# repeatedly to build value; after 3 hits, the kickback lane is lit to collect
# the value and complete the mode. The mode ends if the timer runs out.
#
# If the player chooses the left orbit (paragon, lit blue), the timer starts
# higher and more time is added to the timer with each orbit hit. If the player
# chooses the right orbit (renegade, lit red), the timer starts lower and a
# bonus multiplier increases the captured value when the mode is completed.
#
# Progress is not saved and this mode must be restarted if failed.
#
# TODO: This mode has only been mocked out, not thoroughly tested
#####

mode:
  start_events: start_mode_recruitzaeed
  stop_events: stop_mode_recruitzaeed, stop_recruitmission, stop_missions
  events_when_started: mode_type_mission_started
  events_when_stopped: mode_type_mission_stopped
  priority: 500

counters:
  zaeed_orbits_counter:
    starting_count: 0
    count_complete_value: 3
    direction: up
    disable_on_complete: false
    reset_on_complete: false
    count_events: zaeed_orbitshots_hit
    # reset_events: mode_recruitzaeed_started # Is this necessary without persist_state?

event_player:
  logicblock_zaeed_orbits_counter_hit: recruittimer_add_ten
  zaeed_kickshot_hit: recruit_zaeed_complete
  player_zaeed_path_renegade{value==0}:
    update_recruitmission:
      missionname: "Save the Workers"
  player_zaeed_path_renegade{value==1}:
    update_recruitmission:
      missionname: "Stop Vido's Escape"

#####
# ZAEED SCORING
#    Hurryup starts at 8,000
#    Hurryup depletes at a constant rate of 90/s
#    Each orbit hit builds the hurryup at that time
#    Subsequent orbit hits increase the multiplier of the built value
#    Hit the kickback to complete the mode and collect the built value
#    Progress is not saved
#####
scoring:
  mode_recruitzaeed_started:
    # Build value tracks the "base" hurryup depletion
    temp_build_value:
      action: set
      score: 8000
    temp_hurryup_value:
      action: set
      score: 8000
    temp_multiplier:
      action: set
      float: 1
    # Default to paragon path with value == 0
    zaeed_path_renegade:
      action: set
      score: -1
  # If the right orbit is the first orbit hit, set path to renegade
  zaeed_right_orbit_hit{device.counters.zaeed_orbits_counter.value==0}:
    zaeed_path_renegade:
      action: set
      score: 1
  zaeed_left_orbit_hit{device.counters.zaeed_orbits_counter.value==0}:
    zaeed_path_renegade:
      action: set
      score: 0
  timer_recruittimer_tick:
    temp_hurryup_value: -90
    temp_build_value:   -90
  zaeed_orbitshots_hit:
    temp_hurryup_value: current_player.temp_build_value * current_player.temp_multiplier
    temp_multiplier:
      action: add
      float: 0.25
  zaeed_kickshot_hit:
    score: current_player.temp_hurryup_value

shot_profiles:
  zaeed_kickshot_profile:
    show_when_disabled: false
    show: zaeed_show
    states:
      - name: lit
  zaeed_orbit_profile:
    show_when_disabled: false
    states:
      - name: reputation
        show: flash_color_show
      - name: lit
        show: zaeed_show

shot_groups:
  zaeed_orbitshots:
    shots: zaeed_left_orbit, zaeed_right_orbit

shots:
  zaeed_left_orbit:
    hit_events: sh_left_orbit_hit
    profile: zaeed_orbit_profile
    advance_events: zaeed_right_orbit_zaeed_orbit_profile_reputation_hit
    show_tokens:
      leds: l_left_orbit_shield_rgb
      color: 1166ff #color_paragon
    tags: envshot_left_orbit
  zaeed_right_orbit:
    hit_events: sh_right_orbit_hit
    profile: zaeed_orbit_profile
    advance_events: zaeed_left_orbit_zaeed_orbit_profile_reputation_hit
    show_tokens:
      leds: l_right_orbit_shield_rgb
      color: 660000 #color_renegade
    tags: envshot_right_orbit
  zaeed_kickshot:
    hit_events: sh_kickback_hit
    enable_events: logicblock_zaeed_orbits_counter_complete
    disable_events: mode_recruitzaeed_started
    profile: zaeed_kickshot_profile
    show_tokens:
      leds: l_kickback_shield_rgb
      color: FF7700 #color_zaeed
    tags: envshot_kickback

show_player:
  zaeed_orbitshots_hit:
    flash_all_shields_show:
      loops: 6
      speed: 12
      show_tokens:
        color: FF7700

shows:
  zaeed_show:
    - time: 0
      lights:
        (leds): FF7700 #color_zaeed
        l_null: (color)
    - time: '+1'
      lights:
        (leds): 000000
        l_null: (color)

slide_player:
  mode_recruitzaeed_started:
    zaeed_instructions_slide:
      expire: 3s

slides:
  zaeed_instructions_slide:
    widgets:
      - type: text
        text: CHOOSE PARAGON OR RENEGADE
        style: dmd_small
        anchor_y: bottom
        y: middle+4
        z: 1
      - type: text
        text: HIT 3X ORBITS TO CATCH VIDO
        style: dmd_small
        anchor_y: top
        y: middle-4
        z: 1
      - type: rectangle
        width: 128
        height: 32
        color: 000000

sound_player:
  mode_recruitzaeed_started:
    music_recruit_zaeed:
      action: play
      mode_end_action: stop
    zaeed_missionstart:
      action: play
  logicblock_zaeed_orbits_counter_hit{count==1 and current_player.zaeed_path_renegade==0}: explosionchoice_1_paragon
  logicblock_zaeed_orbits_counter_hit{count==1 and current_player.zaeed_path_renegade==1}: explosionchoice_1_renegade
  logicblock_zaeed_orbits_counter_hit{count==2 and current_player.zaeed_path_renegade==0}: explosionchoice_2_paragon
  logicblock_zaeed_orbits_counter_hit{count==2 and current_player.zaeed_path_renegade==1}: explosionchoice_2_renegade
  logicblock_zaeed_orbits_counter_hit{count==3 and current_player.zaeed_path_renegade==0}: explosionchoice_3_paragon
  logicblock_zaeed_orbits_counter_hit{count==3 and current_player.zaeed_path_renegade==1}: explosionchoice_3_renegade

sound_pools:
  zaeed_missionstart:
    sounds: vido_all_squads_sweep_jungle, zaeed_here_we_go, zaeed_bring_it_on
    track: voice
    type: random_force_all
  explosionchoice_1_paragon:
    sounds: zaeed_you_wanna_waste_time, zaeed_let_these_people_burn
    track: voice
    type: random_force_all
  explosionchoice_1_renegade:
    sounds: shep_you_want_him_dead_then_he_dies, shep_lets_get_moving_before_vido_gets_away
    track: voice
    type: random_force_all
  explosionchoice_2_paragon:
    sounds: shep_we_dont_sacrifice_lives, shep_the_mission_is_to_save_these_workers
    track: voice
    type: random_force_all
  explosionchoice_2_renegade:
    sounds: zaeed_if_we_keep_up_the_pressure, zaeed_glad_you_see_it_my_way
    track: voice
    type: random_force_all
  explosionchoice_3_paragon:
    sounds: zaeed_vido_come_fight_me, vido_see_you_in_twenty
    track: voice
    type: random_force_all
  explosionchoice_3_renegade:
    sounds: zaeed_burn_you_son_of_a, zaeed_fry_you_son_of_a
    track: voice
    type: random_force_all

sounds:
  music_recruit_zaeed:
    file: mus_jacob_loy_combat_1.ogg
    track: music
    mode_end_action: stop
    fade_out: 1s
  zaeed_here_we_go:
    file: DLC_HEN_VT_Int.334.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.5
      attack: 20ms
      release: 20ms
      release_point: 10ms
  zaeed_bring_it_on:
    file: DLC_HEN_VT_Int.345.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.5
      attack: 20ms
      release: 20ms
      release_point: 10ms
  shep_we_dont_sacrifice_lives:
    file: DLC_HEN_VT_Int.377.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.5
      attack: 20ms
      release: 20ms
      release_point: 10ms
  shep_this_isnt_the_time:
    file: DLC_HEN_VT_Int.385.ogg
    track: voice
  shep_the_mission_is_to_save_these_workers:
    file: DLC_HEN_VT_Int.389.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.5
      attack: 20ms
      release: 20ms
      release_point: 10ms
  shep_you_want_him_dead_then_he_dies:
    file: DLC_HEN_VT_Int.405.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.5
      attack: 20ms
      release: 20ms
      release_point: 10ms
  shep_lets_get_moving_before_vido_gets_away:
    file: DLC_HEN_VT_Int.418.ogg
    track: voice
    ducking:
      target: music
      attenuation: 0.5
      attack: 20ms
      release: 20ms
      release_point: 10ms
  shep_were_here_to_free_these_people:
    file: DLC_HEN_VT_Int.420.ogg
    track: voice
  shep_ill_save_you_on_one_condition:
    file: DLC_HEN_VT_Int.495.ogg
    track: voice
  zaeed_you_wanna_waste_time:
    file: DLC_HEN_VT_Int.393.ogg
    track: voice
  zaeed_let_these_people_burn:
    file: DLC_HEN_VT_Int.395.ogg
    track: voice
  zaeed_if_we_keep_up_the_pressure:
    file: DLC_HEN_VT_Int.400.ogg
    track: voice
  zaeed_glad_you_see_it_my_way:
    file: DLC_HEN_VT_Int.424.ogg
    track: voice
  zaeed_burn_you_son_of_a:
    file: DLC_HEN_VT_Int.430.ogg
    track: voice
  zaeed_fry_you_son_of_a:
    file: DLC_HEN_VT_Int.520.ogg
    track: voice
  zaeed_vido_come_fight_me:
    file: DLC_HEN_VT_Int.473.ogg
    track: voice
  vido_all_squads_sweep_jungle:
    file: DLC_HEN_VT_Int.336.ogg
    track: voice
  vido_you_finally_tracked_me_down:
    file: DLC_HEN_VT_Int.438.ogg
    track: voice
  vido_see_you_in_twenty:
    file: DLC_HEN_VT_Int.518.ogg
    track: voice






