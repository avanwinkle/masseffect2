#config_version=5

#####
# SHADOW BROKER MODE
#
# This mode is the base mode for handling progress through the Shadow Broker 
# side missions. It primarily handles tracking the dropbank completions and
# lighting their progress, then enabling shots to start the various modes that
# progress through the Shadow Broker story.
#
#####

mode:
  start_events: start_mode_shadowbroker_base
  stop_events: stop_mode_shadowbroker_base
  priority: 500

event_player:
  # Complete the dropbank after vasir is enabled to begin the chase
  drop_target_bank_dropbank_down{device.achievements.vasir.state=="enabled"}: start_mode_shadowbroker_chase
  # Complete the chase to begin Vasir Combat
  shadowbroker_chase_complete: start_mode_shadowbroker_vasir
  # Complete the dropbank after vasir is complete & broker is enabled to begin hagalaz
  drop_target_bank_dropbank_down{device.achievements.shadowbroker.state=="enabled"}: start_mode_shadowbroker_hagalaz
  # Complete hagalaz to begin Boss Combat
  shadowbroker_hagalaz_complete: start_mode_shadowbroker_boss
  # Complete the dropbank after boss is defeated for extra prizes!
  drop_target_bank_dropbank_down{device.achievements.shadowbroker.state=="complete"}: award_shadowbroker_prize

counters:
  sbvasir_counter:
    count_events: drop_target_bank_dropbank_down
    starting_count: 0
    count_complete_value: 3
    persist_state: true
    disable_on_complete: true
  sbhagalaz_counter:
    enable_events: achievement_vasir_state_completed
    count_events: drop_target_bank_dropbank_down
    starting_count: 0
    count_complete_value: 3
    persist_state: true
    disable_on_complete: true

scoring:
  drop_target_bank_dropbank_down:
    intel: 1

shot_groups:
  sbdroptarget_group:
    shots: sbdroptarget_bottom_shot, sbdroptarget_middle_shot, sbdroptarget_top_shot

shot_profiles:
  advance_sbdrops_profile:
    show_when_disabled: false
    states:
      - name: unlit
        show: sbdrops_off
      - name: one_lit
        show: sbdrops_one_show
      - name: two_lit
        show: sbdrops_two_show
      - name: three_lit
        show: sbdrops_three_show

shots:
  enabled_sbvasirchase_shot:
    advance_events: logicblock_sbvasir_counter_hit
    reset_events: achievement_vasir_state_completed, achievement_shadowbroker_state_completed
    profile: advance_sbdrops_profile

show_player:
  drop_target_bank_dropbank_mixed:
    sbdrops_flash:
      priority: 100
      loops: 6
      speed: 10
  drop_target_bank_dropbank_down:
    sbdrops_flash:
      priority: 100
      loops: 12
      speed: 10

shows:
  sbdrops_flash:
    - time: 0
      lights:
        l_dropbank_bottom: white
        l_dropbank_middle: white
        l_dropbank_top: white
    - time: '+1'
      lights:
        l_dropbank_bottom: black
        l_dropbank_middle: black
        l_dropbank_top: black
  sbdrops_off:
    - lights:
        l_dropbank_bottom: black
        l_dropbank_middle: black
        l_dropbank_top: black
  sbdrops_one_show:
    - lights:
        l_dropbank_bottom: white
        l_dropbank_middle: black
        l_dropbank_top: black
  sbdrops_two_show:
    - lights:
        l_dropbank_bottom: white
        l_dropbank_middle: white
        l_dropbank_top: black
  sbdrops_three_show:
    - lights:
        l_dropbank_bottom: white
        l_dropbank_middle: white
        l_dropbank_top: white
