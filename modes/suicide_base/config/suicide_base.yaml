#config_version=5
mode:
  start_events: start_mode_suicide_base
  stop_events: stop_wizards, suicidemission_complete, suicidemission_failed
  events_when_started: mode_type_wizard_started, enable_fullorbit
  events_when_stopped: mode_type_wizard_stopped
  priority: 2000

event_player:
  mode_suicide_base_started.1:
    - start_mode_suicide_omegarelay{device.achievements.omegarelay.state!="completed"}
    - start_mode_missionselect{device.achievements.omegarelay.state=="completed" and (device.achievements.infiltration.state!="completed" or device.achievements.longwalk.state!="completed")}
    - start_mode_suicide_humanreaper{device.achievements.longwalk.state=="completed" and device.achievements.humanreaper.state!="completed"}
    - start_mode_suicide_endrun{device.achievements.humanreaper.state=="completed" and device.achievements.endrun.state!="completed"}
  # Wait for the mission selection of a specialist before starting infiltration or long walk
  missionselect_specialist_selected:
    - start_mode_suicide_infiltration{device.achievements.infiltration.state!="completed"}
    - start_mode_suicide_longwalk{device.achievements.infiltration.state=="completed"}
  # Progression
  omegarelay_complete: start_mode_missionselect
  infiltration_complete: start_mode_missionselect
  longwalk_complete: start_mode_suicide_humanreaper
  humanreaper_complete: start_mode_suicide_endrun
  endrun_complete:
    - levelup
    - suicidemission_complete
  # Remember the score before starting the mission, in case it fails
  mode_suicide_base_started.2{current_player.presuicide_score==0}:
    presuicide_score:
      action: set
      int: current_player.score

ball_saves:
  omegarelay_save:
    enable_events: multiball_omegarelay_ended
    only_last_ball: true
    delayed_eject_events: mode_suicide_infiltration_started
    auto_launch: true # Must be true because we have a multiball starting too

show_player:
  # Light the missions arrow to select a specialist after one died
  infiltration_failed:
    missions_available_show:
      action: play
  longwalk_failed:
    missions_available_show:
      action: play
  mode_missionselect_started:
    missions_available_show:
      action: stop
  mode_suicide_base_started:
    missions_available_show:
      action: stop

variable_player:
  # Track whether we are progressing into a mode or starting a new ball
  mode_suicide_base_started:
    suicide_continuing:
      action: set
      int: 0
  kill_specialist:
    suicide_continuing:
      action: set
      int: 0
  omegarelay_complete:
    suicide_continuing: 1
  infiltration_complete:
    suicide_continuing: 1
  longwalk_complete:
    suicide_continuing: 1
  humanreaper_complete:
    suicide_continuing: 1
  suicidemission_failed:
    # Reset all dead squadmates to be re-recruitable (or recruited for Jacob/Miranda)
    status_garrus{current_player.status_garrus==-1}:
      action: set
      int: 0
    status_grunt{current_player.status_grunt==-1}:
      action: set
      int: 0
    status_jacob{current_player.status_jacob==-1}:
      action: set
      int: 4
    status_jack{current_player.status_jack==-1}:
      action: set
      int: 0
    status_kasumi{current_player.status_kasumi==-1}:
      action: set
      int: 0
    status_legion{current_player.status_legion==-1}:
      action: set
      int: 0
    status_miranda{current_player.status_miranda==-1}:
      action: set
      int: 4
    status_mordin{current_player.status_mordin==-1}:
      action: set
      int: 0
    status_samara{current_player.status_samara==-1}:
      action: set
      int: 0
    status_tali{current_player.status_tali==-1}:
      action: set
      int: 0
    status_thane{current_player.status_thane==-1}:
      action: set
      int: 0
    status_zaeed{current_player.status_zaeed==-1}:
      action: set
      int: 0

slide_player:
  mode_type_suicide_started: suicide_slide
  mode_type_suicide_stopped:
    suicide_slide:
      action: remove
  kill_specialist: specialist_killed_slide
  missionselect_specialist_selected:
    specialist_killed_slide:
      action: remove

slides:
  suicide_slide:
    widgets:
      - type: text
        text: the Suicide Mission
        color: BBBBBB
        style: small
        anchor_y: top
        y: top-2
  specialist_killed_slide:
    widgets:
      - type: text
        text: (player|specialist) is dead
        style: small
        anchor_y: bottom
        y: middle+4
      - type: text
        text: Shoot ramp to try again
        style: small
        anchor_y: top
        y: middle-4

widget_player:
  mode_suicide_omegarelay_started:
    omegarelay_title:
      slide: suicide_slide
    suicide_time:
      slide: suicide_slide
  mode_suicide_infiltration_started:
    omegarelay_title:
      action: remove
    infiltration_title:
      slide: suicide_slide
  mode_suicide_longwalk_started:
    infiltration_title:
      action: remove
    longwalk_title:
      slide: suicide_slide
  mode_suicide_humanreaper_started:
    longwalk_title:
      action: remove
    humanreaper_title:
      slide: suicide_slide
  mode_suicide_endrun_started:
    humanreaper_title:
      action: remove
    endrun_title:
      slide: suicide_slide
  timer_omegarelay_tick:
    suicide_time:
      action: update
  timer_infiltration_tick:
    suicide_time:
      action: update
  timer_longwalk_tick:
    suicide_time:
      action: update

widgets:
  omegarelay_title:
    - type: text
      text: Omega 4 Relay
      style: text_default
  infiltration_title:
    - type: text
      text: Infiltration
      style: text_default
  longwalk_title:
    - type: text
      text: the Long Walk
      style: text_default
  humanreaper_title:
    - type: text
      text: the Human Reaper
      style: text_default
  endrun_title:
    - type: text
      text: the End Run
      style: text_default
  suicide_time:
    - type: text
      text: (ticks)
      style: medium
      anchor_x: left
      anchor_y: bottom
      x: 2
      y: 2
