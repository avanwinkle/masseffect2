#config_version=5
mode:
  start_events: achievement_humanreaper_state_started
  stop_events: ball_will_end, humanreaper_complete, humanreaper_failed
  events_when_started: restart_reaper, stop_harbinger
  priority: 300

event_player:
  reaper_chargeup_complete: fire_reapercannon
  reaper_firing_complete:
    - disable_flippers
    - restart_reaper|5s
  restart_reaper:
    - enable_flippers
    - enable_random_reapershot
  player_reaper_hp:
    # If the reaper still has HP and there are more rounds to go, "fail" to return to platforms
    - humanreaper_failed{value>0 and current_player.reaper_rounds>0}
    # If the reaper has no HP and the minimum 3 rounds have passed, OR if the max rounds have passed, "complete"
    - humanreaper_complete{(value<=0 and current_player.reaper_rounds<=3) or current_player.reaper_rounds<=0}

random_event_player:
  enable_random_reapershot:
    events:
      - enable_reapershot_left_orbit
      - enable_reapershot_kickback
      - enable_reapershot_left_ramp
      - enable_reapershot_right_ramp
      - enable_reapershot_right_orbit

variable_player:
  reaper_shot_hit:
    reaper_hp:
      action: add
      int: current_player.build_value * (current_player.reaper_rounds / 2) * -1

timers:
  # This is the "charging" phase of the reaper cannon
  reaper_chargeup:
    start_value: 0
    end_value: 40
    tick_interval: 500ms
    start_running: true
    control_events:
      - event: reaper_shot_hit
        action: stop
      - event: restart_reaper
        action: restart
  # This is the "firing" phase of the reaper cannon
  reaper_firing:
    start_value: 10
    end_value: 0
    tick_interval: 500ms
    control_events:
      - event: fire_reapercannon
        action: restart
      - event: reaper_shot_hit
        action: stop

shot_groups:
  reaper_shot:
    shots: reaper_left_orbit, reaper_kickback, reaper_left_ramp, reaper_right_ramp, reaper_right_orbit
    disable_events: mode_suicide_humanreaper_started, reaper_firing_complete
    reset_events: restart_reaper

shots:
  reaper_left_ramp:
    hit_events: sh_left_ramp_hit
    enable_events: enable_reaper_left_ramp
    advance_events: fire_reapercannon
    profile: reaper_profile
    show_tokens:
      leds: l_left_ramp_shield_rgb
      arrow: l_left_ramp_arrow_red
    tags: envshot_left_ramp
  reaper_left_orbit:
    hit_events: sh_left_orbit_hit
    enable_events: enable_reaper_left_orbit
    advance_events: fire_reapercannon
    profile: reaper_profile
    show_tokens:
      leds: l_left_orbit_shield_rgb
      arrow: l_left_orbit_arrow_red
    tags: envshot_left_orbit
  reaper_right_ramp:
    hit_events: sh_right_ramp_hit
    enable_events: enable_reaper_right_ramp
    advance_events: fire_reapercannon
    profile: reaper_profile
    show_tokens:
      leds: l_right_ramp_shield_rgb
      arrow: l_right_ramp_arrow_red
    tags: envshot_right_ramp
  reaper_right_orbit:
    hit_events: sh_right_orbit_hit
    enable_events: enable_reaper_right_orbit
    advance_events: fire_reapercannon
    profile: reaper_profile
    show_tokens:
      leds: l_right_orbit_shield_rgb
      arrow: l_right_orbit_arrow_red
    tags: envshot_right_orbit
  reaper_kickback:
    hit_events: sh_kickback_hit
    enable_events: enable_reaper_kickback
    advance_events: fire_reapercannon
    profile: reaper_profile
    show_tokens:
      leds: l_kickback_shield_rgb
      arrow: l_kickback_arrow_red
    tags: envshot_kickback

shot_profiles:
  reaper_profile:
    show_when_disabled: false
    states:
      - name: charging
        show: reaper_charging_shield_show
        loops: 0
      - name: firing
        show: reaper_firing_show

slide_player:
  player_reaper_hp{value>0}:
    reaper_hitdamage_slide:
      expire: 4s

slides:
  reaper_hitdamage_slide:
    widgets:
      - type: text
        text: KAPOW!
        style: text_default
        anchor_y: bottom
        y: middle+2
      - type: text
        text: (change) damage dealt!
        style: small
        anchor_y: top
        y: middle-2
      - type: text
        text: (value) remaining
        style: small
        anchor_y: bottom
        y: 2

show_player:
  reaper_firing_complete:
    reaper_cannon_lanes_show:
      action: play
      loops: 10
      speed: 2
    reaper_cannon_flashers_show:
      action: play
      loops: 2
      speed: 1

shows:
  reaper_charging_shield_show:
    - time: 0
      lights:
        (leds): 000000
        (arrow): on
    - time: 1s
      lights:
        (leds):
          color: FF0000
          fade: 16s
        (arrow): on
  reaper_charging_arrow_show:
    - time: 0
      lights:
        (arrow): 000000
    - time: '+1'
      lights:
        (arrow): FFFFFF
  reaper_firing_show:
    - time: 0
      lights:
        lane_arrows: on
        (leds): FF0000
    - time: '+1'
      lights:
        lane_arrows: off
  reaper_cannon_lanes_show:
    - time: 0
      lights:
        color_shields: FF0000
        lane_arrows: off
    - time: '+1'
      lights:
        color_shields: 330000
        lane_arrows: on
  reaper_cannon_flashers_show:
    - time: 0
      flashers:
        l_flash_dragon_right: 150ms
    - time: 800ms
      flashers:
        l_flash_pop_bumpers: 100ms
        l_flash_left_orbit: 100ms
    - time: 1300ms
      flashers:
        l_flash_dragon_left: 200ms
        l_flash_battering_rame: 100ms
    - time: 3s
      flashers:
        l_flash_back_panel_right: 200ms
        l_flash_slingshots: 100ms
